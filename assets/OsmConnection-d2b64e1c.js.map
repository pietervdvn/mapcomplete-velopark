{"version":3,"file":"OsmConnection-d2b64e1c.js","sources":["../../node_modules/dompurify/dist/purify.es.js","../../src/Utils.ts","../../src/Logic/UIEventSource.ts","../../src/Models/Constants.ts","../../src/Logic/Web/LocalStorageSource.ts","../../node_modules/osm-auth/src/osm-auth.mjs","../../src/Logic/Osm/OsmPreferences.ts","../../src/Logic/Osm/OsmConnection.ts"],"sourcesContent":["/*! @license DOMPurify 3.0.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.0.5/LICENSE */\n\nconst {\n  entries,\n  setPrototypeOf,\n  isFrozen,\n  getPrototypeOf,\n  getOwnPropertyDescriptor\n} = Object;\nlet {\n  freeze,\n  seal,\n  create\n} = Object; // eslint-disable-line import/no-mutable-exports\n\nlet {\n  apply,\n  construct\n} = typeof Reflect !== 'undefined' && Reflect;\n\nif (!apply) {\n  apply = function apply(fun, thisValue, args) {\n    return fun.apply(thisValue, args);\n  };\n}\n\nif (!freeze) {\n  freeze = function freeze(x) {\n    return x;\n  };\n}\n\nif (!seal) {\n  seal = function seal(x) {\n    return x;\n  };\n}\n\nif (!construct) {\n  construct = function construct(Func, args) {\n    return new Func(...args);\n  };\n}\n\nconst arrayForEach = unapply(Array.prototype.forEach);\nconst arrayPop = unapply(Array.prototype.pop);\nconst arrayPush = unapply(Array.prototype.push);\nconst stringToLowerCase = unapply(String.prototype.toLowerCase);\nconst stringToString = unapply(String.prototype.toString);\nconst stringMatch = unapply(String.prototype.match);\nconst stringReplace = unapply(String.prototype.replace);\nconst stringIndexOf = unapply(String.prototype.indexOf);\nconst stringTrim = unapply(String.prototype.trim);\nconst regExpTest = unapply(RegExp.prototype.test);\nconst typeErrorCreate = unconstruct(TypeError);\nfunction unapply(func) {\n  return function (thisArg) {\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n\n    return apply(func, thisArg, args);\n  };\n}\nfunction unconstruct(func) {\n  return function () {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    return construct(func, args);\n  };\n}\n/* Add properties to a lookup table */\n\nfunction addToSet(set, array, transformCaseFunc) {\n  var _transformCaseFunc;\n\n  transformCaseFunc = (_transformCaseFunc = transformCaseFunc) !== null && _transformCaseFunc !== void 0 ? _transformCaseFunc : stringToLowerCase;\n\n  if (setPrototypeOf) {\n    // Make 'in' and truthy checks like Boolean(set.constructor)\n    // independent of any properties defined on Object.prototype.\n    // Prevent prototype setters from intercepting set as a this value.\n    setPrototypeOf(set, null);\n  }\n\n  let l = array.length;\n\n  while (l--) {\n    let element = array[l];\n\n    if (typeof element === 'string') {\n      const lcElement = transformCaseFunc(element);\n\n      if (lcElement !== element) {\n        // Config presets (e.g. tags.js, attrs.js) are immutable.\n        if (!isFrozen(array)) {\n          array[l] = lcElement;\n        }\n\n        element = lcElement;\n      }\n    }\n\n    set[element] = true;\n  }\n\n  return set;\n}\n/* Shallow clone an object */\n\nfunction clone(object) {\n  const newObject = create(null);\n\n  for (const [property, value] of entries(object)) {\n    newObject[property] = value;\n  }\n\n  return newObject;\n}\n/* This method automatically checks if the prop is function\n * or getter and behaves accordingly. */\n\nfunction lookupGetter(object, prop) {\n  while (object !== null) {\n    const desc = getOwnPropertyDescriptor(object, prop);\n\n    if (desc) {\n      if (desc.get) {\n        return unapply(desc.get);\n      }\n\n      if (typeof desc.value === 'function') {\n        return unapply(desc.value);\n      }\n    }\n\n    object = getPrototypeOf(object);\n  }\n\n  function fallbackValue(element) {\n    console.warn('fallback value for', element);\n    return null;\n  }\n\n  return fallbackValue;\n}\n\nconst html$1 = freeze(['a', 'abbr', 'acronym', 'address', 'area', 'article', 'aside', 'audio', 'b', 'bdi', 'bdo', 'big', 'blink', 'blockquote', 'body', 'br', 'button', 'canvas', 'caption', 'center', 'cite', 'code', 'col', 'colgroup', 'content', 'data', 'datalist', 'dd', 'decorator', 'del', 'details', 'dfn', 'dialog', 'dir', 'div', 'dl', 'dt', 'element', 'em', 'fieldset', 'figcaption', 'figure', 'font', 'footer', 'form', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'head', 'header', 'hgroup', 'hr', 'html', 'i', 'img', 'input', 'ins', 'kbd', 'label', 'legend', 'li', 'main', 'map', 'mark', 'marquee', 'menu', 'menuitem', 'meter', 'nav', 'nobr', 'ol', 'optgroup', 'option', 'output', 'p', 'picture', 'pre', 'progress', 'q', 'rp', 'rt', 'ruby', 's', 'samp', 'section', 'select', 'shadow', 'small', 'source', 'spacer', 'span', 'strike', 'strong', 'style', 'sub', 'summary', 'sup', 'table', 'tbody', 'td', 'template', 'textarea', 'tfoot', 'th', 'thead', 'time', 'tr', 'track', 'tt', 'u', 'ul', 'var', 'video', 'wbr']); // SVG\n\nconst svg$1 = freeze(['svg', 'a', 'altglyph', 'altglyphdef', 'altglyphitem', 'animatecolor', 'animatemotion', 'animatetransform', 'circle', 'clippath', 'defs', 'desc', 'ellipse', 'filter', 'font', 'g', 'glyph', 'glyphref', 'hkern', 'image', 'line', 'lineargradient', 'marker', 'mask', 'metadata', 'mpath', 'path', 'pattern', 'polygon', 'polyline', 'radialgradient', 'rect', 'stop', 'style', 'switch', 'symbol', 'text', 'textpath', 'title', 'tref', 'tspan', 'view', 'vkern']);\nconst svgFilters = freeze(['feBlend', 'feColorMatrix', 'feComponentTransfer', 'feComposite', 'feConvolveMatrix', 'feDiffuseLighting', 'feDisplacementMap', 'feDistantLight', 'feDropShadow', 'feFlood', 'feFuncA', 'feFuncB', 'feFuncG', 'feFuncR', 'feGaussianBlur', 'feImage', 'feMerge', 'feMergeNode', 'feMorphology', 'feOffset', 'fePointLight', 'feSpecularLighting', 'feSpotLight', 'feTile', 'feTurbulence']); // List of SVG elements that are disallowed by default.\n// We still need to know them so that we can do namespace\n// checks properly in case one wants to add them to\n// allow-list.\n\nconst svgDisallowed = freeze(['animate', 'color-profile', 'cursor', 'discard', 'font-face', 'font-face-format', 'font-face-name', 'font-face-src', 'font-face-uri', 'foreignobject', 'hatch', 'hatchpath', 'mesh', 'meshgradient', 'meshpatch', 'meshrow', 'missing-glyph', 'script', 'set', 'solidcolor', 'unknown', 'use']);\nconst mathMl$1 = freeze(['math', 'menclose', 'merror', 'mfenced', 'mfrac', 'mglyph', 'mi', 'mlabeledtr', 'mmultiscripts', 'mn', 'mo', 'mover', 'mpadded', 'mphantom', 'mroot', 'mrow', 'ms', 'mspace', 'msqrt', 'mstyle', 'msub', 'msup', 'msubsup', 'mtable', 'mtd', 'mtext', 'mtr', 'munder', 'munderover', 'mprescripts']); // Similarly to SVG, we want to know all MathML elements,\n// even those that we disallow by default.\n\nconst mathMlDisallowed = freeze(['maction', 'maligngroup', 'malignmark', 'mlongdiv', 'mscarries', 'mscarry', 'msgroup', 'mstack', 'msline', 'msrow', 'semantics', 'annotation', 'annotation-xml', 'mprescripts', 'none']);\nconst text = freeze(['#text']);\n\nconst html = freeze(['accept', 'action', 'align', 'alt', 'autocapitalize', 'autocomplete', 'autopictureinpicture', 'autoplay', 'background', 'bgcolor', 'border', 'capture', 'cellpadding', 'cellspacing', 'checked', 'cite', 'class', 'clear', 'color', 'cols', 'colspan', 'controls', 'controlslist', 'coords', 'crossorigin', 'datetime', 'decoding', 'default', 'dir', 'disabled', 'disablepictureinpicture', 'disableremoteplayback', 'download', 'draggable', 'enctype', 'enterkeyhint', 'face', 'for', 'headers', 'height', 'hidden', 'high', 'href', 'hreflang', 'id', 'inputmode', 'integrity', 'ismap', 'kind', 'label', 'lang', 'list', 'loading', 'loop', 'low', 'max', 'maxlength', 'media', 'method', 'min', 'minlength', 'multiple', 'muted', 'name', 'nonce', 'noshade', 'novalidate', 'nowrap', 'open', 'optimum', 'pattern', 'placeholder', 'playsinline', 'poster', 'preload', 'pubdate', 'radiogroup', 'readonly', 'rel', 'required', 'rev', 'reversed', 'role', 'rows', 'rowspan', 'spellcheck', 'scope', 'selected', 'shape', 'size', 'sizes', 'span', 'srclang', 'start', 'src', 'srcset', 'step', 'style', 'summary', 'tabindex', 'title', 'translate', 'type', 'usemap', 'valign', 'value', 'width', 'xmlns', 'slot']);\nconst svg = freeze(['accent-height', 'accumulate', 'additive', 'alignment-baseline', 'ascent', 'attributename', 'attributetype', 'azimuth', 'basefrequency', 'baseline-shift', 'begin', 'bias', 'by', 'class', 'clip', 'clippathunits', 'clip-path', 'clip-rule', 'color', 'color-interpolation', 'color-interpolation-filters', 'color-profile', 'color-rendering', 'cx', 'cy', 'd', 'dx', 'dy', 'diffuseconstant', 'direction', 'display', 'divisor', 'dur', 'edgemode', 'elevation', 'end', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'filterunits', 'flood-color', 'flood-opacity', 'font-family', 'font-size', 'font-size-adjust', 'font-stretch', 'font-style', 'font-variant', 'font-weight', 'fx', 'fy', 'g1', 'g2', 'glyph-name', 'glyphref', 'gradientunits', 'gradienttransform', 'height', 'href', 'id', 'image-rendering', 'in', 'in2', 'k', 'k1', 'k2', 'k3', 'k4', 'kerning', 'keypoints', 'keysplines', 'keytimes', 'lang', 'lengthadjust', 'letter-spacing', 'kernelmatrix', 'kernelunitlength', 'lighting-color', 'local', 'marker-end', 'marker-mid', 'marker-start', 'markerheight', 'markerunits', 'markerwidth', 'maskcontentunits', 'maskunits', 'max', 'mask', 'media', 'method', 'mode', 'min', 'name', 'numoctaves', 'offset', 'operator', 'opacity', 'order', 'orient', 'orientation', 'origin', 'overflow', 'paint-order', 'path', 'pathlength', 'patterncontentunits', 'patterntransform', 'patternunits', 'points', 'preservealpha', 'preserveaspectratio', 'primitiveunits', 'r', 'rx', 'ry', 'radius', 'refx', 'refy', 'repeatcount', 'repeatdur', 'restart', 'result', 'rotate', 'scale', 'seed', 'shape-rendering', 'specularconstant', 'specularexponent', 'spreadmethod', 'startoffset', 'stddeviation', 'stitchtiles', 'stop-color', 'stop-opacity', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke', 'stroke-width', 'style', 'surfacescale', 'systemlanguage', 'tabindex', 'targetx', 'targety', 'transform', 'transform-origin', 'text-anchor', 'text-decoration', 'text-rendering', 'textlength', 'type', 'u1', 'u2', 'unicode', 'values', 'viewbox', 'visibility', 'version', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'width', 'word-spacing', 'wrap', 'writing-mode', 'xchannelselector', 'ychannelselector', 'x', 'x1', 'x2', 'xmlns', 'y', 'y1', 'y2', 'z', 'zoomandpan']);\nconst mathMl = freeze(['accent', 'accentunder', 'align', 'bevelled', 'close', 'columnsalign', 'columnlines', 'columnspan', 'denomalign', 'depth', 'dir', 'display', 'displaystyle', 'encoding', 'fence', 'frame', 'height', 'href', 'id', 'largeop', 'length', 'linethickness', 'lspace', 'lquote', 'mathbackground', 'mathcolor', 'mathsize', 'mathvariant', 'maxsize', 'minsize', 'movablelimits', 'notation', 'numalign', 'open', 'rowalign', 'rowlines', 'rowspacing', 'rowspan', 'rspace', 'rquote', 'scriptlevel', 'scriptminsize', 'scriptsizemultiplier', 'selection', 'separator', 'separators', 'stretchy', 'subscriptshift', 'supscriptshift', 'symmetric', 'voffset', 'width', 'xmlns']);\nconst xml = freeze(['xlink:href', 'xml:id', 'xlink:title', 'xml:space', 'xmlns:xlink']);\n\nconst MUSTACHE_EXPR = seal(/\\{\\{[\\w\\W]*|[\\w\\W]*\\}\\}/gm); // Specify template detection regex for SAFE_FOR_TEMPLATES mode\n\nconst ERB_EXPR = seal(/<%[\\w\\W]*|[\\w\\W]*%>/gm);\nconst TMPLIT_EXPR = seal(/\\${[\\w\\W]*}/gm);\nconst DATA_ATTR = seal(/^data-[\\-\\w.\\u00B7-\\uFFFF]/); // eslint-disable-line no-useless-escape\n\nconst ARIA_ATTR = seal(/^aria-[\\-\\w]+$/); // eslint-disable-line no-useless-escape\n\nconst IS_ALLOWED_URI = seal(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\\-]+(?:[^a-z+.\\-:]|$))/i // eslint-disable-line no-useless-escape\n);\nconst IS_SCRIPT_OR_DATA = seal(/^(?:\\w+script|data):/i);\nconst ATTR_WHITESPACE = seal(/[\\u0000-\\u0020\\u00A0\\u1680\\u180E\\u2000-\\u2029\\u205F\\u3000]/g // eslint-disable-line no-control-regex\n);\nconst DOCTYPE_NAME = seal(/^html$/i);\n\nvar EXPRESSIONS = /*#__PURE__*/Object.freeze({\n  __proto__: null,\n  MUSTACHE_EXPR: MUSTACHE_EXPR,\n  ERB_EXPR: ERB_EXPR,\n  TMPLIT_EXPR: TMPLIT_EXPR,\n  DATA_ATTR: DATA_ATTR,\n  ARIA_ATTR: ARIA_ATTR,\n  IS_ALLOWED_URI: IS_ALLOWED_URI,\n  IS_SCRIPT_OR_DATA: IS_SCRIPT_OR_DATA,\n  ATTR_WHITESPACE: ATTR_WHITESPACE,\n  DOCTYPE_NAME: DOCTYPE_NAME\n});\n\nconst getGlobal = () => typeof window === 'undefined' ? null : window;\n/**\n * Creates a no-op policy for internal use only.\n * Don't export this function outside this module!\n * @param {?TrustedTypePolicyFactory} trustedTypes The policy factory.\n * @param {HTMLScriptElement} purifyHostElement The Script element used to load DOMPurify (to determine policy name suffix).\n * @return {?TrustedTypePolicy} The policy created (or null, if Trusted Types\n * are not supported or creating the policy failed).\n */\n\n\nconst _createTrustedTypesPolicy = function _createTrustedTypesPolicy(trustedTypes, purifyHostElement) {\n  if (typeof trustedTypes !== 'object' || typeof trustedTypes.createPolicy !== 'function') {\n    return null;\n  } // Allow the callers to control the unique policy name\n  // by adding a data-tt-policy-suffix to the script element with the DOMPurify.\n  // Policy creation with duplicate names throws in Trusted Types.\n\n\n  let suffix = null;\n  const ATTR_NAME = 'data-tt-policy-suffix';\n\n  if (purifyHostElement && purifyHostElement.hasAttribute(ATTR_NAME)) {\n    suffix = purifyHostElement.getAttribute(ATTR_NAME);\n  }\n\n  const policyName = 'dompurify' + (suffix ? '#' + suffix : '');\n\n  try {\n    return trustedTypes.createPolicy(policyName, {\n      createHTML(html) {\n        return html;\n      },\n\n      createScriptURL(scriptUrl) {\n        return scriptUrl;\n      }\n\n    });\n  } catch (_) {\n    // Policy creation failed (most likely another DOMPurify script has\n    // already run). Skip creating the policy, as this will only cause errors\n    // if TT are enforced.\n    console.warn('TrustedTypes policy ' + policyName + ' could not be created.');\n    return null;\n  }\n};\n\nfunction createDOMPurify() {\n  let window = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getGlobal();\n\n  const DOMPurify = root => createDOMPurify(root);\n  /**\n   * Version label, exposed for easier checks\n   * if DOMPurify is up to date or not\n   */\n\n\n  DOMPurify.version = '3.0.5';\n  /**\n   * Array of elements that DOMPurify removed during sanitation.\n   * Empty if nothing was removed.\n   */\n\n  DOMPurify.removed = [];\n\n  if (!window || !window.document || window.document.nodeType !== 9) {\n    // Not running in a browser, provide a factory function\n    // so that you can pass your own Window\n    DOMPurify.isSupported = false;\n    return DOMPurify;\n  }\n\n  const originalDocument = window.document;\n  const currentScript = originalDocument.currentScript;\n  let {\n    document\n  } = window;\n  const {\n    DocumentFragment,\n    HTMLTemplateElement,\n    Node,\n    Element,\n    NodeFilter,\n    NamedNodeMap = window.NamedNodeMap || window.MozNamedAttrMap,\n    HTMLFormElement,\n    DOMParser,\n    trustedTypes\n  } = window;\n  const ElementPrototype = Element.prototype;\n  const cloneNode = lookupGetter(ElementPrototype, 'cloneNode');\n  const getNextSibling = lookupGetter(ElementPrototype, 'nextSibling');\n  const getChildNodes = lookupGetter(ElementPrototype, 'childNodes');\n  const getParentNode = lookupGetter(ElementPrototype, 'parentNode'); // As per issue #47, the web-components registry is inherited by a\n  // new document created via createHTMLDocument. As per the spec\n  // (http://w3c.github.io/webcomponents/spec/custom/#creating-and-passing-registries)\n  // a new empty registry is used when creating a template contents owner\n  // document, so we use that as our parent document to ensure nothing\n  // is inherited.\n\n  if (typeof HTMLTemplateElement === 'function') {\n    const template = document.createElement('template');\n\n    if (template.content && template.content.ownerDocument) {\n      document = template.content.ownerDocument;\n    }\n  }\n\n  let trustedTypesPolicy;\n  let emptyHTML = '';\n  const {\n    implementation,\n    createNodeIterator,\n    createDocumentFragment,\n    getElementsByTagName\n  } = document;\n  const {\n    importNode\n  } = originalDocument;\n  let hooks = {};\n  /**\n   * Expose whether this browser supports running the full DOMPurify.\n   */\n\n  DOMPurify.isSupported = typeof entries === 'function' && typeof getParentNode === 'function' && implementation && implementation.createHTMLDocument !== undefined;\n  const {\n    MUSTACHE_EXPR,\n    ERB_EXPR,\n    TMPLIT_EXPR,\n    DATA_ATTR,\n    ARIA_ATTR,\n    IS_SCRIPT_OR_DATA,\n    ATTR_WHITESPACE\n  } = EXPRESSIONS;\n  let {\n    IS_ALLOWED_URI: IS_ALLOWED_URI$1\n  } = EXPRESSIONS;\n  /**\n   * We consider the elements and attributes below to be safe. Ideally\n   * don't add any new ones but feel free to remove unwanted ones.\n   */\n\n  /* allowed element names */\n\n  let ALLOWED_TAGS = null;\n  const DEFAULT_ALLOWED_TAGS = addToSet({}, [...html$1, ...svg$1, ...svgFilters, ...mathMl$1, ...text]);\n  /* Allowed attribute names */\n\n  let ALLOWED_ATTR = null;\n  const DEFAULT_ALLOWED_ATTR = addToSet({}, [...html, ...svg, ...mathMl, ...xml]);\n  /*\n   * Configure how DOMPUrify should handle custom elements and their attributes as well as customized built-in elements.\n   * @property {RegExp|Function|null} tagNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any custom elements)\n   * @property {RegExp|Function|null} attributeNameCheck one of [null, regexPattern, predicate]. Default: `null` (disallow any attributes not on the allow list)\n   * @property {boolean} allowCustomizedBuiltInElements allow custom elements derived from built-ins if they pass CUSTOM_ELEMENT_HANDLING.tagNameCheck. Default: `false`.\n   */\n\n  let CUSTOM_ELEMENT_HANDLING = Object.seal(Object.create(null, {\n    tagNameCheck: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: null\n    },\n    attributeNameCheck: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: null\n    },\n    allowCustomizedBuiltInElements: {\n      writable: true,\n      configurable: false,\n      enumerable: true,\n      value: false\n    }\n  }));\n  /* Explicitly forbidden tags (overrides ALLOWED_TAGS/ADD_TAGS) */\n\n  let FORBID_TAGS = null;\n  /* Explicitly forbidden attributes (overrides ALLOWED_ATTR/ADD_ATTR) */\n\n  let FORBID_ATTR = null;\n  /* Decide if ARIA attributes are okay */\n\n  let ALLOW_ARIA_ATTR = true;\n  /* Decide if custom data attributes are okay */\n\n  let ALLOW_DATA_ATTR = true;\n  /* Decide if unknown protocols are okay */\n\n  let ALLOW_UNKNOWN_PROTOCOLS = false;\n  /* Decide if self-closing tags in attributes are allowed.\n   * Usually removed due to a mXSS issue in jQuery 3.0 */\n\n  let ALLOW_SELF_CLOSE_IN_ATTR = true;\n  /* Output should be safe for common template engines.\n   * This means, DOMPurify removes data attributes, mustaches and ERB\n   */\n\n  let SAFE_FOR_TEMPLATES = false;\n  /* Decide if document with <html>... should be returned */\n\n  let WHOLE_DOCUMENT = false;\n  /* Track whether config is already set on this instance of DOMPurify. */\n\n  let SET_CONFIG = false;\n  /* Decide if all elements (e.g. style, script) must be children of\n   * document.body. By default, browsers might move them to document.head */\n\n  let FORCE_BODY = false;\n  /* Decide if a DOM `HTMLBodyElement` should be returned, instead of a html\n   * string (or a TrustedHTML object if Trusted Types are supported).\n   * If `WHOLE_DOCUMENT` is enabled a `HTMLHtmlElement` will be returned instead\n   */\n\n  let RETURN_DOM = false;\n  /* Decide if a DOM `DocumentFragment` should be returned, instead of a html\n   * string  (or a TrustedHTML object if Trusted Types are supported) */\n\n  let RETURN_DOM_FRAGMENT = false;\n  /* Try to return a Trusted Type object instead of a string, return a string in\n   * case Trusted Types are not supported  */\n\n  let RETURN_TRUSTED_TYPE = false;\n  /* Output should be free from DOM clobbering attacks?\n   * This sanitizes markups named with colliding, clobberable built-in DOM APIs.\n   */\n\n  let SANITIZE_DOM = true;\n  /* Achieve full DOM Clobbering protection by isolating the namespace of named\n   * properties and JS variables, mitigating attacks that abuse the HTML/DOM spec rules.\n   *\n   * HTML/DOM spec rules that enable DOM Clobbering:\n   *   - Named Access on Window (§7.3.3)\n   *   - DOM Tree Accessors (§3.1.5)\n   *   - Form Element Parent-Child Relations (§4.10.3)\n   *   - Iframe srcdoc / Nested WindowProxies (§4.8.5)\n   *   - HTMLCollection (§4.2.10.2)\n   *\n   * Namespace isolation is implemented by prefixing `id` and `name` attributes\n   * with a constant string, i.e., `user-content-`\n   */\n\n  let SANITIZE_NAMED_PROPS = false;\n  const SANITIZE_NAMED_PROPS_PREFIX = 'user-content-';\n  /* Keep element content when removing element? */\n\n  let KEEP_CONTENT = true;\n  /* If a `Node` is passed to sanitize(), then performs sanitization in-place instead\n   * of importing it into a new Document and returning a sanitized copy */\n\n  let IN_PLACE = false;\n  /* Allow usage of profiles like html, svg and mathMl */\n\n  let USE_PROFILES = {};\n  /* Tags to ignore content of when KEEP_CONTENT is true */\n\n  let FORBID_CONTENTS = null;\n  const DEFAULT_FORBID_CONTENTS = addToSet({}, ['annotation-xml', 'audio', 'colgroup', 'desc', 'foreignobject', 'head', 'iframe', 'math', 'mi', 'mn', 'mo', 'ms', 'mtext', 'noembed', 'noframes', 'noscript', 'plaintext', 'script', 'style', 'svg', 'template', 'thead', 'title', 'video', 'xmp']);\n  /* Tags that are safe for data: URIs */\n\n  let DATA_URI_TAGS = null;\n  const DEFAULT_DATA_URI_TAGS = addToSet({}, ['audio', 'video', 'img', 'source', 'image', 'track']);\n  /* Attributes safe for values like \"javascript:\" */\n\n  let URI_SAFE_ATTRIBUTES = null;\n  const DEFAULT_URI_SAFE_ATTRIBUTES = addToSet({}, ['alt', 'class', 'for', 'id', 'label', 'name', 'pattern', 'placeholder', 'role', 'summary', 'title', 'value', 'style', 'xmlns']);\n  const MATHML_NAMESPACE = 'http://www.w3.org/1998/Math/MathML';\n  const SVG_NAMESPACE = 'http://www.w3.org/2000/svg';\n  const HTML_NAMESPACE = 'http://www.w3.org/1999/xhtml';\n  /* Document namespace */\n\n  let NAMESPACE = HTML_NAMESPACE;\n  let IS_EMPTY_INPUT = false;\n  /* Allowed XHTML+XML namespaces */\n\n  let ALLOWED_NAMESPACES = null;\n  const DEFAULT_ALLOWED_NAMESPACES = addToSet({}, [MATHML_NAMESPACE, SVG_NAMESPACE, HTML_NAMESPACE], stringToString);\n  /* Parsing of strict XHTML documents */\n\n  let PARSER_MEDIA_TYPE;\n  const SUPPORTED_PARSER_MEDIA_TYPES = ['application/xhtml+xml', 'text/html'];\n  const DEFAULT_PARSER_MEDIA_TYPE = 'text/html';\n  let transformCaseFunc;\n  /* Keep a reference to config to pass to hooks */\n\n  let CONFIG = null;\n  /* Ideally, do not touch anything below this line */\n\n  /* ______________________________________________ */\n\n  const formElement = document.createElement('form');\n\n  const isRegexOrFunction = function isRegexOrFunction(testValue) {\n    return testValue instanceof RegExp || testValue instanceof Function;\n  };\n  /**\n   * _parseConfig\n   *\n   * @param  {Object} cfg optional config literal\n   */\n  // eslint-disable-next-line complexity\n\n\n  const _parseConfig = function _parseConfig(cfg) {\n    if (CONFIG && CONFIG === cfg) {\n      return;\n    }\n    /* Shield configuration object from tampering */\n\n\n    if (!cfg || typeof cfg !== 'object') {\n      cfg = {};\n    }\n    /* Shield configuration object from prototype pollution */\n\n\n    cfg = clone(cfg);\n    PARSER_MEDIA_TYPE = // eslint-disable-next-line unicorn/prefer-includes\n    SUPPORTED_PARSER_MEDIA_TYPES.indexOf(cfg.PARSER_MEDIA_TYPE) === -1 ? PARSER_MEDIA_TYPE = DEFAULT_PARSER_MEDIA_TYPE : PARSER_MEDIA_TYPE = cfg.PARSER_MEDIA_TYPE; // HTML tags and attributes are not case-sensitive, converting to lowercase. Keeping XHTML as is.\n\n    transformCaseFunc = PARSER_MEDIA_TYPE === 'application/xhtml+xml' ? stringToString : stringToLowerCase;\n    /* Set configuration parameters */\n\n    ALLOWED_TAGS = 'ALLOWED_TAGS' in cfg ? addToSet({}, cfg.ALLOWED_TAGS, transformCaseFunc) : DEFAULT_ALLOWED_TAGS;\n    ALLOWED_ATTR = 'ALLOWED_ATTR' in cfg ? addToSet({}, cfg.ALLOWED_ATTR, transformCaseFunc) : DEFAULT_ALLOWED_ATTR;\n    ALLOWED_NAMESPACES = 'ALLOWED_NAMESPACES' in cfg ? addToSet({}, cfg.ALLOWED_NAMESPACES, stringToString) : DEFAULT_ALLOWED_NAMESPACES;\n    URI_SAFE_ATTRIBUTES = 'ADD_URI_SAFE_ATTR' in cfg ? addToSet(clone(DEFAULT_URI_SAFE_ATTRIBUTES), // eslint-disable-line indent\n    cfg.ADD_URI_SAFE_ATTR, // eslint-disable-line indent\n    transformCaseFunc // eslint-disable-line indent\n    ) // eslint-disable-line indent\n    : DEFAULT_URI_SAFE_ATTRIBUTES;\n    DATA_URI_TAGS = 'ADD_DATA_URI_TAGS' in cfg ? addToSet(clone(DEFAULT_DATA_URI_TAGS), // eslint-disable-line indent\n    cfg.ADD_DATA_URI_TAGS, // eslint-disable-line indent\n    transformCaseFunc // eslint-disable-line indent\n    ) // eslint-disable-line indent\n    : DEFAULT_DATA_URI_TAGS;\n    FORBID_CONTENTS = 'FORBID_CONTENTS' in cfg ? addToSet({}, cfg.FORBID_CONTENTS, transformCaseFunc) : DEFAULT_FORBID_CONTENTS;\n    FORBID_TAGS = 'FORBID_TAGS' in cfg ? addToSet({}, cfg.FORBID_TAGS, transformCaseFunc) : {};\n    FORBID_ATTR = 'FORBID_ATTR' in cfg ? addToSet({}, cfg.FORBID_ATTR, transformCaseFunc) : {};\n    USE_PROFILES = 'USE_PROFILES' in cfg ? cfg.USE_PROFILES : false;\n    ALLOW_ARIA_ATTR = cfg.ALLOW_ARIA_ATTR !== false; // Default true\n\n    ALLOW_DATA_ATTR = cfg.ALLOW_DATA_ATTR !== false; // Default true\n\n    ALLOW_UNKNOWN_PROTOCOLS = cfg.ALLOW_UNKNOWN_PROTOCOLS || false; // Default false\n\n    ALLOW_SELF_CLOSE_IN_ATTR = cfg.ALLOW_SELF_CLOSE_IN_ATTR !== false; // Default true\n\n    SAFE_FOR_TEMPLATES = cfg.SAFE_FOR_TEMPLATES || false; // Default false\n\n    WHOLE_DOCUMENT = cfg.WHOLE_DOCUMENT || false; // Default false\n\n    RETURN_DOM = cfg.RETURN_DOM || false; // Default false\n\n    RETURN_DOM_FRAGMENT = cfg.RETURN_DOM_FRAGMENT || false; // Default false\n\n    RETURN_TRUSTED_TYPE = cfg.RETURN_TRUSTED_TYPE || false; // Default false\n\n    FORCE_BODY = cfg.FORCE_BODY || false; // Default false\n\n    SANITIZE_DOM = cfg.SANITIZE_DOM !== false; // Default true\n\n    SANITIZE_NAMED_PROPS = cfg.SANITIZE_NAMED_PROPS || false; // Default false\n\n    KEEP_CONTENT = cfg.KEEP_CONTENT !== false; // Default true\n\n    IN_PLACE = cfg.IN_PLACE || false; // Default false\n\n    IS_ALLOWED_URI$1 = cfg.ALLOWED_URI_REGEXP || IS_ALLOWED_URI;\n    NAMESPACE = cfg.NAMESPACE || HTML_NAMESPACE;\n    CUSTOM_ELEMENT_HANDLING = cfg.CUSTOM_ELEMENT_HANDLING || {};\n\n    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck)) {\n      CUSTOM_ELEMENT_HANDLING.tagNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.tagNameCheck;\n    }\n\n    if (cfg.CUSTOM_ELEMENT_HANDLING && isRegexOrFunction(cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)) {\n      CUSTOM_ELEMENT_HANDLING.attributeNameCheck = cfg.CUSTOM_ELEMENT_HANDLING.attributeNameCheck;\n    }\n\n    if (cfg.CUSTOM_ELEMENT_HANDLING && typeof cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements === 'boolean') {\n      CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements = cfg.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements;\n    }\n\n    if (SAFE_FOR_TEMPLATES) {\n      ALLOW_DATA_ATTR = false;\n    }\n\n    if (RETURN_DOM_FRAGMENT) {\n      RETURN_DOM = true;\n    }\n    /* Parse profile info */\n\n\n    if (USE_PROFILES) {\n      ALLOWED_TAGS = addToSet({}, [...text]);\n      ALLOWED_ATTR = [];\n\n      if (USE_PROFILES.html === true) {\n        addToSet(ALLOWED_TAGS, html$1);\n        addToSet(ALLOWED_ATTR, html);\n      }\n\n      if (USE_PROFILES.svg === true) {\n        addToSet(ALLOWED_TAGS, svg$1);\n        addToSet(ALLOWED_ATTR, svg);\n        addToSet(ALLOWED_ATTR, xml);\n      }\n\n      if (USE_PROFILES.svgFilters === true) {\n        addToSet(ALLOWED_TAGS, svgFilters);\n        addToSet(ALLOWED_ATTR, svg);\n        addToSet(ALLOWED_ATTR, xml);\n      }\n\n      if (USE_PROFILES.mathMl === true) {\n        addToSet(ALLOWED_TAGS, mathMl$1);\n        addToSet(ALLOWED_ATTR, mathMl);\n        addToSet(ALLOWED_ATTR, xml);\n      }\n    }\n    /* Merge configuration parameters */\n\n\n    if (cfg.ADD_TAGS) {\n      if (ALLOWED_TAGS === DEFAULT_ALLOWED_TAGS) {\n        ALLOWED_TAGS = clone(ALLOWED_TAGS);\n      }\n\n      addToSet(ALLOWED_TAGS, cfg.ADD_TAGS, transformCaseFunc);\n    }\n\n    if (cfg.ADD_ATTR) {\n      if (ALLOWED_ATTR === DEFAULT_ALLOWED_ATTR) {\n        ALLOWED_ATTR = clone(ALLOWED_ATTR);\n      }\n\n      addToSet(ALLOWED_ATTR, cfg.ADD_ATTR, transformCaseFunc);\n    }\n\n    if (cfg.ADD_URI_SAFE_ATTR) {\n      addToSet(URI_SAFE_ATTRIBUTES, cfg.ADD_URI_SAFE_ATTR, transformCaseFunc);\n    }\n\n    if (cfg.FORBID_CONTENTS) {\n      if (FORBID_CONTENTS === DEFAULT_FORBID_CONTENTS) {\n        FORBID_CONTENTS = clone(FORBID_CONTENTS);\n      }\n\n      addToSet(FORBID_CONTENTS, cfg.FORBID_CONTENTS, transformCaseFunc);\n    }\n    /* Add #text in case KEEP_CONTENT is set to true */\n\n\n    if (KEEP_CONTENT) {\n      ALLOWED_TAGS['#text'] = true;\n    }\n    /* Add html, head and body to ALLOWED_TAGS in case WHOLE_DOCUMENT is true */\n\n\n    if (WHOLE_DOCUMENT) {\n      addToSet(ALLOWED_TAGS, ['html', 'head', 'body']);\n    }\n    /* Add tbody to ALLOWED_TAGS in case tables are permitted, see #286, #365 */\n\n\n    if (ALLOWED_TAGS.table) {\n      addToSet(ALLOWED_TAGS, ['tbody']);\n      delete FORBID_TAGS.tbody;\n    }\n\n    if (cfg.TRUSTED_TYPES_POLICY) {\n      if (typeof cfg.TRUSTED_TYPES_POLICY.createHTML !== 'function') {\n        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a \"createHTML\" hook.');\n      }\n\n      if (typeof cfg.TRUSTED_TYPES_POLICY.createScriptURL !== 'function') {\n        throw typeErrorCreate('TRUSTED_TYPES_POLICY configuration option must provide a \"createScriptURL\" hook.');\n      } // Overwrite existing TrustedTypes policy.\n\n\n      trustedTypesPolicy = cfg.TRUSTED_TYPES_POLICY; // Sign local variables required by `sanitize`.\n\n      emptyHTML = trustedTypesPolicy.createHTML('');\n    } else {\n      // Uninitialized policy, attempt to initialize the internal dompurify policy.\n      if (trustedTypesPolicy === undefined) {\n        trustedTypesPolicy = _createTrustedTypesPolicy(trustedTypes, currentScript);\n      } // If creating the internal policy succeeded sign internal variables.\n\n\n      if (trustedTypesPolicy !== null && typeof emptyHTML === 'string') {\n        emptyHTML = trustedTypesPolicy.createHTML('');\n      }\n    } // Prevent further manipulation of configuration.\n    // Not available in IE8, Safari 5, etc.\n\n\n    if (freeze) {\n      freeze(cfg);\n    }\n\n    CONFIG = cfg;\n  };\n\n  const MATHML_TEXT_INTEGRATION_POINTS = addToSet({}, ['mi', 'mo', 'mn', 'ms', 'mtext']);\n  const HTML_INTEGRATION_POINTS = addToSet({}, ['foreignobject', 'desc', 'title', 'annotation-xml']); // Certain elements are allowed in both SVG and HTML\n  // namespace. We need to specify them explicitly\n  // so that they don't get erroneously deleted from\n  // HTML namespace.\n\n  const COMMON_SVG_AND_HTML_ELEMENTS = addToSet({}, ['title', 'style', 'font', 'a', 'script']);\n  /* Keep track of all possible SVG and MathML tags\n   * so that we can perform the namespace checks\n   * correctly. */\n\n  const ALL_SVG_TAGS = addToSet({}, svg$1);\n  addToSet(ALL_SVG_TAGS, svgFilters);\n  addToSet(ALL_SVG_TAGS, svgDisallowed);\n  const ALL_MATHML_TAGS = addToSet({}, mathMl$1);\n  addToSet(ALL_MATHML_TAGS, mathMlDisallowed);\n  /**\n   *\n   *\n   * @param  {Element} element a DOM element whose namespace is being checked\n   * @returns {boolean} Return false if the element has a\n   *  namespace that a spec-compliant parser would never\n   *  return. Return true otherwise.\n   */\n\n  const _checkValidNamespace = function _checkValidNamespace(element) {\n    let parent = getParentNode(element); // In JSDOM, if we're inside shadow DOM, then parentNode\n    // can be null. We just simulate parent in this case.\n\n    if (!parent || !parent.tagName) {\n      parent = {\n        namespaceURI: NAMESPACE,\n        tagName: 'template'\n      };\n    }\n\n    const tagName = stringToLowerCase(element.tagName);\n    const parentTagName = stringToLowerCase(parent.tagName);\n\n    if (!ALLOWED_NAMESPACES[element.namespaceURI]) {\n      return false;\n    }\n\n    if (element.namespaceURI === SVG_NAMESPACE) {\n      // The only way to switch from HTML namespace to SVG\n      // is via <svg>. If it happens via any other tag, then\n      // it should be killed.\n      if (parent.namespaceURI === HTML_NAMESPACE) {\n        return tagName === 'svg';\n      } // The only way to switch from MathML to SVG is via`\n      // svg if parent is either <annotation-xml> or MathML\n      // text integration points.\n\n\n      if (parent.namespaceURI === MATHML_NAMESPACE) {\n        return tagName === 'svg' && (parentTagName === 'annotation-xml' || MATHML_TEXT_INTEGRATION_POINTS[parentTagName]);\n      } // We only allow elements that are defined in SVG\n      // spec. All others are disallowed in SVG namespace.\n\n\n      return Boolean(ALL_SVG_TAGS[tagName]);\n    }\n\n    if (element.namespaceURI === MATHML_NAMESPACE) {\n      // The only way to switch from HTML namespace to MathML\n      // is via <math>. If it happens via any other tag, then\n      // it should be killed.\n      if (parent.namespaceURI === HTML_NAMESPACE) {\n        return tagName === 'math';\n      } // The only way to switch from SVG to MathML is via\n      // <math> and HTML integration points\n\n\n      if (parent.namespaceURI === SVG_NAMESPACE) {\n        return tagName === 'math' && HTML_INTEGRATION_POINTS[parentTagName];\n      } // We only allow elements that are defined in MathML\n      // spec. All others are disallowed in MathML namespace.\n\n\n      return Boolean(ALL_MATHML_TAGS[tagName]);\n    }\n\n    if (element.namespaceURI === HTML_NAMESPACE) {\n      // The only way to switch from SVG to HTML is via\n      // HTML integration points, and from MathML to HTML\n      // is via MathML text integration points\n      if (parent.namespaceURI === SVG_NAMESPACE && !HTML_INTEGRATION_POINTS[parentTagName]) {\n        return false;\n      }\n\n      if (parent.namespaceURI === MATHML_NAMESPACE && !MATHML_TEXT_INTEGRATION_POINTS[parentTagName]) {\n        return false;\n      } // We disallow tags that are specific for MathML\n      // or SVG and should never appear in HTML namespace\n\n\n      return !ALL_MATHML_TAGS[tagName] && (COMMON_SVG_AND_HTML_ELEMENTS[tagName] || !ALL_SVG_TAGS[tagName]);\n    } // For XHTML and XML documents that support custom namespaces\n\n\n    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && ALLOWED_NAMESPACES[element.namespaceURI]) {\n      return true;\n    } // The code should never reach this place (this means\n    // that the element somehow got namespace that is not\n    // HTML, SVG, MathML or allowed via ALLOWED_NAMESPACES).\n    // Return false just in case.\n\n\n    return false;\n  };\n  /**\n   * _forceRemove\n   *\n   * @param  {Node} node a DOM node\n   */\n\n\n  const _forceRemove = function _forceRemove(node) {\n    arrayPush(DOMPurify.removed, {\n      element: node\n    });\n\n    try {\n      // eslint-disable-next-line unicorn/prefer-dom-node-remove\n      node.parentNode.removeChild(node);\n    } catch (_) {\n      node.remove();\n    }\n  };\n  /**\n   * _removeAttribute\n   *\n   * @param  {String} name an Attribute name\n   * @param  {Node} node a DOM node\n   */\n\n\n  const _removeAttribute = function _removeAttribute(name, node) {\n    try {\n      arrayPush(DOMPurify.removed, {\n        attribute: node.getAttributeNode(name),\n        from: node\n      });\n    } catch (_) {\n      arrayPush(DOMPurify.removed, {\n        attribute: null,\n        from: node\n      });\n    }\n\n    node.removeAttribute(name); // We void attribute values for unremovable \"is\"\" attributes\n\n    if (name === 'is' && !ALLOWED_ATTR[name]) {\n      if (RETURN_DOM || RETURN_DOM_FRAGMENT) {\n        try {\n          _forceRemove(node);\n        } catch (_) {}\n      } else {\n        try {\n          node.setAttribute(name, '');\n        } catch (_) {}\n      }\n    }\n  };\n  /**\n   * _initDocument\n   *\n   * @param  {String} dirty a string of dirty markup\n   * @return {Document} a DOM, filled with the dirty markup\n   */\n\n\n  const _initDocument = function _initDocument(dirty) {\n    /* Create a HTML document */\n    let doc;\n    let leadingWhitespace;\n\n    if (FORCE_BODY) {\n      dirty = '<remove></remove>' + dirty;\n    } else {\n      /* If FORCE_BODY isn't used, leading whitespace needs to be preserved manually */\n      const matches = stringMatch(dirty, /^[\\r\\n\\t ]+/);\n      leadingWhitespace = matches && matches[0];\n    }\n\n    if (PARSER_MEDIA_TYPE === 'application/xhtml+xml' && NAMESPACE === HTML_NAMESPACE) {\n      // Root of XHTML doc must contain xmlns declaration (see https://www.w3.org/TR/xhtml1/normative.html#strict)\n      dirty = '<html xmlns=\"http://www.w3.org/1999/xhtml\"><head></head><body>' + dirty + '</body></html>';\n    }\n\n    const dirtyPayload = trustedTypesPolicy ? trustedTypesPolicy.createHTML(dirty) : dirty;\n    /*\n     * Use the DOMParser API by default, fallback later if needs be\n     * DOMParser not work for svg when has multiple root element.\n     */\n\n    if (NAMESPACE === HTML_NAMESPACE) {\n      try {\n        doc = new DOMParser().parseFromString(dirtyPayload, PARSER_MEDIA_TYPE);\n      } catch (_) {}\n    }\n    /* Use createHTMLDocument in case DOMParser is not available */\n\n\n    if (!doc || !doc.documentElement) {\n      doc = implementation.createDocument(NAMESPACE, 'template', null);\n\n      try {\n        doc.documentElement.innerHTML = IS_EMPTY_INPUT ? emptyHTML : dirtyPayload;\n      } catch (_) {// Syntax error if dirtyPayload is invalid xml\n      }\n    }\n\n    const body = doc.body || doc.documentElement;\n\n    if (dirty && leadingWhitespace) {\n      body.insertBefore(document.createTextNode(leadingWhitespace), body.childNodes[0] || null);\n    }\n    /* Work on whole document or just its body */\n\n\n    if (NAMESPACE === HTML_NAMESPACE) {\n      return getElementsByTagName.call(doc, WHOLE_DOCUMENT ? 'html' : 'body')[0];\n    }\n\n    return WHOLE_DOCUMENT ? doc.documentElement : body;\n  };\n  /**\n   * _createIterator\n   *\n   * @param  {Document} root document/fragment to create iterator for\n   * @return {Iterator} iterator instance\n   */\n\n\n  const _createIterator = function _createIterator(root) {\n    return createNodeIterator.call(root.ownerDocument || root, root, // eslint-disable-next-line no-bitwise\n    NodeFilter.SHOW_ELEMENT | NodeFilter.SHOW_COMMENT | NodeFilter.SHOW_TEXT, null, false);\n  };\n  /**\n   * _isClobbered\n   *\n   * @param  {Node} elm element to check for clobbering attacks\n   * @return {Boolean} true if clobbered, false if safe\n   */\n\n\n  const _isClobbered = function _isClobbered(elm) {\n    return elm instanceof HTMLFormElement && (typeof elm.nodeName !== 'string' || typeof elm.textContent !== 'string' || typeof elm.removeChild !== 'function' || !(elm.attributes instanceof NamedNodeMap) || typeof elm.removeAttribute !== 'function' || typeof elm.setAttribute !== 'function' || typeof elm.namespaceURI !== 'string' || typeof elm.insertBefore !== 'function' || typeof elm.hasChildNodes !== 'function');\n  };\n  /**\n   * _isNode\n   *\n   * @param  {Node} obj object to check whether it's a DOM node\n   * @return {Boolean} true is object is a DOM node\n   */\n\n\n  const _isNode = function _isNode(object) {\n    return typeof Node === 'object' ? object instanceof Node : object && typeof object === 'object' && typeof object.nodeType === 'number' && typeof object.nodeName === 'string';\n  };\n  /**\n   * _executeHook\n   * Execute user configurable hooks\n   *\n   * @param  {String} entryPoint  Name of the hook's entry point\n   * @param  {Node} currentNode node to work on with the hook\n   * @param  {Object} data additional hook parameters\n   */\n\n\n  const _executeHook = function _executeHook(entryPoint, currentNode, data) {\n    if (!hooks[entryPoint]) {\n      return;\n    }\n\n    arrayForEach(hooks[entryPoint], hook => {\n      hook.call(DOMPurify, currentNode, data, CONFIG);\n    });\n  };\n  /**\n   * _sanitizeElements\n   *\n   * @protect nodeName\n   * @protect textContent\n   * @protect removeChild\n   *\n   * @param   {Node} currentNode to check for permission to exist\n   * @return  {Boolean} true if node was killed, false if left alive\n   */\n\n\n  const _sanitizeElements = function _sanitizeElements(currentNode) {\n    let content;\n    /* Execute a hook if present */\n\n    _executeHook('beforeSanitizeElements', currentNode, null);\n    /* Check if element is clobbered or can clobber */\n\n\n    if (_isClobbered(currentNode)) {\n      _forceRemove(currentNode);\n\n      return true;\n    }\n    /* Now let's check the element's type and name */\n\n\n    const tagName = transformCaseFunc(currentNode.nodeName);\n    /* Execute a hook if present */\n\n    _executeHook('uponSanitizeElement', currentNode, {\n      tagName,\n      allowedTags: ALLOWED_TAGS\n    });\n    /* Detect mXSS attempts abusing namespace confusion */\n\n\n    if (currentNode.hasChildNodes() && !_isNode(currentNode.firstElementChild) && (!_isNode(currentNode.content) || !_isNode(currentNode.content.firstElementChild)) && regExpTest(/<[/\\w]/g, currentNode.innerHTML) && regExpTest(/<[/\\w]/g, currentNode.textContent)) {\n      _forceRemove(currentNode);\n\n      return true;\n    }\n    /* Remove element if anything forbids its presence */\n\n\n    if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {\n      /* Check if we have a custom element to handle */\n      if (!FORBID_TAGS[tagName] && _basicCustomElementTest(tagName)) {\n        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, tagName)) return false;\n        if (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(tagName)) return false;\n      }\n      /* Keep content except for bad-listed elements */\n\n\n      if (KEEP_CONTENT && !FORBID_CONTENTS[tagName]) {\n        const parentNode = getParentNode(currentNode) || currentNode.parentNode;\n        const childNodes = getChildNodes(currentNode) || currentNode.childNodes;\n\n        if (childNodes && parentNode) {\n          const childCount = childNodes.length;\n\n          for (let i = childCount - 1; i >= 0; --i) {\n            parentNode.insertBefore(cloneNode(childNodes[i], true), getNextSibling(currentNode));\n          }\n        }\n      }\n\n      _forceRemove(currentNode);\n\n      return true;\n    }\n    /* Check whether element has a valid namespace */\n\n\n    if (currentNode instanceof Element && !_checkValidNamespace(currentNode)) {\n      _forceRemove(currentNode);\n\n      return true;\n    }\n    /* Make sure that older browsers don't get fallback-tag mXSS */\n\n\n    if ((tagName === 'noscript' || tagName === 'noembed' || tagName === 'noframes') && regExpTest(/<\\/no(script|embed|frames)/i, currentNode.innerHTML)) {\n      _forceRemove(currentNode);\n\n      return true;\n    }\n    /* Sanitize element content to be template-safe */\n\n\n    if (SAFE_FOR_TEMPLATES && currentNode.nodeType === 3) {\n      /* Get the element's text content */\n      content = currentNode.textContent;\n      content = stringReplace(content, MUSTACHE_EXPR, ' ');\n      content = stringReplace(content, ERB_EXPR, ' ');\n      content = stringReplace(content, TMPLIT_EXPR, ' ');\n\n      if (currentNode.textContent !== content) {\n        arrayPush(DOMPurify.removed, {\n          element: currentNode.cloneNode()\n        });\n        currentNode.textContent = content;\n      }\n    }\n    /* Execute a hook if present */\n\n\n    _executeHook('afterSanitizeElements', currentNode, null);\n\n    return false;\n  };\n  /**\n   * _isValidAttribute\n   *\n   * @param  {string} lcTag Lowercase tag name of containing element.\n   * @param  {string} lcName Lowercase attribute name.\n   * @param  {string} value Attribute value.\n   * @return {Boolean} Returns true if `value` is valid, otherwise false.\n   */\n  // eslint-disable-next-line complexity\n\n\n  const _isValidAttribute = function _isValidAttribute(lcTag, lcName, value) {\n    /* Make sure attribute cannot clobber */\n    if (SANITIZE_DOM && (lcName === 'id' || lcName === 'name') && (value in document || value in formElement)) {\n      return false;\n    }\n    /* Allow valid data-* attributes: At least one character after \"-\"\n        (https://html.spec.whatwg.org/multipage/dom.html#embedding-custom-non-visible-data-with-the-data-*-attributes)\n        XML-compatible (https://html.spec.whatwg.org/multipage/infrastructure.html#xml-compatible and http://www.w3.org/TR/xml/#d0e804)\n        We don't need to check the value; it's always URI safe. */\n\n\n    if (ALLOW_DATA_ATTR && !FORBID_ATTR[lcName] && regExpTest(DATA_ATTR, lcName)) ; else if (ALLOW_ARIA_ATTR && regExpTest(ARIA_ATTR, lcName)) ; else if (!ALLOWED_ATTR[lcName] || FORBID_ATTR[lcName]) {\n      if ( // First condition does a very basic check if a) it's basically a valid custom element tagname AND\n      // b) if the tagName passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n      // and c) if the attribute name passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.attributeNameCheck\n      _basicCustomElementTest(lcTag) && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, lcTag) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(lcTag)) && (CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.attributeNameCheck, lcName) || CUSTOM_ELEMENT_HANDLING.attributeNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.attributeNameCheck(lcName)) || // Alternative, second condition checks if it's an `is`-attribute, AND\n      // the value passes whatever the user has configured for CUSTOM_ELEMENT_HANDLING.tagNameCheck\n      lcName === 'is' && CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements && (CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof RegExp && regExpTest(CUSTOM_ELEMENT_HANDLING.tagNameCheck, value) || CUSTOM_ELEMENT_HANDLING.tagNameCheck instanceof Function && CUSTOM_ELEMENT_HANDLING.tagNameCheck(value))) ; else {\n        return false;\n      }\n      /* Check value is safe. First, is attr inert? If so, is safe */\n\n    } else if (URI_SAFE_ATTRIBUTES[lcName]) ; else if (regExpTest(IS_ALLOWED_URI$1, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if ((lcName === 'src' || lcName === 'xlink:href' || lcName === 'href') && lcTag !== 'script' && stringIndexOf(value, 'data:') === 0 && DATA_URI_TAGS[lcTag]) ; else if (ALLOW_UNKNOWN_PROTOCOLS && !regExpTest(IS_SCRIPT_OR_DATA, stringReplace(value, ATTR_WHITESPACE, ''))) ; else if (value) {\n      return false;\n    } else ;\n\n    return true;\n  };\n  /**\n   * _basicCustomElementCheck\n   * checks if at least one dash is included in tagName, and it's not the first char\n   * for more sophisticated checking see https://github.com/sindresorhus/validate-element-name\n   * @param {string} tagName name of the tag of the node to sanitize\n   */\n\n\n  const _basicCustomElementTest = function _basicCustomElementTest(tagName) {\n    return tagName.indexOf('-') > 0;\n  };\n  /**\n   * _sanitizeAttributes\n   *\n   * @protect attributes\n   * @protect nodeName\n   * @protect removeAttribute\n   * @protect setAttribute\n   *\n   * @param  {Node} currentNode to sanitize\n   */\n\n\n  const _sanitizeAttributes = function _sanitizeAttributes(currentNode) {\n    let attr;\n    let value;\n    let lcName;\n    let l;\n    /* Execute a hook if present */\n\n    _executeHook('beforeSanitizeAttributes', currentNode, null);\n\n    const {\n      attributes\n    } = currentNode;\n    /* Check if we have attributes; if not we might have a text node */\n\n    if (!attributes) {\n      return;\n    }\n\n    const hookEvent = {\n      attrName: '',\n      attrValue: '',\n      keepAttr: true,\n      allowedAttributes: ALLOWED_ATTR\n    };\n    l = attributes.length;\n    /* Go backwards over all attributes; safely remove bad ones */\n\n    while (l--) {\n      attr = attributes[l];\n      const {\n        name,\n        namespaceURI\n      } = attr;\n      value = name === 'value' ? attr.value : stringTrim(attr.value);\n      lcName = transformCaseFunc(name);\n      /* Execute a hook if present */\n\n      hookEvent.attrName = lcName;\n      hookEvent.attrValue = value;\n      hookEvent.keepAttr = true;\n      hookEvent.forceKeepAttr = undefined; // Allows developers to see this is a property they can set\n\n      _executeHook('uponSanitizeAttribute', currentNode, hookEvent);\n\n      value = hookEvent.attrValue;\n      /* Did the hooks approve of the attribute? */\n\n      if (hookEvent.forceKeepAttr) {\n        continue;\n      }\n      /* Remove attribute */\n\n\n      _removeAttribute(name, currentNode);\n      /* Did the hooks approve of the attribute? */\n\n\n      if (!hookEvent.keepAttr) {\n        continue;\n      }\n      /* Work around a security issue in jQuery 3.0 */\n\n\n      if (!ALLOW_SELF_CLOSE_IN_ATTR && regExpTest(/\\/>/i, value)) {\n        _removeAttribute(name, currentNode);\n\n        continue;\n      }\n      /* Sanitize attribute content to be template-safe */\n\n\n      if (SAFE_FOR_TEMPLATES) {\n        value = stringReplace(value, MUSTACHE_EXPR, ' ');\n        value = stringReplace(value, ERB_EXPR, ' ');\n        value = stringReplace(value, TMPLIT_EXPR, ' ');\n      }\n      /* Is `value` valid for this attribute? */\n\n\n      const lcTag = transformCaseFunc(currentNode.nodeName);\n\n      if (!_isValidAttribute(lcTag, lcName, value)) {\n        continue;\n      }\n      /* Full DOM Clobbering protection via namespace isolation,\n       * Prefix id and name attributes with `user-content-`\n       */\n\n\n      if (SANITIZE_NAMED_PROPS && (lcName === 'id' || lcName === 'name')) {\n        // Remove the attribute with this value\n        _removeAttribute(name, currentNode); // Prefix the value and later re-create the attribute with the sanitized value\n\n\n        value = SANITIZE_NAMED_PROPS_PREFIX + value;\n      }\n      /* Handle attributes that require Trusted Types */\n\n\n      if (trustedTypesPolicy && typeof trustedTypes === 'object' && typeof trustedTypes.getAttributeType === 'function') {\n        if (namespaceURI) ; else {\n          switch (trustedTypes.getAttributeType(lcTag, lcName)) {\n            case 'TrustedHTML':\n              {\n                value = trustedTypesPolicy.createHTML(value);\n                break;\n              }\n\n            case 'TrustedScriptURL':\n              {\n                value = trustedTypesPolicy.createScriptURL(value);\n                break;\n              }\n          }\n        }\n      }\n      /* Handle invalid data-* attribute set by try-catching it */\n\n\n      try {\n        if (namespaceURI) {\n          currentNode.setAttributeNS(namespaceURI, name, value);\n        } else {\n          /* Fallback to setAttribute() for browser-unrecognized namespaces e.g. \"x-schema\". */\n          currentNode.setAttribute(name, value);\n        }\n\n        arrayPop(DOMPurify.removed);\n      } catch (_) {}\n    }\n    /* Execute a hook if present */\n\n\n    _executeHook('afterSanitizeAttributes', currentNode, null);\n  };\n  /**\n   * _sanitizeShadowDOM\n   *\n   * @param  {DocumentFragment} fragment to iterate over recursively\n   */\n\n\n  const _sanitizeShadowDOM = function _sanitizeShadowDOM(fragment) {\n    let shadowNode;\n\n    const shadowIterator = _createIterator(fragment);\n    /* Execute a hook if present */\n\n\n    _executeHook('beforeSanitizeShadowDOM', fragment, null);\n\n    while (shadowNode = shadowIterator.nextNode()) {\n      /* Execute a hook if present */\n      _executeHook('uponSanitizeShadowNode', shadowNode, null);\n      /* Sanitize tags and elements */\n\n\n      if (_sanitizeElements(shadowNode)) {\n        continue;\n      }\n      /* Deep shadow DOM detected */\n\n\n      if (shadowNode.content instanceof DocumentFragment) {\n        _sanitizeShadowDOM(shadowNode.content);\n      }\n      /* Check attributes, sanitize if necessary */\n\n\n      _sanitizeAttributes(shadowNode);\n    }\n    /* Execute a hook if present */\n\n\n    _executeHook('afterSanitizeShadowDOM', fragment, null);\n  };\n  /**\n   * Sanitize\n   * Public method providing core sanitation functionality\n   *\n   * @param {String|Node} dirty string or DOM node\n   * @param {Object} configuration object\n   */\n  // eslint-disable-next-line complexity\n\n\n  DOMPurify.sanitize = function (dirty) {\n    let cfg = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let body;\n    let importedNode;\n    let currentNode;\n    let returnNode;\n    /* Make sure we have a string to sanitize.\n      DO NOT return early, as this will return the wrong type if\n      the user has requested a DOM object rather than a string */\n\n    IS_EMPTY_INPUT = !dirty;\n\n    if (IS_EMPTY_INPUT) {\n      dirty = '<!-->';\n    }\n    /* Stringify, in case dirty is an object */\n\n\n    if (typeof dirty !== 'string' && !_isNode(dirty)) {\n      if (typeof dirty.toString === 'function') {\n        dirty = dirty.toString();\n\n        if (typeof dirty !== 'string') {\n          throw typeErrorCreate('dirty is not a string, aborting');\n        }\n      } else {\n        throw typeErrorCreate('toString is not a function');\n      }\n    }\n    /* Return dirty HTML if DOMPurify cannot run */\n\n\n    if (!DOMPurify.isSupported) {\n      return dirty;\n    }\n    /* Assign config vars */\n\n\n    if (!SET_CONFIG) {\n      _parseConfig(cfg);\n    }\n    /* Clean up removed elements */\n\n\n    DOMPurify.removed = [];\n    /* Check if dirty is correctly typed for IN_PLACE */\n\n    if (typeof dirty === 'string') {\n      IN_PLACE = false;\n    }\n\n    if (IN_PLACE) {\n      /* Do some early pre-sanitization to avoid unsafe root nodes */\n      if (dirty.nodeName) {\n        const tagName = transformCaseFunc(dirty.nodeName);\n\n        if (!ALLOWED_TAGS[tagName] || FORBID_TAGS[tagName]) {\n          throw typeErrorCreate('root node is forbidden and cannot be sanitized in-place');\n        }\n      }\n    } else if (dirty instanceof Node) {\n      /* If dirty is a DOM element, append to an empty document to avoid\n         elements being stripped by the parser */\n      body = _initDocument('<!---->');\n      importedNode = body.ownerDocument.importNode(dirty, true);\n\n      if (importedNode.nodeType === 1 && importedNode.nodeName === 'BODY') {\n        /* Node is already a body, use as is */\n        body = importedNode;\n      } else if (importedNode.nodeName === 'HTML') {\n        body = importedNode;\n      } else {\n        // eslint-disable-next-line unicorn/prefer-dom-node-append\n        body.appendChild(importedNode);\n      }\n    } else {\n      /* Exit directly if we have nothing to do */\n      if (!RETURN_DOM && !SAFE_FOR_TEMPLATES && !WHOLE_DOCUMENT && // eslint-disable-next-line unicorn/prefer-includes\n      dirty.indexOf('<') === -1) {\n        return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(dirty) : dirty;\n      }\n      /* Initialize the document to work on */\n\n\n      body = _initDocument(dirty);\n      /* Check we have a DOM node from the data */\n\n      if (!body) {\n        return RETURN_DOM ? null : RETURN_TRUSTED_TYPE ? emptyHTML : '';\n      }\n    }\n    /* Remove first element node (ours) if FORCE_BODY is set */\n\n\n    if (body && FORCE_BODY) {\n      _forceRemove(body.firstChild);\n    }\n    /* Get node iterator */\n\n\n    const nodeIterator = _createIterator(IN_PLACE ? dirty : body);\n    /* Now start iterating over the created document */\n\n\n    while (currentNode = nodeIterator.nextNode()) {\n      /* Sanitize tags and elements */\n      if (_sanitizeElements(currentNode)) {\n        continue;\n      }\n      /* Shadow DOM detected, sanitize it */\n\n\n      if (currentNode.content instanceof DocumentFragment) {\n        _sanitizeShadowDOM(currentNode.content);\n      }\n      /* Check attributes, sanitize if necessary */\n\n\n      _sanitizeAttributes(currentNode);\n    }\n    /* If we sanitized `dirty` in-place, return it. */\n\n\n    if (IN_PLACE) {\n      return dirty;\n    }\n    /* Return sanitized string or DOM */\n\n\n    if (RETURN_DOM) {\n      if (RETURN_DOM_FRAGMENT) {\n        returnNode = createDocumentFragment.call(body.ownerDocument);\n\n        while (body.firstChild) {\n          // eslint-disable-next-line unicorn/prefer-dom-node-append\n          returnNode.appendChild(body.firstChild);\n        }\n      } else {\n        returnNode = body;\n      }\n\n      if (ALLOWED_ATTR.shadowroot || ALLOWED_ATTR.shadowrootmode) {\n        /*\n          AdoptNode() is not used because internal state is not reset\n          (e.g. the past names map of a HTMLFormElement), this is safe\n          in theory but we would rather not risk another attack vector.\n          The state that is cloned by importNode() is explicitly defined\n          by the specs.\n        */\n        returnNode = importNode.call(originalDocument, returnNode, true);\n      }\n\n      return returnNode;\n    }\n\n    let serializedHTML = WHOLE_DOCUMENT ? body.outerHTML : body.innerHTML;\n    /* Serialize doctype if allowed */\n\n    if (WHOLE_DOCUMENT && ALLOWED_TAGS['!doctype'] && body.ownerDocument && body.ownerDocument.doctype && body.ownerDocument.doctype.name && regExpTest(DOCTYPE_NAME, body.ownerDocument.doctype.name)) {\n      serializedHTML = '<!DOCTYPE ' + body.ownerDocument.doctype.name + '>\\n' + serializedHTML;\n    }\n    /* Sanitize final string template-safe */\n\n\n    if (SAFE_FOR_TEMPLATES) {\n      serializedHTML = stringReplace(serializedHTML, MUSTACHE_EXPR, ' ');\n      serializedHTML = stringReplace(serializedHTML, ERB_EXPR, ' ');\n      serializedHTML = stringReplace(serializedHTML, TMPLIT_EXPR, ' ');\n    }\n\n    return trustedTypesPolicy && RETURN_TRUSTED_TYPE ? trustedTypesPolicy.createHTML(serializedHTML) : serializedHTML;\n  };\n  /**\n   * Public method to set the configuration once\n   * setConfig\n   *\n   * @param {Object} cfg configuration object\n   */\n\n\n  DOMPurify.setConfig = function (cfg) {\n    _parseConfig(cfg);\n\n    SET_CONFIG = true;\n  };\n  /**\n   * Public method to remove the configuration\n   * clearConfig\n   *\n   */\n\n\n  DOMPurify.clearConfig = function () {\n    CONFIG = null;\n    SET_CONFIG = false;\n  };\n  /**\n   * Public method to check if an attribute value is valid.\n   * Uses last set config, if any. Otherwise, uses config defaults.\n   * isValidAttribute\n   *\n   * @param  {string} tag Tag name of containing element.\n   * @param  {string} attr Attribute name.\n   * @param  {string} value Attribute value.\n   * @return {Boolean} Returns true if `value` is valid. Otherwise, returns false.\n   */\n\n\n  DOMPurify.isValidAttribute = function (tag, attr, value) {\n    /* Initialize shared config vars if necessary. */\n    if (!CONFIG) {\n      _parseConfig({});\n    }\n\n    const lcTag = transformCaseFunc(tag);\n    const lcName = transformCaseFunc(attr);\n    return _isValidAttribute(lcTag, lcName, value);\n  };\n  /**\n   * AddHook\n   * Public method to add DOMPurify hooks\n   *\n   * @param {String} entryPoint entry point for the hook to add\n   * @param {Function} hookFunction function to execute\n   */\n\n\n  DOMPurify.addHook = function (entryPoint, hookFunction) {\n    if (typeof hookFunction !== 'function') {\n      return;\n    }\n\n    hooks[entryPoint] = hooks[entryPoint] || [];\n    arrayPush(hooks[entryPoint], hookFunction);\n  };\n  /**\n   * RemoveHook\n   * Public method to remove a DOMPurify hook at a given entryPoint\n   * (pops it from the stack of hooks if more are present)\n   *\n   * @param {String} entryPoint entry point for the hook to remove\n   * @return {Function} removed(popped) hook\n   */\n\n\n  DOMPurify.removeHook = function (entryPoint) {\n    if (hooks[entryPoint]) {\n      return arrayPop(hooks[entryPoint]);\n    }\n  };\n  /**\n   * RemoveHooks\n   * Public method to remove all DOMPurify hooks at a given entryPoint\n   *\n   * @param  {String} entryPoint entry point for the hooks to remove\n   */\n\n\n  DOMPurify.removeHooks = function (entryPoint) {\n    if (hooks[entryPoint]) {\n      hooks[entryPoint] = [];\n    }\n  };\n  /**\n   * RemoveAllHooks\n   * Public method to remove all DOMPurify hooks\n   *\n   */\n\n\n  DOMPurify.removeAllHooks = function () {\n    hooks = {};\n  };\n\n  return DOMPurify;\n}\n\nvar purify = createDOMPurify();\n\nexport { purify as default };\n//# sourceMappingURL=purify.es.js.map\n","import DOMPurify from \"dompurify\"\n\nexport class Utils {\n    /**\n     * In the 'deploy'-step, some code needs to be run by ts-node.\n     * However, ts-node crashes when it sees 'document'. When running from console, we flag this and disable all code where document is needed.\n     * This is a workaround and yet another hack\n     */\n    public static runningFromConsole = typeof window === \"undefined\"\n    public static externalDownloadFunction: (\n        url: string,\n        headers?: any\n    ) => Promise<{ content: string } | { redirect: string }>\n    public static Special_visualizations_tagsToApplyHelpText = `These can either be a tag to add, such as \\`amenity=fast_food\\` or can use a substitution, e.g. \\`addr:housenumber=$number\\`.\nThis new point will then have the tags \\`amenity=fast_food\\` and \\`addr:housenumber\\` with the value that was saved in \\`number\\` in the original feature.\n\nIf a value to substitute is undefined, empty string will be used instead.\n\nThis supports multiple values, e.g. \\`ref=$source:geometry:type/$source:geometry:ref\\`\n\nRemark that the syntax is slightly different then expected; it uses '$' to note a value to copy, followed by a name (matched with \\`[a-zA-Z0-9_:]*\\`). Sadly, delimiting with \\`{}\\` as these already mark the boundaries of the special rendering...\n\nNote that these values can be prepare with javascript in the theme by using a [calculatedTag](calculatedTags.md#calculating-tags-with-javascript)\n `\n    public static readonly imageExtensions = new Set([\"jpg\", \"png\", \"svg\", \"jpeg\", \".gif\"])\n    public static readonly special_visualizations_importRequirementDocs = `#### Importing a dataset into OpenStreetMap: requirements\n\nIf you want to import a dataset, make sure that:\n\n1. The dataset to import has a suitable license\n2. The community has been informed of the import\n3. All other requirements of the [import guidelines](https://wiki.openstreetmap.org/wiki/Import/Guidelines) have been followed\n\nThere are also some technicalities in your theme to keep in mind:\n\n1. The new feature will be added and will flow through the program as any other new point as if it came from OSM.\n    This means that there should be a layer which will match the new tags and which will display it.\n2. The original feature from your geojson layer will gain the tag '_imported=yes'.\n    This should be used to change the appearance or even to hide it (eg by changing the icon size to zero)\n3. There should be a way for the theme to detect previously imported points, even after reloading.\n    A reference number to the original dataset is an excellent way to do this\n4. When importing ways, the theme creator is also responsible of avoiding overlapping ways.\n\n#### Disabled in unofficial themes\n\nThe import button can be tested in an unofficial theme by adding \\`test=true\\` or \\`backend=osm-test\\` as [URL-paramter](URL_Parameters.md).\nThe import button will show up then. If in testmode, you can read the changeset-XML directly in the web console.\nIn the case that MapComplete is pointed to the testing grounds, the edit will be made on https://master.apis.dev.openstreetmap.org`\n    private static knownKeys = [\n        \"addExtraTags\",\n        \"and\",\n        \"calculatedTags\",\n        \"changesetmessage\",\n        \"clustering\",\n        \"color\",\n        \"condition\",\n        \"customCss\",\n        \"dashArray\",\n        \"defaultBackgroundId\",\n        \"description\",\n        \"descriptionTail\",\n        \"doNotDownload\",\n        \"enableAddNewPoints\",\n        \"enableBackgroundLayerSelection\",\n        \"enableGeolocation\",\n        \"enableLayers\",\n        \"enableMoreQuests\",\n        \"enableSearch\",\n        \"enableShareScreen\",\n        \"enableUserBadge\",\n        \"freeform\",\n        \"hideFromOverview\",\n        \"hideInAnswer\",\n        \"icon\",\n        \"iconOverlays\",\n        \"iconSize\",\n        \"id\",\n        \"if\",\n        \"ifnot\",\n        \"isShown\",\n        \"key\",\n        \"language\",\n        \"layers\",\n        \"lockLocation\",\n        \"maintainer\",\n        \"mappings\",\n        \"maxzoom\",\n        \"maxZoom\",\n        \"minNeededElements\",\n        \"minzoom\",\n        \"multiAnswer\",\n        \"name\",\n        \"or\",\n        \"osmTags\",\n        \"passAllFeatures\",\n        \"presets\",\n        \"question\",\n        \"render\",\n        \"roaming\",\n        \"roamingRenderings\",\n        \"rotation\",\n        \"shortDescription\",\n        \"socialImage\",\n        \"source\",\n        \"startLat\",\n        \"startLon\",\n        \"startZoom\",\n        \"tagRenderings\",\n        \"tags\",\n        \"then\",\n        \"title\",\n        \"titleIcons\",\n        \"type\",\n        \"version\",\n        \"wayHandling\",\n        \"widenFactor\",\n        \"width\",\n    ]\n    private static extraKeys = [\n        \"nl\",\n        \"en\",\n        \"fr\",\n        \"de\",\n        \"pt\",\n        \"es\",\n        \"name\",\n        \"phone\",\n        \"email\",\n        \"amenity\",\n        \"leisure\",\n        \"highway\",\n        \"building\",\n        \"yes\",\n        \"no\",\n        \"true\",\n        \"false\",\n    ]\n    private static injectedDownloads = {}\n    private static _download_cache = new Map<\n        string,\n        {\n            promise: Promise<any | { error: string; url: string; statuscode?: number }>\n            timestamp: number\n        }\n    >()\n\n    public static readonly isIframe = !Utils.runningFromConsole && window !== window.top\n\n    public static initDomPurify() {\n        if (Utils.runningFromConsole) {\n            return\n        }\n        DOMPurify.addHook(\"afterSanitizeAttributes\", function (node) {\n            // set all elements owning target to target=_blank + add noopener noreferrer\n            const target = node.getAttribute(\"target\")\n            if (target) {\n                node.setAttribute(\"target\", \"_blank\")\n                node.setAttribute(\"rel\", \"noopener noreferrer\")\n            }\n        })\n    }\n\n    public static purify(src: string): string {\n        return DOMPurify.sanitize(src, {\n            USE_PROFILES: { html: true },\n            ADD_ATTR: [\"target\"], // Don't remove target='_blank'. Note that Utils.initDomPurify does add a hook which automatically adds 'rel=noopener'\n        })\n    }\n\n    /**\n     * Parses the arguments for special visualisations\n     */\n    public static ParseVisArgs(\n        specs: { name: string; defaultValue?: string }[],\n        args: string[]\n    ): Record<string, string> {\n        const parsed: Record<string, string> = {}\n        if (args.length > specs.length) {\n            throw (\n                \"To much arguments for special visualization: got \" +\n                args.join(\",\") +\n                \" but expected only \" +\n                args.length +\n                \" arguments\"\n            )\n        }\n        for (let i = 0; i < specs.length; i++) {\n            const spec = specs[i]\n            let arg = args[i]?.trim()\n            if (arg === undefined || arg === \"\") {\n                arg = spec.defaultValue\n            }\n            parsed[spec.name] = arg\n        }\n\n        return parsed\n    }\n\n    static EncodeXmlValue(str) {\n        if (typeof str !== \"string\") {\n            str = \"\" + str\n        }\n\n        return str\n            .replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&apos;\")\n    }\n\n    /**\n     * Gives a clean float, or undefined if parsing fails\n     * @param str\n     */\n    static asFloat(str): number {\n        if (str) {\n            const i = parseFloat(str)\n            if (isNaN(i)) {\n                return undefined\n            }\n            return i\n        }\n        return undefined\n    }\n\n    public static Upper(str: string) {\n        return str.substr(0, 1).toUpperCase() + str.substr(1)\n    }\n\n    public static TwoDigits(i: number) {\n        if (i < 10) {\n            return \"0\" + i\n        }\n        return \"\" + i\n    }\n\n    /**\n     * Converts a number to a number with precisely 7 decimals\n     *\n     * Utils.Round7(12.123456789) // => 12.1234568\n     */\n    public static Round7(i: number): number {\n        if (i == undefined) {\n            return undefined\n        }\n        return Math.round(i * 10000000) / 10000000\n    }\n\n    public static Times(f: (i: number) => string, count: number): string {\n        let res = \"\"\n        for (let i = 0; i < count; i++) {\n            res += f(i)\n        }\n        return res\n    }\n\n    public static TimesT<T>(count: number, f: (i: number) => T): T[] {\n        const res: T[] = []\n        for (let i = 0; i < count; i++) {\n            res.push(f(i))\n        }\n        return res\n    }\n\n    public static NoNull<T>(array: T[] | undefined): T[] | undefined\n    public static NoNull<T>(array: undefined): undefined\n    public static NoNull<T>(array: T[]): T[]\n    public static NoNull<T>(array: T[]): NonNullable<T>[] {\n        return <any>array?.filter((o) => o !== undefined && o !== null)\n    }\n\n    public static Hist(array: string[]): Map<string, number> {\n        const hist = new Map<string, number>()\n        for (const s of array) {\n            hist.set(s, 1 + (hist.get(s) ?? 0))\n        }\n        return hist\n    }\n\n    /**\n     * Removes all empty strings from this list\n     * If undefined or null is given, an empty list is returned\n     *\n     * Utils.NoEmpty(undefined) // => []\n     * Utils.NoEmpty([\"abc\",\"\",\"def\", null]) // => [\"abc\",\"def\", null]\n     *\n     */\n    public static NoEmpty(array: string[]): string[] {\n        const ls: string[] = []\n        if (!array) {\n            return ls\n        }\n        for (const t of array) {\n            if (t === \"\") {\n                continue\n            }\n            ls.push(t)\n        }\n        return ls\n    }\n\n    public static EllipsesAfter(str: string, l: number = 100) {\n        if (str === undefined || str === null) {\n            return undefined\n        }\n        if (typeof str !== \"string\") {\n            console.error(\"Not a string:\", str)\n            return undefined\n        }\n        if (str.length <= l) {\n            return str\n        }\n        return str.substr(0, l - 1) + \"…\"\n    }\n\n    /**\n     * Adds a property to the given object, but the value will _only_ be calculated when it is actually requested.\n     * This calculation will run once\n     * @param object\n     * @param name\n     * @param init\n     * @param whenDone: called when the value is updated. Note that this will be called at most once\n     * @constructor\n     */\n    public static AddLazyProperty(\n        object: any,\n        name: string,\n        init: () => any,\n        whenDone?: () => void\n    ) {\n        Object.defineProperty(object, name, {\n            enumerable: false,\n            configurable: true,\n            get: () => {\n                delete object[name]\n                try {\n                    object[name] = init()\n                    if (whenDone) {\n                        whenDone()\n                    }\n                    return object[name]\n                } catch (e) {\n                    console.error(\"Error while calculating a lazy property\", e)\n                    return undefined\n                }\n            },\n        })\n    }\n\n    /**\n     * Adds a property to the given object, but the value will _only_ be calculated when it is actually requested\n     */\n    public static AddLazyPropertyAsync(\n        object: any,\n        name: string,\n        init: () => Promise<any>,\n        whenDone?: () => void\n    ) {\n        Object.defineProperty(object, name, {\n            enumerable: false,\n            configurable: true,\n            get: () => {\n                init().then((r) => {\n                    delete object[name]\n                    object[name] = r\n                    if (whenDone) {\n                        whenDone()\n                    }\n                })\n            },\n        })\n    }\n\n    public static FixedLength(str: string, l: number) {\n        str = Utils.EllipsesAfter(str, l)\n        while (str.length < l) {\n            str = \" \" + str\n        }\n        return str\n    }\n\n    /**\n     * Creates a new array with all elements from 'arr' in such a way that every element will be kept only once\n     * Elements are returned in the same order as they appear in the lists.\n     * Null/Undefined is returned as is. If an emtpy array is given, a new empty array will be returned\n     */\n    public static Dedup(arr: NonNullable<string[]>): NonNullable<string[]>\n    public static Dedup(arr: undefined):undefined\n    public static Dedup(arr: string[] | undefined): string[] | undefined\n    public static Dedup(arr: string[]): string[] {\n        if (arr === undefined || arr === null) {\n            return arr\n        }\n        const newArr = []\n        for (const string of arr) {\n            if (newArr.indexOf(string) < 0) {\n                newArr.push(string)\n            }\n        }\n        return newArr\n    }\n\n    /**\n     * Finds all duplicates in a list of strings\n     *\n     * Utils.Duplicates([\"a\", \"b\", \"c\"]) // => []\n     * Utils.Duplicates([\"a\", \"b\",\"c\",\"b\"] // => [\"b\"]\n     * Utils.Duplicates([\"a\", \"b\",\"c\",\"b\",\"b\"] // => [\"b\"]\n     *\n     */\n    public static Duplicates(arr: string[]): string[] {\n        if (arr === undefined) {\n            return undefined\n        }\n        const seen = new Set<string>()\n        const duplicates = new Set<string>()\n        for (const string of arr) {\n            if (seen.has(string)) {\n                duplicates.add(string)\n            }\n            seen.add(string)\n        }\n        return Array.from(duplicates)\n    }\n\n    /**\n     * In the given list, all values which are lists will be merged with the values, e.g.\n     *\n     * Utils.Flatten([ [1,2], 3, [4, [5 ,6]] ]) // => [1, 2, 3, 4, [5, 6]]\n     */\n    public static Flatten<T>(list: (T | T[])[]): T[] {\n        const result = []\n        for (const value of list) {\n            if (Array.isArray(value)) {\n                result.push(...value)\n            } else {\n                result.push(value)\n            }\n        }\n        return result\n    }\n\n    /**\n     * Utils.Identical([1,2], [1,2]) // => true\n     * Utils.Identical([1,2,3], [1,2,4}]) // => false\n     * Utils.Identical([1,2], [1,2,3]) // => false\n     */\n    public static Identical<T>(t1: T[], t2: T[], eq?: (t: T, t0: T) => boolean): boolean {\n        if (t1.length !== t2.length) {\n            return false\n        }\n        eq = (a, b) => a === b\n        for (let i = 0; i < t1.length; i++) {\n            if (!eq(t1[i], t2[i])) {\n                return false\n            }\n        }\n        return true\n    }\n\n    /**\n     * Utils.MergeTags({k0:\"v0\",\"common\":\"0\"},{k1:\"v1\", common: \"1\"}) // => {k0: \"v0\", k1:\"v1\", common: \"1\"}\n     */\n    public static MergeTags(a: any, b: any) {\n        const t = {}\n        for (const k in a) {\n            t[k] = a[k]\n        }\n        for (const k in b) {\n            t[k] = b[k]\n        }\n        return t\n    }\n\n    public static SplitFirst(a: string, sep: string): string[] {\n        const index = a.indexOf(sep)\n        if (index < 0) {\n            return [a]\n        }\n        return [a.substr(0, index), a.substr(index + sep.length)]\n    }\n\n    /**\n     * Given a piece of text, will replace any key occuring in 'tags' by the corresponding value\n     *\n     * Utils.SubstituteKeys(\"abc{def}ghi\", {def: 'XYZ'}) // => \"abcXYZghi\"\n     * Utils.SubstituteKeys(\"abc{def}{def}ghi\", {def: 'XYZ'}) // => \"abcXYZXYZghi\"\n     * Utils.SubstituteKeys(\"abc{def}ghi\", {def: '{XYZ}'}) // => \"abc{XYZ}ghi\"\n     * Utils.SubstituteKeys(\"abc\\n\\n{def}ghi\", {def: '{XYZ}'}) // => \"abc\\n\\n{XYZ}ghi\"\n     *\n     * @param txt\n     * @param tags\n     * @param useLang\n     * @constructor\n     */\n    public static SubstituteKeys(\n        txt: string | undefined,\n        tags: Record<string, any> | undefined,\n        useLang?: string\n    ): string | undefined {\n        if (txt === undefined) {\n            return undefined\n        }\n        const regex = /(.*?){([^}]*)}(.*)/s\n\n        let match = txt.match(regex)\n\n        if (!match) {\n            return txt\n        }\n        let result = \"\"\n        while (match) {\n            const [_, normal, key, leftover] = match\n            let v = tags?.[key]\n            if (v !== undefined && v !== null) {\n                if (v[\"toISOString\"] != undefined) {\n                    // This is a date, probably the timestamp of the object\n                    // @ts-ignore\n                    const date: Date = el\n                    v = date.toISOString()\n                }\n\n                if (useLang !== undefined && v?.translations !== undefined) {\n                    v = v.translations[useLang] ?? v.translations[\"*\"] ?? v?.textFor(useLang) ?? v\n                }\n\n                if (v.InnerConstructElement !== undefined) {\n                    console.warn(\n                        \"SubstituteKeys received a BaseUIElement to substitute in - this is probably a bug and will be downcast to a string\\nThe key is\",\n                        key,\n                        \"\\nThe value is\",\n                        v\n                    )\n                    v = v.InnerConstructElement()?.textContent\n                }\n\n                if (typeof v !== \"string\") {\n                    v = \"\" + v\n                }\n                v = v.replace(/\\n/g, \"<br/>\")\n            } else {\n                // v === undefined\n                v = \"\"\n            }\n\n            result += normal + v\n            match = leftover.match(regex)\n            if (!match) {\n                result += leftover\n            }\n        }\n        return result\n    }\n\n    public static LoadCustomCss(location: string) {\n        const head = document.getElementsByTagName(\"head\")[0]\n        const link = document.createElement(\"link\")\n        link.id = \"customCss\"\n        link.rel = \"stylesheet\"\n        link.type = \"text/css\"\n        link.href = location\n        link.media = \"all\"\n        head.appendChild(link)\n        console.log(\"Added custom css file \", location)\n    }\n\n    public static PushList<T>(target: T[], source?: T[]) {\n        if (source === undefined) {\n            return\n        }\n        target.push(...source)\n    }\n\n    /**\n     * Copies all key-value pairs of the source into the target. This will change the target\n     * If the key starts with a '+', the values of the list will be appended to the target instead of overwritten\n     * If the key starts with `=`, the property will be overwritten.\n     *\n     * 'Source' will not be modified, but 'Target' will be\n     *\n     * const obj = {someValue: 42};\n     * const override = {someValue: null};\n     * Utils.Merge(override, obj);\n     * obj.someValue // => null\n     *\n     * const obj = {someValue: 42};\n     * const override = {someValue: null};\n     * const returned = Utils.Merge(override, obj);\n     * returned == obj // => true\n     *\n     *  const source = {\n     *                abc: \"def\",\n     *                foo: \"bar\",\n     *                list0: [\"overwritten\"],\n     *                \"list1+\": [\"appended\"]\n     *            }\n     * const target = {\n     *                \"xyz\": \"omega\",\n     *                \"list0\": [\"should-be-gone\"],\n     *                \"list1\": [\"should-be-kept\"],\n     *                \"list2\": [\"should-be-untouched\"]\n     *            }\n     * const result = Utils.Merge(source, target)\n     * result.abc // => \"def\"\n     * result.foo // => \"bar\"\n     * result.xyz // => \"omega\"\n     * result.list0.length // =>  1\n     * result.list0[0] // =>  \"overwritten\"\n     * result.list1.length // =>  2\n     * result.list1[0] // =>  \"should-be-kept\"\n     * result.list1[1] // =>  \"appended\"\n     * result.list2.length // =>  1\n     * result.list2[0] // => \"should-be-untouched\"\n     *\n     * const source = {\"condition\":{\"+and\":[\"xyz\"]}}\n     * const target = {\"id\":\"test\"}\n     * const result = Utils.Merge(source, target)\n     * result // =>  {\"id\":\"test\",\"condition\":{\"and\":[\"xyz\"]}}\n     *\n     * const source = {\"=name\": {\"en\": \"XYZ\"}}\n     * const target = {\"name\":null, \"x\":\"y\"}\n     * const result = Utils.Merge(source, target)\n     * result // => {\"name\": {\"en\": \"XYZ\"}, \"x\": \"y\"}\n     */\n    static Merge<T, S>(source: Readonly<S>, target: T): T & S {\n        if (target === null) {\n            return <T & S>Utils.CleanMergeObject(source)\n        }\n\n        for (const key in source) {\n            if (key.startsWith(\"=\")) {\n                const trimmedKey = key.substr(1)\n                target[trimmedKey] = source[key]\n                continue\n            }\n\n            if (key.startsWith(\"+\") || key.endsWith(\"+\")) {\n                const trimmedKey = key.replace(\"+\", \"\")\n                const sourceV = source[key]\n                const targetV = target[trimmedKey] ?? []\n\n                let newList: any[]\n                if (key.startsWith(\"+\")) {\n                    if (!Array.isArray(targetV)) {\n                        throw new Error(\n                            \"Cannot concatenate: value to add is not an array: \" +\n                                JSON.stringify(targetV)\n                        )\n                    }\n                    if (Array.isArray(sourceV)) {\n                        newList = sourceV.concat(targetV) ?? targetV\n                    } else {\n                        throw new Error(\n                            \"Could not merge concatenate \" +\n                                JSON.stringify(sourceV) +\n                                \" and \" +\n                                JSON.stringify(targetV)\n                        )\n                    }\n                } else {\n                    newList = targetV.concat(sourceV ?? [])\n                }\n\n                target[trimmedKey] = newList\n                continue\n            }\n\n            const sourceV = source[key]\n            // @ts-ignore\n            const targetV = target[key]\n            if (typeof sourceV === \"object\") {\n                if (sourceV === null) {\n                    // @ts-ignore\n                    target[key] = null\n                } else if (targetV === undefined) {\n                    // @ts-ignore\n                    target[key] = Utils.CleanMergeObject(sourceV)\n                } else {\n                    Utils.Merge(sourceV, targetV)\n                }\n            } else {\n                // @ts-ignore\n                target[key] = Utils.CleanMergeObject(sourceV)\n            }\n        }\n        // @ts-ignore\n        return target\n    }\n\n    /**\n     * Walks the specified path into the object till the end.\n     *\n     * If a list is encountered, this is transparently walked recursively on every object.\n     * If 'null' or 'undefined' is encountered, this method stops\n     *\n     * The leaf objects are replaced in the object itself by the specified function.\n     */\n    public static WalkPath(\n        path: string[],\n        object: any,\n        replaceLeaf: (leaf: any, travelledPath: string[]) => any,\n        travelledPath: string[] = []\n    ): void {\n        if (object == null) {\n            return\n        }\n\n        const head = path[0]\n        if (path.length === 1) {\n            // We have reached the leaf\n            const leaf = object[head]\n            if (leaf !== undefined) {\n                if (Array.isArray(leaf)) {\n                    object[head] = leaf.map((o) => replaceLeaf(o, travelledPath))\n                } else {\n                    object[head] = replaceLeaf(leaf, travelledPath)\n                    if (object[head] === undefined) {\n                        delete object[head]\n                    }\n                }\n            }\n            return\n        }\n        const sub = object[head]\n        if (sub === undefined) {\n            return\n        }\n        if (typeof sub !== \"object\") {\n            return\n        }\n        if (Array.isArray(sub)) {\n            sub.forEach((el, i) =>\n                Utils.WalkPath(path.slice(1), el, replaceLeaf, [...travelledPath, head, \"\" + i])\n            )\n            return\n        }\n        Utils.WalkPath(path.slice(1), sub, replaceLeaf, [...travelledPath, head])\n    }\n\n    /**\n     * Walks the specified path into the object till the end.\n     * If a list is encountered, this is tranparently walked recursively on every object.\n     *\n     * The leaf objects are collected in the list\n     */\n    public static CollectPath(\n        path: string[],\n        object: any,\n        collectedList: { leaf: any; path: string[] }[] = [],\n        travelledPath: string[] = []\n    ): { leaf: any; path: string[] }[] {\n        if (object === undefined || object === null) {\n            return collectedList\n        }\n        const head = path[0]\n        travelledPath = [...travelledPath, head]\n        if (path.length === 1) {\n            // We have reached the leaf\n            const leaf = object[head]\n            if (leaf === undefined || leaf === null) {\n                return collectedList\n            }\n            if (Array.isArray(leaf)) {\n                for (let i = 0; i < (<any[]>leaf).length; i++) {\n                    const l = (<any[]>leaf)[i]\n                    collectedList.push({ leaf: l, path: [...travelledPath, \"\" + i] })\n                }\n            } else {\n                collectedList.push({ leaf, path: travelledPath })\n            }\n            return collectedList\n        }\n        const sub = object[head]\n        if (sub === undefined || sub === null) {\n            return collectedList\n        }\n\n        if (Array.isArray(sub)) {\n            sub.forEach((el, i) =>\n                Utils.CollectPath(path.slice(1), el, collectedList, [...travelledPath, \"\" + i])\n            )\n            return collectedList\n        }\n        if (typeof sub !== \"object\") {\n            return collectedList\n        }\n        return Utils.CollectPath(path.slice(1), sub, collectedList, travelledPath)\n    }\n\n    /**\n     * Apply a function on every leaf of the JSON; used to rewrite parts of the JSON.\n     * Returns a modified copy of the original object.\n     *\n     * 'null' and 'undefined' are _always_ considered a leaf, even if 'isLeaf' says it isn't\n     *\n     * Hangs if the object contains a loop\n     *\n     * // should walk a json\n     * const walked = Utils.WalkJson({\n     *     key: \"value\"\n     * }, (x: string) => x + \"!\")\n     * walked // => {key: \"value!\"}\n     *\n     * // should preserve undefined and null:\n     * const walked = Utils.WalkJson({\n     *   u: undefined,\n     *   n: null,\n     *   v: \"value\"\n     * }, (x) => {if(x !== undefined && x !== null){return x+\"!}; return x})\n     * walked // => {v: \"value!\", u: undefined, n: null}\n     *\n     * // should preserve undefined and null, also with a negative isLeaf:\n     * const walked = Utils.WalkJson({\n     *   u: undefined,\n     *   n: null,\n     *   v: \"value\"\n     * }, (x) => return x}, _ => false)\n     * walked // => {v: \"value\", u: undefined, n: null}\n     */\n    static WalkJson(\n        json: any,\n        f: (v: object | number | string | boolean | undefined, path: string[]) => any,\n        isLeaf: (object) => boolean = undefined,\n        path: string[] = []\n    ) {\n        if (json === undefined || json === null) {\n            return f(json, path)\n        }\n        const jtp = typeof json\n        if (isLeaf !== undefined) {\n            if (jtp === \"object\") {\n                if (isLeaf(json)) {\n                    return f(json, path)\n                }\n            } else {\n                return json\n            }\n        } else if (jtp === \"boolean\" || jtp === \"string\" || jtp === \"number\") {\n            return f(json, path)\n        }\n        if (Array.isArray(json)) {\n            return json.map((sub, i) => {\n                return Utils.WalkJson(sub, f, isLeaf, [...path, \"\" + i])\n            })\n        }\n\n        const cp = { ...json }\n        for (const key in json) {\n            cp[key] = Utils.WalkJson(json[key], f, isLeaf, [...path, key])\n        }\n        return cp\n    }\n\n    /**\n     * Walks an object recursively, will execute the 'collect'-callback on every leaf.\n     *\n     * Will hang on objects with loops\n     */\n    static WalkObject(\n        json: any,\n        collect: (v: number | string | boolean | undefined, path: string[]) => any,\n        isLeaf: (object) => boolean = undefined,\n        path = []\n    ): void {\n        if (json === undefined) {\n            return\n        }\n        const jtp = typeof json\n        if (isLeaf !== undefined) {\n            if (jtp !== \"object\") {\n                return\n            }\n\n            if (isLeaf(json)) {\n                return collect(json, path)\n            }\n        } else if (jtp === \"boolean\" || jtp === \"string\" || jtp === \"number\") {\n            collect(json, path)\n            return\n        }\n        if (Array.isArray(json)) {\n            json.map((sub, i) => {\n                return Utils.WalkObject(sub, collect, isLeaf, [...path, i])\n            })\n            return\n        }\n\n        for (const key in json) {\n            Utils.WalkObject(json[key], collect, isLeaf, [...path, key])\n        }\n    }\n\n    static getOrSetDefault<K, V>(dict: Map<K, V>, k: K, v: () => V) {\n        const found = dict.get(k)\n        if (found !== undefined) {\n            return found\n        }\n        dict.set(k, v())\n        return dict.get(k)\n    }\n\n    public static UnMinify(minified: string): string {\n        if (minified === undefined || minified === null) {\n            return undefined\n        }\n\n        const parts = minified.split(\"|\")\n        let result = parts.shift()\n        const keys = Utils.knownKeys.concat(Utils.extraKeys)\n\n        for (const part of parts) {\n            if (part == \"\") {\n                // Empty string => this was a || originally\n                result += \"|\"\n                continue\n            }\n            const i = part.charCodeAt(0)\n            result += '\"' + keys[i] + '\":' + part.substring(1)\n        }\n\n        return result\n    }\n\n    public static injectJsonDownloadForTests(url: string, data) {\n        Utils.injectedDownloads[url] = data\n    }\n\n    public static async download(\n        url: string,\n        headers?: Record<string, string>\n    ): Promise<string | undefined> {\n        const result = await Utils.downloadAdvanced(url, headers)\n        if (result[\"error\"] !== undefined) {\n            throw result[\"error\"]\n        }\n        return result[\"content\"]\n    }\n\n    /**\n     * Download function which also indicates advanced options, such as redirects\n     */\n    public static downloadAdvanced(\n        url: string,\n        headers?: Record<string, string>,\n        method: \"POST\" | \"GET\" | \"PUT\" | \"UPDATE\" | \"DELETE\" | \"OPTIONS\" = \"GET\",\n        content?: string\n    ): Promise<\n        | { content: string }\n        | { redirect: string }\n        | { error: string; url: string; statuscode?: number }\n    > {\n        if (this.externalDownloadFunction !== undefined) {\n            return this.externalDownloadFunction(url, headers)\n        }\n\n        return new Promise((resolve, reject) => {\n            const xhr = new XMLHttpRequest()\n            xhr.onload = () => {\n                if (xhr.status == 200) {\n                    resolve({ content: xhr.response })\n                } else if (xhr.status === 302) {\n                    resolve({ redirect: xhr.getResponseHeader(\"location\") })\n                } else if (xhr.status === 509 || xhr.status === 429) {\n                    resolve({ error: \"rate limited\", url, statuscode: xhr.status })\n                } else {\n                    resolve({\n                        error: \"other error: \" + xhr.statusText + \", \" + xhr.responseText,\n                        url,\n                        statuscode: xhr.status,\n                    })\n                }\n            }\n            xhr.open(method, url)\n            if (headers !== undefined) {\n                for (const key in headers) {\n                    xhr.setRequestHeader(key, headers[key])\n                }\n            }\n            xhr.send(content)\n            xhr.onerror = (ev: ProgressEvent<EventTarget>) =>\n                reject(\n                    \"Could not get \" +\n                        url +\n                        \", xhr status code is \" +\n                        xhr.status +\n                        \" (\" +\n                        xhr.statusText +\n                        \")\"\n                )\n        })\n    }\n\n    public static upload(\n        url: string,\n        data: string | Blob,\n        headers?: Record<string, string>\n    ): Promise<string> {\n        return new Promise((resolve, reject) => {\n            const xhr = new XMLHttpRequest()\n            xhr.onload = () => {\n                if (xhr.status == 200) {\n                    resolve(xhr.response)\n                } else if (xhr.status === 509 || xhr.status === 429) {\n                    reject(\"rate limited\")\n                } else {\n                    reject(xhr.statusText)\n                }\n            }\n            xhr.open(\"POST\", url)\n            if (headers !== undefined) {\n                for (const key in headers) {\n                    xhr.setRequestHeader(key, headers[key])\n                }\n            }\n\n            xhr.send(data)\n            xhr.onerror = reject\n        })\n    }\n\n    public static async downloadJsonCached<T = object | []>(\n        url: string,\n        maxCacheTimeMs: number,\n        headers?: Record<string, string>\n    ): Promise<T> {\n        const result = await Utils.downloadJsonCachedAdvanced(url, maxCacheTimeMs, headers)\n        if (result[\"content\"]) {\n            return result[\"content\"]\n        }\n        throw result[\"error\"]\n    }\n\n    public static async downloadJsonCachedAdvanced<T = object | []>(\n        url: string,\n        maxCacheTimeMs: number,\n        headers?: Record<string, string>\n    ): Promise<{ content: T } | { error: string; url: string; statuscode?: number }> {\n        const cached = Utils._download_cache.get(url)\n        if (cached !== undefined) {\n            if (new Date().getTime() - cached.timestamp <= maxCacheTimeMs) {\n                return cached.promise\n            }\n        }\n        const promise =\n            /*NO AWAIT as we work with the promise directly */ Utils.downloadJsonAdvanced<T>(\n                url,\n                headers\n            )\n        Utils._download_cache.set(url, { promise, timestamp: new Date().getTime() })\n        return await promise\n    }\n    public static async downloadJson<T = object | []>(\n        url: string,\n        headers?: Record<string, string>\n    ): Promise<T>\n    public static async downloadJson<T>(url: string, headers?: Record<string, string>): Promise<T>\n    public static async downloadJson(\n        url: string,\n        headers?: Record<string, string>\n    ): Promise<object | []> {\n        const result = await Utils.downloadJsonAdvanced(url, headers)\n        if (result[\"content\"]) {\n            return result[\"content\"]\n        }\n        throw result[\"error\"]\n    }\n\n    public static awaitAnimationFrame(): Promise<void> {\n        return new Promise<void>((resolve) => {\n            window.requestAnimationFrame(() => {\n                resolve()\n            })\n        })\n    }\n\n    public static async downloadJsonAdvanced<T = object | []>(\n        url: string,\n        headers?: Record<string, string>\n    ): Promise<{ content: T } | { error: string; url: string; statuscode?: number }> {\n        const injected = Utils.injectedDownloads[url]\n        if (injected !== undefined) {\n            console.debug(\"Using injected resource for test for URL\", url)\n            return { content: injected }\n        }\n        const result = await Utils.downloadAdvanced(\n            url,\n            Utils.Merge({ accept: \"application/json\" }, headers ?? {})\n        )\n        if (result[\"error\"] !== undefined) {\n            return <{ error: string; url: string; statuscode?: number }>result\n        }\n        const data = result[\"content\"]\n        try {\n            if (typeof data === \"string\") {\n                if (data === \"\") {\n                    return { content: <T>{} }\n                }\n                return { content: JSON.parse(data) }\n            }\n            return { content: data }\n        } catch (e) {\n            console.error(\n                \"Could not parse the response of\",\n                url,\n                \"which contains\",\n                data,\n                \"due to\",\n                e,\n                \"\\n\",\n                e.stack\n            )\n            return { error: \"malformed\", url }\n        }\n    }\n\n    /**\n     * Triggers a 'download file' popup which will download the contents\n     */\n    public static offerContentsAsDownloadableFile(\n        contents: string | Blob,\n        fileName: string = \"download.txt\",\n        options?: {\n            mimetype:\n                | string\n                | \"text/plain\"\n                | \"text/csv\"\n                | \"application/vnd.geo+json\"\n                | \"{gpx=application/gpx+xml}\"\n                | \"application/json\"\n                | \"image/png\"\n        }\n    ) {\n        const element = document.createElement(\"a\")\n        let file\n        if (typeof contents === \"string\") {\n            file = new Blob([contents], { type: options?.mimetype ?? \"text/plain\" })\n        } else {\n            file = contents\n        }\n        element.href = URL.createObjectURL(file)\n        element.download = fileName\n        document.body.appendChild(element) // Required for this to work in FireFox\n        element.click()\n    }\n\n    public static async waitFor(timeMillis: number): Promise<void> {\n        return new Promise((resolve) => {\n            window.setTimeout(resolve, timeMillis)\n        })\n    }\n\n    public static toHumanTime(seconds): string {\n        seconds = Math.floor(seconds)\n        let minutes = Math.floor(seconds / 60)\n        seconds = seconds % 60\n        let hours = Math.floor(minutes / 60)\n        minutes = minutes % 60\n        const days = Math.floor(hours / 24)\n        hours = hours % 24\n        if (days > 0) {\n            return days + \"days\" + \" \" + hours + \"h\"\n        }\n        return hours + \":\" + Utils.TwoDigits(minutes) + \":\" + Utils.TwoDigits(seconds)\n    }\n\n    public static HomepageLink(): string {\n        if (typeof window === \"undefined\") {\n            return \"https://mapcomplete.org\"\n        }\n        const path = (\n            window.location.protocol +\n            \"//\" +\n            window.location.host +\n            window.location.pathname\n        ).split(\"/\")\n        path.pop()\n        path.push(\"index.html\")\n        return path.join(\"/\")\n    }\n\n    public static OsmChaLinkFor(daysInThePast, theme = undefined): string {\n        const now = new Date()\n        const lastWeek = new Date(now.getTime() - daysInThePast * 24 * 60 * 60 * 1000)\n        const date =\n            lastWeek.getFullYear() +\n            \"-\" +\n            Utils.TwoDigits(lastWeek.getMonth() + 1) +\n            \"-\" +\n            Utils.TwoDigits(lastWeek.getDate())\n        let osmcha_link = `\"date__gte\":[{\"label\":\"${date}\",\"value\":\"${date}\"}],\"editor\":[{\"label\":\"mapcomplete\",\"value\":\"mapcomplete\"}]`\n        if (theme !== undefined) {\n            osmcha_link =\n                osmcha_link + \",\" + `\"comment\":[{\"label\":\"#${theme}\",\"value\":\"#${theme}\"}]`\n        }\n        return \"https://osmcha.org/?filters=\" + encodeURIComponent(\"{\" + osmcha_link + \"}\")\n    }\n\n    /**\n     * Deepclone an object by serializing and deserializing it\n     * @param x\n     * @constructor\n     */\n    static Clone<T>(x: T): T {\n        if (x === undefined) {\n            return undefined\n        }\n        return JSON.parse(JSON.stringify(x))\n    }\n\n    public static ParseDate(str: string): Date {\n        if (str.endsWith(\" UTC\")) {\n            str = str.replace(\" UTC\", \"+00\")\n        }\n        return new Date(str)\n    }\n\n    public static selectTextIn(node) {\n        if (document.body[\"createTextRange\"]) {\n            const range = document.body[\"createTextRange\"]()\n            range.moveToElementText(node)\n            range.select()\n        } else if (window.getSelection) {\n            const selection = window.getSelection()\n            const range = document.createRange()\n            range.selectNodeContents(node)\n            selection.removeAllRanges()\n            selection.addRange(range)\n        } else {\n            console.warn(\"Could not select text in node: Unsupported browser.\")\n        }\n    }\n\n    public static sortedByLevenshteinDistance<T>(\n        reference: string,\n        ts: T[],\n        getName: (t: T) => string\n    ): T[] {\n        const withDistance: [T, number][] = ts.map((t) => [\n            t,\n            Utils.levenshteinDistance(getName(t), reference),\n        ])\n        withDistance.sort(([_, a], [__, b]) => a - b)\n        return withDistance.map((n) => n[0])\n    }\n\n    public static levenshteinDistance(str1: string, str2: string) {\n        const track = Array(str2.length + 1)\n            .fill(null)\n            .map(() => Array(str1.length + 1).fill(null))\n        for (let i = 0; i <= str1.length; i += 1) {\n            track[0][i] = i\n        }\n        for (let j = 0; j <= str2.length; j += 1) {\n            track[j][0] = j\n        }\n        for (let j = 1; j <= str2.length; j += 1) {\n            for (let i = 1; i <= str1.length; i += 1) {\n                const indicator = str1[i - 1] === str2[j - 1] ? 0 : 1\n                track[j][i] = Math.min(\n                    track[j][i - 1] + 1, // deletion\n                    track[j - 1][i] + 1, // insertion\n                    track[j - 1][i - 1] + indicator // substitution\n                )\n            }\n        }\n        return track[str2.length][str1.length]\n    }\n\n    public static MapToObj<V>(\n        d: Map<string, V>\n    ): Record<string, V>;\n    public static MapToObj<V, T>(\n        d: Map<string, V>,\n        onValue: (t: V, key: string) => T\n    ): Record<string, T>\n    public static MapToObj<V, T>(\n        d: Map<string, V>,\n        onValue: (t: V, key: string) => T = undefined\n    ): Record<string, T> {\n        const o = {}\n        const keys = Array.from(d.keys())\n        keys.sort()\n        onValue ??= (v => <any> v)\n        for (const key of keys) {\n            o[key] = onValue(d.get(key), key)\n        }\n        return o\n    }\n\n    /**\n     * Switches keys and values around\n     *\n     * Utils.TransposeMap({\"a\" : [\"b\", \"c\"], \"x\" : [\"b\", \"y\"]}) // => {\"b\" : [\"a\", \"x\"], \"c\" : [\"a\"], \"y\" : [\"x\"]}\n     */\n    public static TransposeMap<K extends string, V extends string>(\n        d: Record<K, V[]>\n    ): Record<V, K[]> {\n        const newD: Record<V, K[]> = <any>{}\n\n        for (const k in d) {\n            const vs = d[k]\n            for (const v of vs) {\n                const list = newD[v]\n                if (list === undefined) {\n                    newD[v] = [k] // Left: indexing; right: list with one element\n                } else {\n                    list.push(k)\n                }\n            }\n        }\n        return newD\n    }\n\n    /**\n     * Utils.colorAsHex({r: 255, g: 128, b: 0}) // => \"#ff8000\"\n     * Utils.colorAsHex(undefined) // => undefined\n     */\n    public static colorAsHex(c: { r: number; g: number; b: number }) {\n        if (c === undefined) {\n            return undefined\n        }\n\n        function componentToHex(n) {\n            const hex = n.toString(16)\n            return hex.length == 1 ? \"0\" + hex : hex\n        }\n\n        return \"#\" + componentToHex(c.r) + componentToHex(c.g) + componentToHex(c.b)\n    }\n\n    /**\n     *\n     * Utils.color(\"#ff8000\") // => {r: 255, g:128, b: 0}\n     * Utils.color(\" rgba  (12,34,56) \") // => {r: 12, g:34, b: 56}\n     * Utils.color(\" rgba  (12,34,56,0.5) \") // => {r: 12, g:34, b: 56}\n     * Utils.color(undefined) // => undefined\n     */\n    public static color(hex: string): { r: number; g: number; b: number } {\n        if (hex === undefined) {\n            return undefined\n        }\n        hex = hex.replace(/[ \\t]/g, \"\")\n        if (hex.startsWith(\"rgba(\")) {\n            const match = hex.match(/rgba\\(([0-9.]+),([0-9.]+),([0-9.]+)(,[0-9.]*)?\\)/)\n            if (match == undefined) {\n                return undefined\n            }\n            return { r: Number(match[1]), g: Number(match[2]), b: Number(match[3]) }\n        }\n\n        if (!hex.startsWith(\"#\")) {\n            return undefined\n        }\n        if (hex.length === 4) {\n            return {\n                r: parseInt(hex.substr(1, 1), 16),\n                g: parseInt(hex.substr(2, 1), 16),\n                b: parseInt(hex.substr(3, 1), 16),\n            }\n        }\n\n        return {\n            r: parseInt(hex.substr(1, 2), 16),\n            g: parseInt(hex.substr(3, 2), 16),\n            b: parseInt(hex.substr(5, 2), 16),\n        }\n    }\n\n    public static asDict(\n        tags: { key: string; value: string | number }[]\n    ): Map<string, string | number> {\n        const d = new Map<string, string | number>()\n\n        for (const tag of tags) {\n            d.set(tag.key, tag.value)\n        }\n\n        return d\n    }\n\n    static toIdRecord<T extends { id: string }>(ts: T[]): Record<string, T> {\n        const result: Record<string, T> = {}\n        for (const t of ts) {\n            result[t.id] = t\n        }\n        return result\n    }\n\n    public static SetMidnight(d: Date): void {\n        d.setUTCHours(0)\n        d.setUTCSeconds(0)\n        d.setUTCMilliseconds(0)\n        d.setUTCMinutes(0)\n    }\n\n    public static scrollIntoView(element: HTMLBaseElement | HTMLDivElement): void {\n        if (!element) {\n            return\n        }\n        // Is the element completely in the view?\n        const parentRect = Utils.findParentWithScrolling(element)?.getBoundingClientRect()\n        if (!parentRect) {\n            return\n        }\n        const elementRect = element.getBoundingClientRect()\n\n        // Check if the element is within the vertical bounds of the parent element\n        const topIsVisible = elementRect.top >= parentRect.top\n        const bottomIsVisible = elementRect.bottom <= parentRect.bottom\n        const inView = topIsVisible && bottomIsVisible\n        if (inView) {\n            return\n        }\n        element.scrollIntoView({ behavior: \"smooth\", block: \"nearest\" })\n    }\n\n    /**\n     * Returns true if the contents of `a` are the same (and in the same order) as `b`.\n     * Might have false negatives in some cases\n     * @param a\n     * @param b\n     */\n    public static sameList<T>(a: ReadonlyArray<T>, b: ReadonlyArray<T>) {\n        if (a == b) {\n            return true\n        }\n        if (a === undefined || a === null || b === undefined || b === null) {\n            return false\n        }\n        if (a.length !== b.length) {\n            return false\n        }\n        for (let i = 0; i < a.length; i++) {\n            const ai = a[i]\n            const bi = b[i]\n            if (ai == bi) {\n                continue\n            }\n            if (ai === bi) {\n                continue\n            }\n            return false\n        }\n        return true\n    }\n\n    public static SameObject(a: any, b: any) {\n        if (a === b) {\n            return true\n        }\n        if (a === undefined || a === null || b === null || b === undefined) {\n            return false\n        }\n        if (typeof a === \"object\" && typeof b === \"object\") {\n            for (const aKey in a) {\n                if (!(aKey in b)) {\n                    return false\n                }\n            }\n\n            for (const bKey in b) {\n                if (!(bKey in a)) {\n                    return false\n                }\n            }\n            for (const k in a) {\n                if (!Utils.SameObject(a[k], b[k])) {\n                    return false\n                }\n            }\n            return true\n        }\n        return false\n    }\n\n    /**\n     *\n     * Utils.splitIntoSubstitutionParts(\"abc\") // => [{message: \"abc\"}]\n     * Utils.splitIntoSubstitutionParts(\"abc {search} def\") // => [{message: \"abc \"}, {subs: \"search\"}, {message: \" def\"}]\n     *\n     */\n    public static splitIntoSubstitutionParts(\n        template: string\n    ): ({ message: string } | { subs: string })[] {\n        const preparts = template.split(\"{\")\n        const spec: ({ message: string } | { subs: string })[] = []\n        for (const prepart of preparts) {\n            const postParts = prepart.split(\"}\")\n            if (postParts.length === 1) {\n                // This was a normal part\n                spec.push({ message: postParts[0] })\n            } else {\n                const [subs, message] = postParts\n                spec.push({ subs })\n                if (message !== \"\") {\n                    spec.push({ message })\n                }\n            }\n        }\n        return spec\n    }\n\n    /**\n     * Returns the file and line number of the code calling this\n     */\n    public static getLocationInCode(offset: number = 0): {\n        path: string\n        line: number\n        column: number\n        markdownLocation: string\n        filename: string\n        functionName: string\n    } {\n        const error = new Error(\"No error\")\n        const stack = error.stack.split(\"\\n\")\n        stack.shift() // Remove \"Error: No error\"\n        const regex = /at (.*) \\(([a-zA-Z0-9/.]+):([0-9]+):([0-9]+)\\)/\n        const stackItem = stack[Math.abs(offset) + 1]\n\n        let functionName: string\n        let path: string\n        let line: string\n        let column: string\n        let _: string\n        const matchWithFuncName = stackItem.match(regex)\n        if (matchWithFuncName) {\n            ;[_, functionName, path, line, column] = matchWithFuncName\n        } else {\n            const regexNoFuncName: RegExp = new RegExp(\"at ([a-zA-Z0-9/.]+):([0-9]+):([0-9]+)\")\n            ;[_, path, line, column] = stackItem.match(regexNoFuncName)\n        }\n\n        const markdownLocation = path.substring(path.indexOf(\"MapComplete/src\") + 11) + \"#L\" + line\n        return {\n            path,\n            functionName,\n            line: Number(line),\n            column: Number(column),\n            markdownLocation,\n            filename: path.substring(path.lastIndexOf(\"/\") + 1),\n        }\n    }\n\n    public static RemoveDiacritics(str?: string): string {\n        if (!str) {\n            return str\n        }\n        return str.normalize(\"NFD\").replace(/\\p{Diacritic}/gu, \"\")\n    }\n\n    public static randomString(length: number): string {\n        let result = \"\"\n        for (let i = 0; i < length; i++) {\n            const chr = Math.random().toString(36).substr(2, 3)\n            result += chr\n        }\n        return result\n    }\n\n    /**\n     * Recursively rewrites all keys from `+key`, `key+` and `=key` into `key\n     *\n     * Utils.CleanMergeObject({\"condition\":{\"and+\":[\"xyz\"]}} // => {\"condition\":{\"and\":[\"xyz\"]}}\n     * @param obj\n     * @constructor\n     * @private\n     */\n    private static CleanMergeObject(obj: any) {\n        if (Array.isArray(obj)) {\n            const result = []\n            for (const el of obj) {\n                result.push(Utils.CleanMergeObject(el))\n            }\n            return result\n        }\n        if (typeof obj !== \"object\") {\n            return obj\n        }\n        const newObj = {}\n        for (let objKey in obj) {\n            let cleanKey = objKey\n            if (objKey.startsWith(\"+\") || objKey.startsWith(\"=\")) {\n                cleanKey = objKey.substring(1)\n            } else if (objKey.endsWith(\"+\") || objKey.endsWith(\"=\")) {\n                cleanKey = objKey.substring(0, objKey.length - 1)\n            }\n            newObj[cleanKey] = Utils.CleanMergeObject(obj[objKey])\n        }\n        return newObj\n    }\n\n    public static focusOn(el: HTMLElement): void {\n        if (!el) {\n            return\n        }\n        requestAnimationFrame(() => {\n            el.focus()\n        })\n    }\n\n    /**\n     * Searches a child that can be focused on, by first selecting a 'focusable', then a button, then a link\n     *\n     * Returns the focussed element\n     * @param el\n     */\n    public static focusOnFocusableChild(el: HTMLElement): void {\n        if (!el) {\n            return\n        }\n        requestAnimationFrame(() => {\n            let childs = el.getElementsByClassName(\"focusable\")\n            if (childs.length == 0) {\n                childs = el.getElementsByTagName(\"button\")\n                if (childs.length === 0) {\n                    childs = el.getElementsByTagName(\"a\")\n                }\n            }\n            const child = <HTMLElement>childs.item(0)\n            if (child === null) {\n                return undefined\n            }\n            if (\n                child.tagName !== \"button\" &&\n                child.tagName !== \"a\" &&\n                child.hasAttribute(\"tabindex\")\n            ) {\n                child.setAttribute(\"tabindex\", \"-1\")\n            }\n            child?.focus()\n        })\n    }\n\n    private static findParentWithScrolling(\n        element: HTMLBaseElement | HTMLDivElement\n    ): HTMLBaseElement | HTMLDivElement {\n        // Check if the element itself has scrolling\n        if (element.scrollHeight > element.clientHeight) {\n            return element\n        }\n\n        // If the element does not have scrolling, check if it has a parent element\n        if (!element.parentElement) {\n            return null\n        }\n\n        // If the element has a parent, repeat the process for the parent element\n        return Utils.findParentWithScrolling(<HTMLBaseElement>element.parentElement)\n    }\n\n    private static colorDiff(\n        c0: { r: number; g: number; b: number },\n        c1: { r: number; g: number; b: number }\n    ) {\n        return Math.abs(c0.r - c1.r) + Math.abs(c0.g - c1.g) + Math.abs(c0.b - c1.b)\n    }\n\n    private static readonly _metrixPrefixes = [\"\", \"k\", \"M\", \"G\", \"T\", \"P\", \"E\"]\n    /**\n     * Converts a big number (e.g. 1000000) into a rounded postfixed verion (e.g. 1M)\n     *\n     * Supported metric prefixes are: [k, M, G, T, P, E]\n     */\n    public static numberWithMetricPrefix(n: number) {\n        let index = 0\n        while (n > 1000) {\n            n = Math.round(n / 1000)\n            index++\n        }\n        return n + Utils._metrixPrefixes[index]\n    }\n\n    static NoNullInplace(layers: any[]): void {\n        for (let i = layers.length - 1; i >= 0; i--) {\n            if (layers[i] === null || layers[i] === undefined) {\n                layers.splice(i, 1)\n            }\n        }\n    }\n\n    private static emojiRegex = /^\\p{Extended_Pictographic}+$/u\n\n    /**\n     * Returns 'true' if the given string contains at least one and only emoji characters\n     * @param string\n     */\n    public static isEmoji(string: string) {\n        return Utils.emojiRegex.test(string)\n    }\n}\n","import { Utils } from \"../Utils\"\nimport { Readable, Subscriber, Unsubscriber, Updater, Writable } from \"svelte/store\"\n\n/**\n * Various static utils\n */\nexport class Stores {\n    public static Chronic(millis: number, asLong: () => boolean = undefined): Store<Date> {\n        const source = new UIEventSource<Date>(undefined)\n\n        function run() {\n            source.setData(new Date())\n            if (Utils.runningFromConsole) {\n                return\n            }\n            if (asLong === undefined || asLong()) {\n                window.setTimeout(run, millis)\n            }\n        }\n\n        run()\n        return source\n    }\n\n    public static FromPromiseWithErr<T>(\n        promise: Promise<T>\n    ): Store<{ success: T } | { error: any }> {\n        return UIEventSource.FromPromiseWithErr(promise)\n    }\n\n    /**\n     * Converts a promise into a UIVentsource, sets the UIEVentSource when the result is calculated.\n     * If the promise fails, the value will stay undefined\n     * @param promise\n     * @constructor\n     */\n    public static FromPromise<T>(promise: Promise<T>): Store<T | undefined> {\n        const src = new UIEventSource<T>(undefined)\n        promise?.then((d) => src.setData(d))\n        promise?.catch((err) => console.warn(\"Promise failed:\", err))\n        return src\n    }\n\n    public static flatten<X>(source: Store<Store<X>>, possibleSources?: Store<any>[]): Store<X> {\n        return UIEventSource.flatten(source, possibleSources)\n    }\n\n    /**\n     * Given a UIEVentSource with a list, returns a new UIEventSource which is only updated if the _contents_ of the list are different.\n     * E.g.\n     * const src = new UIEventSource([1,2,3])\n     * const stable = UIEventSource.ListStabilized(src)\n     * src.addCallback(_ => console.log(\"src pinged\"))\n     * stable.addCallback(_ => console.log(\"stable pinged))\n     * src.setDate([...src.data])\n     *\n     * This will only trigger 'src pinged'\n     *\n     * @param src\n     * @constructor\n     */\n    public static ListStabilized<T>(src: Store<T[]>): Store<T[]> {\n        const stable = new UIEventSource<T[]>(undefined)\n        src.addCallbackAndRun((list) => {\n            if (list === undefined) {\n                stable.setData(undefined)\n                return\n            }\n            if (Utils.sameList(stable.data, list)) {\n                return\n            }\n            stable.setData(list)\n        })\n        return stable\n    }\n}\n\nexport abstract class Store<T> implements Readable<T> {\n    abstract readonly data: T\n\n    /**\n     * Optional value giving a title to the UIEventSource, mainly used for debugging\n     */\n    public readonly tag: string | undefined\n\n    constructor(tag: string = undefined) {\n        this.tag = tag\n        if (tag === undefined || tag === \"\") {\n            let createStack = Utils.runningFromConsole\n            if (!Utils.runningFromConsole) {\n                createStack = window.location.hostname === \"127.0.0.1\"\n            }\n            if (createStack) {\n                const callstack = new Error().stack.split(\"\\n\")\n                this.tag = callstack[1]\n            }\n        }\n    }\n\n    abstract map<J>(f: (t: T) => J): Store<J>\n    abstract map<J>(f: (t: T) => J, extraStoresToWatch: Store<any>[]): Store<J>\n    abstract map<J>(\n        f: (t: T) => J,\n        extraStoresToWatch: Store<any>[],\n        callbackDestroyFunction: (f: () => void) => void\n    ): Store<J>\n    M\n    public mapD<J>(\n        f: (t: Exclude<T, undefined | null>) => J,\n        extraStoresToWatch?: Store<any>[],\n        callbackDestroyFunction?: (f: () => void) => void\n    ): Store<J> {\n        return this.map((t) => {\n            if (t === undefined) {\n                return undefined\n            }\n            if (t === null) {\n                return null\n            }\n            return f(<Exclude<T, undefined | null>>t)\n        }, extraStoresToWatch)\n    }\n\n    /**\n     * Add a callback function which will run on future data changes\n     */\n    abstract addCallback(callback: (data: T) => void): () => void\n\n    /**\n     * Adds a callback function, which will be run immediately.\n     * Only triggers if the current data is defined\n     */\n    abstract addCallbackAndRunD(callback: (data: T) => void): () => void\n\n    /**\n     * Add a callback function which will run on future data changes\n     * Only triggers if the data is defined\n     */\n    abstract addCallbackD(callback: (data: T) => void): () => void\n\n    /**\n     * Adds a callback function, which will be run immediately.\n     * Only triggers if the current data is defined\n     */\n    abstract addCallbackAndRun(callback: (data: T) => void): () => void\n\n    public withEqualityStabilized(\n        comparator: (t: T | undefined, t1: T | undefined) => boolean\n    ): Store<T> {\n        let oldValue = undefined\n        return this.map((v) => {\n            if (v == oldValue) {\n                return oldValue\n            }\n            if (comparator(oldValue, v)) {\n                return oldValue\n            }\n            oldValue = v\n            return v\n        })\n    }\n\n    /**\n     * Monadic bind function\n     *\n     * // simple test with bound and immutablestores\n     * const src = new UIEventSource<number>(3)\n     * const bound = src.bind(i => new ImmutableStore(i * 2))\n     * let lastValue = undefined;\n     * bound.addCallbackAndRun(v => lastValue = v);\n     * lastValue // => 6\n     * src.setData(21)\n     * lastValue // => 42\n     *\n     * // simple test with bind over a mapped value\n     * const src = new UIEventSource<number>(0)\n     * const srcs : UIEventSource<string>[] = [new UIEventSource<string>(\"a\"), new UIEventSource<string>(\"b\")]\n     * const bound = src.map(i => -i).bind(i => srcs[i])\n     * let lastValue : string = undefined;\n     * bound.addCallbackAndRun(v => lastValue = v);\n     * lastValue // => \"a\"\n     * src.setData(-1)\n     * lastValue // => \"b\"\n     * srcs[1].setData(\"xyz\")\n     * lastValue // => \"xyz\"\n     * srcs[0].setData(\"def\")\n     * lastValue // => \"xyz\"\n     * src.setData(0)\n     * lastValue // => \"def\"\n     *\n     *\n     *\n     * // advanced test with bound\n     * const src = new UIEventSource<number>(0)\n     * const srcs : UIEventSource<string>[] = [new UIEventSource<string>(\"a\"), new UIEventSource<string>(\"b\")]\n     * const bound = src.bind(i => srcs[i])\n     * let lastValue : string = undefined;\n     * bound.addCallbackAndRun(v => lastValue = v);\n     * lastValue // => \"a\"\n     * src.setData(1)\n     * lastValue // => \"b\"\n     * srcs[1].setData(\"xyz\")\n     * lastValue // => \"xyz\"\n     * srcs[0].setData(\"def\")\n     * lastValue // => \"xyz\"\n     * src.setData(0)\n     * lastValue // => \"def\"\n     */\n    public bind<X>(f: (t: T) => Store<X>): Store<X> {\n        const mapped = this.map(f)\n        const sink = new UIEventSource<X>(undefined)\n        const seenEventSources = new Set<Store<X>>()\n        mapped.addCallbackAndRun((newEventSource) => {\n            if (newEventSource === null) {\n                sink.setData(null)\n                return\n            }\n            if (newEventSource === undefined) {\n                sink.setData(undefined)\n                return\n            }\n            if (seenEventSources.has(newEventSource)) {\n                // Already seen, so we don't have to add a callback, just update the value\n                sink.setData(newEventSource.data)\n                return\n            }\n            seenEventSources.add(newEventSource)\n            newEventSource.addCallbackAndRun((resultData) => {\n                if (mapped.data === newEventSource) {\n                    sink.setData(resultData)\n                }\n            })\n        })\n\n        return sink\n    }\n\n    public bindD<X>(f: (t: Exclude<T, undefined | null>) => Store<X>): Store<X> {\n        return this.bind((t) => {\n            if (t === null) {\n                return null\n            }\n            if (t === undefined) {\n                return undefined\n            }\n            return f(<Exclude<T, undefined | null>>t)\n        })\n    }\n    public stabilized(millisToStabilize): Store<T> {\n        if (Utils.runningFromConsole) {\n            return this\n        }\n\n        const newSource = new UIEventSource<T>(this.data)\n\n        const self = this\n        this.addCallback((latestData) => {\n            window.setTimeout(() => {\n                if (self.data == latestData) {\n                    // compare by reference.\n                    // Note that 'latestData' and 'self.data' are both from the same UIEVentSource, but both are dereferenced at a different time\n                    newSource.setData(latestData)\n                }\n            }, millisToStabilize)\n        })\n\n        return newSource\n    }\n\n    /**\n     * Converts the uiEventSource into a promise.\n     * The promise will return the value of the store if the given condition evaluates to true\n     * @param condition an optional condition, default to 'store.value !== undefined'\n     * @constructor\n     */\n    public AsPromise(condition?: (t: T) => boolean): Promise<T> {\n        const self = this\n        condition = condition ?? ((t) => t !== undefined)\n        return new Promise((resolve) => {\n            const data = self.data\n            if (condition(data)) {\n                resolve(data)\n            } else {\n                self.addCallbackD((data) => {\n                    if (condition(data)) {\n                        resolve(data)\n                        return true // return true to unregister as we only need to be called once\n                    } else {\n                        return false // We didn't resolve yet, wait for the next ping\n                    }\n                })\n            }\n        })\n    }\n\n    /**\n     * Same as 'addCallbackAndRun', added to be compatible with Svelte\n     */\n    public subscribe(run: Subscriber<T> & ((value: T) => void), _?): Unsubscriber {\n        // We don't need to do anything with 'invalidate', see\n        // https://github.com/sveltejs/svelte/issues/3859\n\n        // Note: run is wrapped in an anonymous function. 'Run' returns the value. If this value happens to be true, it would unsubscribe\n        return this.addCallbackAndRun((v) => {\n            run(v)\n        })\n    }\n}\n\nexport class ImmutableStore<T> extends Store<T> {\n    public readonly data: T\n    static FALSE = new ImmutableStore<boolean>(false)\n    static TRUE = new ImmutableStore<boolean>(true)\n    constructor(data: T) {\n        super()\n        this.data = data\n    }\n\n    private static readonly pass: () => void = () => {}\n\n    addCallback(_: (data: T) => void): () => void {\n        // pass: data will never change\n        return ImmutableStore.pass\n    }\n\n    addCallbackAndRun(callback: (data: T) => void): () => void {\n        callback(this.data)\n        // no callback registry: data will never change\n        return ImmutableStore.pass\n    }\n\n    addCallbackAndRunD(callback: (data: T) => void): () => void {\n        if (this.data !== undefined) {\n            callback(this.data)\n        }\n        // no callback registry: data will never change\n        return ImmutableStore.pass\n    }\n\n    addCallbackD(_: (data: T) => void): () => void {\n        // pass: data will never change\n        return ImmutableStore.pass\n    }\n\n    map<J>(\n        f: (t: T) => J,\n        extraStores: Store<any>[] = undefined,\n        ondestroyCallback?: (f: () => void) => void\n    ): ImmutableStore<J> {\n        if (extraStores?.length > 0) {\n            return new MappedStore(this, f, extraStores, undefined, f(this.data), ondestroyCallback)\n        }\n        return new ImmutableStore<J>(f(this.data))\n    }\n}\n\n/**\n * Keeps track of the callback functions\n */\nclass ListenerTracker<T> {\n    public pingCount = 0\n    private readonly _callbacks: ((t: T) => boolean | void | any)[] = []\n\n    /**\n     * Adds a callback which can be called; a function to unregister is returned\n     */\n    public addCallback(callback: (t: T) => boolean | void | any): () => void {\n        if (callback === console.log) {\n            // This ^^^ actually works!\n            throw \"Don't add console.log directly as a callback - you'll won't be able to find it afterwards. Wrap it in a lambda instead.\"\n        }\n        this._callbacks.push(callback)\n\n        // Give back an unregister-function!\n        return () => {\n            const index = this._callbacks.indexOf(callback)\n            if (index >= 0) {\n                this._callbacks.splice(index, 1)\n            }\n        }\n    }\n\n    /**\n     * Call all the callbacks.\n     * Returns the number of registered callbacks\n     */\n    public ping(data: T): number {\n        this.pingCount++\n        let toDelete = undefined\n        let startTime = new Date().getTime() / 1000\n        for (const callback of this._callbacks) {\n            try {\n                if (callback(data) === true) {\n                    // This callback wants to be deleted\n                    // Note: it has to return precisely true in order to avoid accidental deletions\n                    if (toDelete === undefined) {\n                        toDelete = [callback]\n                    } else {\n                        toDelete.push(callback)\n                    }\n                }\n            } catch (e) {\n                console.error(\"Got an error while running a callback:\", e)\n            }\n        }\n        let endTime = new Date().getTime() / 1000\n        if (endTime - startTime > 500) {\n            console.trace(\n                \"Warning: a ping took more then 500ms; this is probably a performance issue\"\n            )\n        }\n        if (toDelete !== undefined) {\n            for (const toDeleteElement of toDelete) {\n                this._callbacks.splice(this._callbacks.indexOf(toDeleteElement), 1)\n            }\n        }\n        return this._callbacks.length\n    }\n\n    length() {\n        return this._callbacks.length\n    }\n}\n\n/**\n * The mapped store is a helper type which does the mapping of a function.\n */\nclass MappedStore<TIn, T> extends Store<T> {\n    private static readonly pass: () => {}\n    private readonly _upstream: Store<TIn>\n    private readonly _upstreamCallbackHandler: ListenerTracker<TIn> | undefined\n    private _upstreamPingCount: number = -1\n    private _unregisterFromUpstream: () => void\n    private readonly _f: (t: TIn) => T\n    private readonly _extraStores: Store<any>[] | undefined\n    private _unregisterFromExtraStores: (() => void)[] | undefined\n    private _callbacks: ListenerTracker<T> = new ListenerTracker<T>()\n    private _callbacksAreRegistered = false\n\n    constructor(\n        upstream: Store<TIn>,\n        f: (t: TIn) => T,\n        extraStores: Store<any>[],\n        upstreamListenerHandler: ListenerTracker<TIn> | undefined,\n        initialState: T,\n        onDestroy?: (f: () => void) => void\n    ) {\n        super()\n        this._upstream = upstream\n        this._upstreamCallbackHandler = upstreamListenerHandler\n        this._f = f\n        this._data = initialState\n        this._upstreamPingCount = upstreamListenerHandler?.pingCount\n        this._extraStores = extraStores\n        this.registerCallbacksToUpstream()\n        if (onDestroy !== undefined) {\n            onDestroy(() => this.unregisterFromUpstream())\n        }\n    }\n\n    private _data: T\n\n    /**\n     * Gets the current data from the store\n     *\n     * const src = new UIEventSource(21)\n     * const mapped = src.map(i => i * 2)\n     * src.setData(3)\n     * mapped.data // => 6\n     */\n    get data(): T {\n        if (!this._callbacksAreRegistered) {\n            // Callbacks are not registered, so we haven't been listening for updates from the upstream which might have changed\n            if (this._upstreamCallbackHandler?.pingCount != this._upstreamPingCount) {\n                // Upstream has pinged - let's update our data first\n                this._data = this._f(this._upstream.data)\n            }\n            return this._data\n        }\n        return this._data\n    }\n\n    map<J>(\n        f: (t: T) => J,\n        extraStores: Store<any>[] = undefined,\n        ondestroyCallback?: (f: () => void) => void\n    ): Store<J> {\n        let stores: Store<any>[] = undefined\n        if (extraStores?.length > 0 || this._extraStores?.length > 0) {\n            stores = []\n        }\n        if (extraStores?.length > 0) {\n            stores?.push(...extraStores)\n        }\n        if (this._extraStores?.length > 0) {\n            this._extraStores?.forEach((store) => {\n                if (stores.indexOf(store) < 0) {\n                    stores.push(store)\n                }\n            })\n        }\n        return new MappedStore(\n            this,\n            f, // we could fuse the functions here (e.g. data => f(this._f(data), but this might result in _f being calculated multiple times, breaking things\n            stores,\n            this._callbacks,\n            f(this.data),\n            ondestroyCallback\n        )\n    }\n\n    addCallback(callback: (data: T) => any | boolean | void): () => void {\n        if (!this._callbacksAreRegistered) {\n            // This is the first callback that is added\n            // We register this 'map' to the upstream object and all the streams\n            this.registerCallbacksToUpstream()\n        }\n        const unregister = this._callbacks.addCallback(callback)\n        return () => {\n            unregister()\n            if (this._callbacks.length() == 0) {\n                this.unregisterFromUpstream()\n            }\n        }\n    }\n\n    addCallbackAndRun(callback: (data: T) => any | boolean | void): () => void {\n        const unregister = this.addCallback(callback)\n        const doRemove = callback(this.data)\n        if (doRemove === true) {\n            unregister()\n            return MappedStore.pass\n        }\n        return unregister\n    }\n\n    addCallbackAndRunD(callback: (data: T) => any | boolean | void): () => void {\n        return this.addCallbackAndRun((data) => {\n            if (data !== undefined) {\n                return callback(data)\n            }\n        })\n    }\n\n    addCallbackD(callback: (data: T) => any | boolean | void): () => void {\n        return this.addCallback((data) => {\n            if (data !== undefined) {\n                return callback(data)\n            }\n        })\n    }\n\n    private unregisterFromUpstream() {\n        this._callbacksAreRegistered = false\n        this._unregisterFromUpstream()\n        this._unregisterFromExtraStores?.forEach((unr) => unr())\n    }\n\n    private registerCallbacksToUpstream() {\n        const self = this\n\n        this._unregisterFromUpstream = this._upstream.addCallback((_) => self.update())\n        this._unregisterFromExtraStores = this._extraStores?.map((store) =>\n            store?.addCallback((_) => self.update())\n        )\n        this._callbacksAreRegistered = true\n    }\n\n    private update(): void {\n        const newData = this._f(this._upstream.data)\n        this._upstreamPingCount = this._upstreamCallbackHandler?.pingCount\n        if (this._data === newData) {\n            return\n        }\n        this._data = newData\n        this._callbacks.ping(this._data)\n    }\n}\n\nexport class UIEventSource<T> extends Store<T> implements Writable<T> {\n    private static readonly pass: () => {}\n    public data: T\n    _callbacks: ListenerTracker<T> = new ListenerTracker<T>()\n\n    constructor(data: T, tag: string = \"\") {\n        super(tag)\n        this.data = data\n    }\n\n    public static flatten<X>(\n        source: Store<Store<X>>,\n        possibleSources?: Store<any>[]\n    ): UIEventSource<X> {\n        const sink = new UIEventSource<X>(source.data?.data)\n\n        source.addCallback((latestData) => {\n            sink.setData(latestData?.data)\n            latestData.addCallback((data) => {\n                if (source.data !== latestData) {\n                    return true\n                }\n                sink.setData(data)\n            })\n        })\n\n        for (const possibleSource of possibleSources ?? []) {\n            possibleSource?.addCallback(() => {\n                sink.setData(source.data?.data)\n            })\n        }\n\n        return sink\n    }\n\n    /**\n     * Converts a promise into a UIVentsource, sets the UIEVentSource when the result is calculated.\n     * If the promise fails, the value will stay undefined, but 'onError' will be called\n     */\n    public static FromPromise<T>(\n        promise: Promise<T>,\n        onError: (e: any) => void = undefined\n    ): UIEventSource<T> {\n        const src = new UIEventSource<T>(undefined)\n        promise?.then((d) => src.setData(d))\n        promise?.catch((err) => {\n            if (onError !== undefined) {\n                onError(err)\n            } else {\n                console.warn(\"Promise failed:\", err)\n            }\n        })\n        return src\n    }\n\n    /**\n     * Converts a promise into a UIVentsource, sets the UIEVentSource when the result is calculated.\n     * If the promise fails, the value will stay undefined\n     * @param promise\n     * @constructor\n     */\n    public static FromPromiseWithErr<T>(\n        promise: Promise<T>\n    ): UIEventSource<{ success: T } | { error: any } | undefined> {\n        const src = new UIEventSource<{ success: T } | { error: any }>(undefined)\n        promise\n            ?.then((d) => src.setData({ success: d }))\n            ?.catch((err) => src.setData({ error: err }))\n        return src\n    }\n\n    /**\n     *\n     * @param source\n     * UIEventSource.asInt(new UIEventSource(\"123\")).data // => 123\n     * UIEventSource.asInt(new UIEventSource(\"123456789\")).data // => 123456789\n     *\n     * const srcStr = new UIEventSource(\"123456789\"))\n     * const srcInt = UIEventSource.asInt(srcStr)\n     * srcInt.setData(987654321)\n     * srcStr.data // => \"987654321\"\n     */\n    public static asInt(source: UIEventSource<string>): UIEventSource<number> {\n        return source.sync(\n            (str) => {\n                let parsed = parseInt(str)\n                return isNaN(parsed) ? undefined : parsed\n            },\n            [],\n            (fl) => {\n                if (fl === undefined || isNaN(fl)) {\n                    return undefined\n                }\n                return \"\" + fl\n            }\n        )\n    }\n\n    /**\n     * UIEventSource.asFloat(new UIEventSource(\"123\")).data // => 123\n     * UIEventSource.asFloat(new UIEventSource(\"123456789\")).data // => 123456789\n     * UIEventSource.asFloat(new UIEventSource(\"0.5\")).data // => 0.5\n     * UIEventSource.asFloat(new UIEventSource(\"0.125\")).data // => 0.125\n     * UIEventSource.asFloat(new UIEventSource(\"0.0000000001\")).data // => 0.0000000001\n     *\n     *\n     * const srcStr = new UIEventSource(\"123456789\"))\n     * const srcInt = UIEventSource.asFloat(srcStr)\n     * srcInt.setData(987654321)\n     * srcStr.data // => \"987654321\"\n     * @param source\n     */\n\n    public static asFloat(source: UIEventSource<string>): UIEventSource<number> {\n        return source.sync(\n            (str) => {\n                let parsed = parseFloat(str)\n                return isNaN(parsed) ? undefined : parsed\n            },\n            [],\n            (fl) => {\n                if (fl === undefined || isNaN(fl)) {\n                    return undefined\n                }\n                return \"\" + fl\n            }\n        )\n    }\n\n    static asBoolean(stringUIEventSource: UIEventSource<string>): UIEventSource<boolean> {\n        return stringUIEventSource.sync(\n            (str) => str === \"true\",\n            [],\n            (b) => \"\" + b\n        )\n    }\n\n    /**\n     * Create a new UIEVentSource. Whenever 'source' changes, the returned UIEventSource will get this value as well.\n     * However, this value can be overriden without affecting source\n     */\n    static feedFrom<T>(store: Store<T>): UIEventSource<T> {\n        const src = new UIEventSource(store.data)\n        store.addCallback((t) => src.setData(t))\n        return src\n    }\n\n    /**\n     * Adds a callback\n     *\n     * If the result of the callback is 'true', the callback is considered finished and will be removed again\n     * @param callback\n     */\n    public addCallback(callback: (latestData: T) => boolean | void | any): () => void {\n        return this._callbacks.addCallback(callback)\n    }\n\n    public addCallbackAndRun(callback: (latestData: T) => boolean | void | any): () => void {\n        const doDeleteCallback = callback(this.data)\n        if (doDeleteCallback !== true) {\n            return this.addCallback(callback)\n        } else {\n            return UIEventSource.pass\n        }\n    }\n\n    public addCallbackAndRunD(callback: (data: T) => void): () => void {\n        return this.addCallbackAndRun((data) => {\n            if (data !== undefined && data !== null) {\n                return callback(data)\n            }\n        })\n    }\n\n    public addCallbackD(callback: (data: T) => void): () => void {\n        return this.addCallback((data) => {\n            if (data !== undefined && data !== null) {\n                return callback(data)\n            }\n        })\n    }\n\n    public setData(t: T): UIEventSource<T> {\n        if (this.data == t) {\n            // MUST COMPARE BY REFERENCE!\n            return\n        }\n        this.data = t\n        this._callbacks.ping(t)\n        return this\n    }\n\n    public ping(): void {\n        this._callbacks.ping(this.data)\n    }\n\n    /**\n     * Monoidal map which results in a read-only store\n     * Given a function 'f', will construct a new UIEventSource where the contents will always be \"f(this.data)'\n     * @param f The transforming function\n     * @param extraSources also trigger the update if one of these sources change\n     * @param onDestroy a callback that can trigger the destroy function\n     *\n     * const src = new UIEventSource<number>(10)\n     * const store = src.map(i => i * 2)\n     * store.data // => 20\n     * let srcSeen = undefined;\n     * src.addCallback(v => {\n     *     console.log(\"Triggered\")\n     *     srcSeen = v\n     * })\n     * let lastSeen = undefined\n     * store.addCallback(v => {\n     *     console.log(\"Triggered!\")\n     *     lastSeen = v\n     * })\n     * src.setData(21)\n     * srcSeen // => 21\n     * lastSeen // => 42\n     */\n    public map<J>(\n        f: (t: T) => J,\n        extraSources: Store<any>[] = [],\n        onDestroy?: (f: () => void) => void\n    ): Store<J> {\n        return new MappedStore(this, f, extraSources, this._callbacks, f(this.data), onDestroy)\n    }\n\n    /**\n     * Monoidal map which results in a read-only store. 'undefined' is passed 'as is'\n     * Given a function 'f', will construct a new UIEventSource where the contents will always be \"f(this.data)'\n     */\n    public mapD<J>(\n        f: (t: Exclude<T, undefined | null>) => J,\n        extraSources: Store<any>[] = [],\n        callbackDestroyFunction?: (f: () => void) => void\n    ): Store<J | undefined> {\n        return new MappedStore(\n            this,\n            (t) => {\n                if (t === undefined) {\n                    return undefined\n                }\n                if (t === null) {\n                    return null\n                }\n                return f(<Exclude<T, undefined | null>>t)\n            },\n            extraSources,\n            this._callbacks,\n            this.data === undefined || this.data === null\n                ? <undefined | null>this.data\n                : f(<any>this.data),\n            callbackDestroyFunction\n        )\n    }\n\n    public mapAsyncD<J>(f: (t: T) => Promise<J>): Store<J> {\n        return this.bindD((t) => UIEventSource.FromPromise(f(t)))\n    }\n\n    /**\n     * Two way sync with functions in both directions\n     * Given a function 'f', will construct a new UIEventSource where the contents will always be \"f(this.data)'\n     * @param f The transforming function\n     * @param extraSources also trigger the update if one of these sources change\n     * @param g a 'backfunction to let the sync run in two directions. (data of the new UIEVEntSource, currentData) => newData\n     * @param allowUnregister if set, the update will be halted if no listeners are registered\n     */\n    public sync<J>(\n        f: (t: T) => J,\n        extraSources: Store<any>[],\n        g: (j: J, t: T) => T,\n        allowUnregister = false\n    ): UIEventSource<J> {\n        const self = this\n\n        const stack = new Error().stack.split(\"\\n\")\n        const callee = stack[1]\n\n        const newSource = new UIEventSource<J>(f(this.data), \"map(\" + this.tag + \")@\" + callee)\n\n        const update = function () {\n            newSource.setData(f(self.data))\n            return allowUnregister && newSource._callbacks.length() === 0\n        }\n\n        this.addCallback(update)\n        for (const extraSource of extraSources) {\n            extraSource?.addCallback(update)\n        }\n\n        if (g !== undefined) {\n            newSource.addCallback((latest) => {\n                self.setData(g(latest, self.data))\n            })\n        }\n\n        return newSource\n    }\n\n    public syncWith(otherSource: UIEventSource<T>, reverseOverride = false): UIEventSource<T> {\n        this.addCallback((latest) => otherSource.setData(latest))\n        const self = this\n        otherSource.addCallback((latest) => self.setData(latest))\n        if (reverseOverride) {\n            if (otherSource.data !== undefined) {\n                this.setData(otherSource.data)\n            }\n        } else if (this.data === undefined) {\n            this.setData(otherSource.data)\n        } else {\n            otherSource.setData(this.data)\n        }\n        return this\n    }\n\n    set(value: T): void {\n        this.setData(value)\n    }\n\n    update(f: Updater<T> & ((value: T) => T)): void {\n        this.setData(f(this.data))\n    }\n}\n","import * as packagefile from \"../../package.json\"\nimport * as extraconfig from \"../../config.json\"\nimport { Utils } from \"../Utils\"\nimport { AuthConfig } from \"../Logic/Osm/AuthConfig\"\n\nexport type PriviligedLayerType = (typeof Constants.priviliged_layers)[number]\n\nexport default class Constants {\n    public static vNumber: string = packagefile.version\n    /**\n     * API key for Maproulette\n     *\n     * There is no user-friendly way to get the user's API key currently.\n     * See https://github.com/maproulette/maproulette2/issues/476 for more information.\n     * Using an empty string however does work for most actions, but will attribute all actions to the Superuser.\n     */\n    public static readonly MaprouletteApiKey = \"\"\n    public static readonly added_by_default = [\n        \"selected_element\",\n        \"gps_location\",\n        \"gps_location_history\",\n        \"home_location\",\n        \"gps_track\",\n        \"range\",\n        \"last_click\",\n        \"favourite\",\n        \"summary\",\n    ] as const\n    /**\n     * Special layers which are not included in a theme by default\n     */\n    public static readonly no_include = [\n        \"conflation\",\n        \"split_point\",\n        \"split_road\",\n        \"current_view\",\n        \"import_candidate\",\n        \"usersettings\",\n        \"icons\",\n        \"filters\",\n    ] as const\n    /**\n     * Layer IDs of layers which have special properties through built-in hooks\n     */\n    public static readonly priviliged_layers = [\n        ...Constants.added_by_default,\n        ...Constants.no_include,\n    ] as const\n    // The user journey states thresholds when a new feature gets unlocked\n    public static userJourney = {\n        moreScreenUnlock: 1,\n        personalLayoutUnlock: 5,\n        historyLinkVisible: 10,\n        deletePointsOfOthersUnlock: 20,\n        tagsVisibleAt: 25,\n        tagsVisibleAndWikiLinked: 30,\n\n        mapCompleteHelpUnlock: 50,\n        themeGeneratorReadOnlyUnlock: 50,\n        themeGeneratorFullUnlock: 500,\n        addNewPointWithUnreadMessagesUnlock: 500,\n\n        importHelperUnlock: 5000,\n    }\n    static readonly minZoomLevelToAddNewPoint = Constants.isRetina() ? 17 : 18\n    /**\n     * Used by 'PendingChangesUploader', which waits this amount of seconds to upload changes.\n     * (Note that pendingChanges might upload sooner if the popup is closed or similar)\n     */\n    static updateTimeoutSec: number = 15\n    /**\n     * If the contributor has their GPS location enabled and makes a change,\n     * the points visited less then `nearbyVisitTime`-seconds ago will be inspected.\n     * The point closest to the changed feature will be considered and this distance will be tracked.\n     * ALl these distances are used to calculate a nearby-score\n     */\n    static nearbyVisitTime: number = 30 * 60\n    /**\n     * If a user makes a change, the distance to the changed object is calculated.\n     * If a user makes multiple changes, all these distances are put into multiple bins, depending on this distance.\n     * For every bin, the totals are uploaded as metadata\n     */\n    static distanceToChangeObjectBins = [25, 50, 100, 500, 1000, 5000, Number.MAX_VALUE]\n    static themeOrder = [\n        \"personal\",\n        \"cyclofix\",\n        \"waste\",\n        \"etymology\",\n        \"food\",\n        \"cafes_and_pubs\",\n        \"shops\",\n        \"playgrounds\",\n        \"hailhydrant\",\n        \"toilets\",\n        \"aed\",\n        \"bookcases\",\n    ]\n    /**\n     * Upon initialization, the GPS will search the location.\n     * If the location is found within the given timout, it'll automatically fly to it.\n     *\n     * In seconds\n     */\n    static zoomToLocationTimeout = 15\n    public static readonly viewportCenterCloseToGpsCutoff: number = 20\n    private static readonly config = (() => {\n        const defaultConfig = packagefile.config\n        return { ...defaultConfig, ...extraconfig }\n    })()\n    public static ImgurApiKey = Constants.config.api_keys.imgur\n    public static readonly mapillary_client_token_v4 = Constants.config.api_keys.mapillary_v4\n    public static defaultOverpassUrls = Constants.config.default_overpass_urls\n    public static countryCoderEndpoint: string = Constants.config.country_coder_host\n    public static osmAuthConfig: AuthConfig = Constants.config.oauth_credentials\n    public static nominatimEndpoint: string = Constants.config.nominatimEndpoint\n    public static linkedDataProxy: string = Constants.config[\"jsonld-proxy\"]\n    /**\n     * These are the values that are allowed to use as 'backdrop' icon for a map pin\n     */\n    private static readonly _defaultPinIcons = [\n        \"pin\",\n        \"bug\",\n        \"square\",\n        \"square_rounded\",\n        \"circle\",\n        \"checkmark\",\n        \"clock\",\n        \"close\",\n        \"crosshair\",\n        \"help\",\n        \"home\",\n        \"invalid\",\n        \"location\",\n        \"location_empty\",\n        \"location_locked\",\n        \"note\",\n        \"resolved\",\n        \"ring\",\n        \"scissors\",\n        \"teardrop\",\n        \"teardrop_with_hole_green\",\n        \"triangle\",\n        \"brick_wall_square\",\n        \"brick_wall_round\",\n        \"gps_arrow\",\n        \"checkmark\",\n        \"help\",\n        \"close\",\n        \"invalid\",\n        \"heart\",\n        \"heart_outline\",\n        \"link\",\n        \"confirm\",\n        \"direction\",\n        \"not_found\",\n        \"mastodon\",\n        \"party\",\n        \"addSmall\",\n    ] as const\n    public static readonly defaultPinIcons: string[] = <any>Constants._defaultPinIcons\n    /**\n     * The location that the MVT-layer is hosted.\n     * This is a MapLibre/MapBox vector tile server which hosts vector tiles for every (official) layer\n     */\n    public static VectorTileServer: string | undefined = Constants.config.mvt_layer_server\n    public static GeoIpServer: string | undefined = Constants.config.geoip_server\n    public static ErrorReportServer: string | undefined = Constants.config.error_server\n\n    public static readonly maptilerApiKey = \"GvoVAJgu46I5rZapJuAy\"\n    public static readonly SummaryServer: string = Constants.config.summary_server\n\n    public static allServers: string[] = [\n        Constants.SummaryServer,\n        Constants.VectorTileServer,\n        Constants.GeoIpServer,\n        Constants.ErrorReportServer,\n        Constants.countryCoderEndpoint,\n        Constants.osmAuthConfig.url,\n        Constants.nominatimEndpoint,\n        Constants.linkedDataProxy,\n        ...Constants.defaultOverpassUrls,\n    ]\n\n    private static isRetina(): boolean {\n        if (Utils.runningFromConsole) {\n            return false\n        }\n        // The cause for this line of code: https://github.com/pietervdvn/MapComplete/issues/115\n        // See https://stackoverflow.com/questions/19689715/what-is-the-best-way-to-detect-retina-support-on-a-device-using-javascript\n        return (\n            (window.matchMedia &&\n                (window.matchMedia(\n                    \"only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx), only screen and (min-resolution: 75.6dpcm)\"\n                ).matches ||\n                    window.matchMedia(\n                        \"only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (-o-min-device-pixel-ratio: 2/1), only screen and (min--moz-device-pixel-ratio: 2), only screen and (min-device-pixel-ratio: 2)\"\n                    ).matches)) ||\n            (window.devicePixelRatio && window.devicePixelRatio >= 2)\n        )\n    }\n}\n","import { UIEventSource } from \"../UIEventSource\"\n\n/**\n * UIEventsource-wrapper around localStorage\n */\nexport class LocalStorageSource {\n    static GetParsed<T>(key: string, defaultValue: T): UIEventSource<T> {\n        return LocalStorageSource.Get(key).sync(\n            (str) => {\n                if (str === undefined) {\n                    return defaultValue\n                }\n                try {\n                    return JSON.parse(str)\n                } catch {\n                    return defaultValue\n                }\n            },\n            [],\n            (value) => JSON.stringify(value)\n        )\n    }\n\n    static Get(key: string, defaultValue: string = undefined): UIEventSource<string> {\n        try {\n            let saved = localStorage.getItem(key)\n            if (saved === \"undefined\") {\n                saved = undefined\n            }\n            const source = new UIEventSource<string>(saved ?? defaultValue, \"localstorage:\" + key)\n\n            source.addCallback((data) => {\n                try {\n                    localStorage.setItem(key, data)\n                } catch (e) {\n                    // Probably exceeded the quota with this item!\n                    // Lets nuke everything\n                    localStorage.clear()\n                }\n            })\n            return source\n        } catch (e) {\n            return new UIEventSource<string>(defaultValue)\n        }\n    }\n}\n","\n/**\n * osmAuth\n * Easy authentication with OpenStreetMap over OAuth 2.0.\n * @module\n *\n * @param    o   `Object` containing options:\n * @param    o.scope          OAuth2 scopes requested (e.g. \"read_prefs write_api\")\n * @param    o.client_id      OAuth2 client ID\n * @param    o.redirect_uri   OAuth2 redirect URI (e.g. \"http://127.0.0.1:8080/land.html\")\n * @param    o.access_token   Can pre-authorize with an OAuth2 bearer token if you have one\n * @param    o.apiUrl         A base url for the OSM API (default: \"https://api.openstreetmap.org\")\n * @param    o.url            A base url for the OAuth2 handshake (default: \"https://www.openstreetmap.org\")\n * @param    o.auto           If `true`, attempt to authenticate automatically when calling `.xhr()` or `.fetch()` (default: `false`)\n * @param    o.singlepage     If `true`, use page redirection instead of a popup (default: `false`)\n * @param    o.loading        Function called when auth-related xhr calls start\n * @param    o.done           Function called when auth-related xhr calls end\n * @param    o.locale         The locale to use on the OAuth2 authentication page. Optional.\n * @return  `self`\n */\nexport function osmAuth(o) {\n  var oauth = {};\n\n  // Mock localStorage if needed.\n  // Note that accessing localStorage may throw a `SecurityError`, so wrap in a try/catch.\n  var _store = null;\n  try {\n    _store = window.localStorage;\n  } catch (e) {\n    var _mock = new Map();\n    _store = {\n      isMocked: true,\n      hasItem: (k) => _mock.has(k),\n      getItem: (k) => _mock.get(k),\n      setItem: (k, v) => _mock.set(k, v),\n      removeItem: (k) => _mock.delete(k),\n      clear: () => _mock.clear()\n    };\n  }\n\n  /**\n   * token\n   * Get/Set tokens. These are prefixed with the base URL so that `osm-auth`\n   * can be used with multiple APIs and the keys in `localStorage` will not clash\n   * @param  {string}   k  key\n   * @param  {string?}  v  value\n   * @return {string?}  If getting, returns the stored value or `null`.  If setting, returns `undefined`.\n   */\n  function token(k, v) {\n    var key = o.url + k;\n    if (arguments.length === 1) {\n      var val = _store.getItem(key) || '';\n      // Note: legacy tokens might be wrapped in double quotes - remove them, see #129\n      return val.replace(/\"/g, '');\n\n    } else if (arguments.length === 2) {\n      if (v) {\n        return _store.setItem(key, v);\n      } else {\n        return _store.removeItem(key);\n      }\n    }\n  }\n\n\n  /**\n   * authenticated\n   * Test whether the user is currently authenticated\n   *\n   * @return {boolean} `true` if authenticated, `false` if not\n   */\n  oauth.authenticated = function() {\n    return !!token('oauth2_access_token');\n  };\n\n\n  /**\n   * logout\n   * Removes any stored authentication tokens (legacy OAuth1 tokens too)\n   *\n   * @return  `self`\n   */\n  oauth.logout = function () {\n    token('oauth2_access_token', '');         // OAuth2\n    token('oauth_token', '');                 // OAuth1\n    token('oauth_token_secret', '');          // OAuth1\n    token('oauth_request_token_secret', '');  // OAuth1\n    return oauth;\n  };\n\n\n  /**\n   * authenticate\n   * First logs out, then runs the authentiation flow, finally calls the callback.\n   * TODO: detect lack of click event  (probably can settimeout it)\n   *\n   * @param   {function}  callback  Errback-style callback `(err, result)`, called when complete\n   * @return  none\n   */\n  oauth.authenticate = function(callback) {\n    if (oauth.authenticated()) {\n      callback(null, oauth);\n      return;\n    }\n\n    oauth.logout();\n\n    _preopenPopup(function(error, popup) {\n      if (error) {\n        callback(error);\n      } else {\n        _generatePkceChallenge(function(pkce) {\n          _authenticate(pkce, popup, callback);\n        });\n      }\n    });\n  };\n\n\n  /**\n   * authenticateAsync\n   * Promisified version of `authenticate`\n   * @return  {Promise}  Promise settled with whatever `_authenticate` did\n   */\n  oauth.authenticateAsync = function() {\n    if (oauth.authenticated()) {\n      return Promise.resolve(oauth);\n    }\n\n    oauth.logout();\n\n    return new Promise((resolve, reject) => {\n      var errback = (err, result) => {\n        if (err) {\n          reject(err);\n        } else {\n          resolve(result);\n        }\n      };\n\n      _preopenPopup((error, popup) => {\n        if (error) {\n          errback(error);\n        } else {\n          _generatePkceChallenge(pkce => _authenticate(pkce, popup, errback));\n        }\n      });\n    });\n  };\n\n\n  /**\n   * opens an empty popup to be later used for the authentication page\n   * @param   {function}  callback  Errback-style callback `(err, result)`, called when complete\n   * @return  none\n   */\n  function _preopenPopup(callback) {\n    if (o.singlepage) {\n      callback(null, undefined);\n      return;\n    }\n\n    // Create a 550x610 popup window in the center of the screen\n    var w = 550;\n    var h = 610;\n    var settings = [\n        ['width', w],\n        ['height', h],\n        ['left', window.screen.width / 2 - w / 2],\n        ['top', window.screen.height / 2 - h / 2],\n      ]\n      .map(function (x) { return x.join('='); })\n      .join(',');\n    var popup = window.open('about:blank', 'oauth_window', settings);\n    if (popup) {\n      callback(null, popup);\n    } else {\n      var error = new Error('Popup was blocked');\n      error.status = 'popup-blocked';\n      callback(error);\n    }\n  }\n\n\n  /**\n   * _authenticate\n   * internal authenticate\n   *\n   * @param  {Object}    pkce      Object containing PKCE code challenge properties\n   * @param  {Window}    popup     Popup Window to use for the authentication page, should be undefined when using singlepage mode\n   * @param  {function}  callback  Errback-style callback that accepts `(err, result)`\n   */\n  function _authenticate(pkce, popup, callback) {\n    var state = generateState();\n\n    // ## Request authorization to access resources from the user\n    // and receive authorization code\n    var url =\n      o.url +\n      '/oauth2/authorize?' +\n      utilQsString({\n        client_id: o.client_id,\n        redirect_uri: o.redirect_uri,\n        response_type: 'code',\n        scope: o.scope,\n        state: state,\n        code_challenge: pkce.code_challenge,\n        code_challenge_method: pkce.code_challenge_method,\n        locale: o.locale || '',\n      });\n\n    if (o.singlepage) {\n      if (_store.isMocked) {\n        // in singlepage mode, PKCE requires working non-volatile storage\n        var error = new Error('localStorage unavailable, but required in singlepage mode');\n        error.status = 'pkce-localstorage-unavailable';\n        callback(error);\n        return;\n      }\n      var params = utilStringQs(window.location.search.slice(1));\n      if (params.code) {\n        oauth.bootstrapToken(params.code, callback);\n      } else {\n        // save OAuth2 state and PKCE challenge in local storage, for later use\n        // in the `/oauth/token` request\n        token('oauth2_state', state);\n        token('oauth2_pkce_code_verifier', pkce.code_verifier);\n        window.location = url;\n      }\n    } else {\n      oauth.popupWindow = popup;\n      popup.location = url;\n    }\n\n    // Called by a function in the redirect URL page, in the popup window. The\n    // window closes itself.\n    window.authComplete = function (url) {\n      var params = utilStringQs(url.split('?')[1]);\n      if (params.state !== state) {\n        var error = new Error('Invalid state');\n        error.status = 'invalid-state';\n        callback(error);\n        return;\n      }\n      _getAccessToken(params.code, pkce.code_verifier, accessTokenDone);\n      delete window.authComplete;\n    };\n\n    function accessTokenDone(err, xhr) {\n      o.done();\n      if (err) {\n        callback(err);\n        return;\n      }\n      var access_token = JSON.parse(xhr.response);\n      token('oauth2_access_token', access_token.access_token);\n      callback(null, oauth);\n    }\n  }\n\n\n  /**\n   * _getAccessToken\n   * The client requests an access token by authenticating with the\n   * authorization server and presenting the `auth_code`, brought\n   * in from a function call on a landing page popup.\n   * @param  {string}    auth_code\n   * @param  {string}    code_verifier\n   * @param  {function}  accessTokenDone  Errback-style callback `(err, result)`, called when complete\n   */\n  function _getAccessToken(auth_code, code_verifier, accessTokenDone) {\n    var url =\n      o.url +\n      '/oauth2/token?' +\n      utilQsString({\n        client_id: o.client_id,\n        redirect_uri: o.redirect_uri,\n        grant_type: 'authorization_code',\n        code: auth_code,\n        code_verifier: code_verifier\n      });\n\n    // The authorization server authenticates the client and validates\n    // the authorization grant, and if valid, issues an access token.\n    oauth.rawxhr('POST', url, null, null, null, accessTokenDone);\n    o.loading();\n  }\n\n\n  /**\n   * bringPopupWindowToFront\n   * Tries to bring an existing authentication popup to the front.\n   *\n   * @return {boolean} `true` if it succeeded, `false` if not\n   */\n  oauth.bringPopupWindowToFront = function() {\n    var broughtPopupToFront = false;\n    try {\n      // This may cause a cross-origin error:\n      // `DOMException: Blocked a frame with origin \"...\" from accessing a cross-origin frame.`\n      if (oauth.popupWindow && !oauth.popupWindow.closed) {\n        oauth.popupWindow.focus();\n        broughtPopupToFront = true;\n      }\n    } catch (err) {\n      // Bringing popup window to front failed (probably because of the cross-origin error mentioned above)\n    }\n    return broughtPopupToFront;\n  };\n\n\n  /**\n   * bootstrapToken\n   * The authorization code is a temporary code that a client can exchange for an access token.\n   * If using this library in single-page mode, you'll need to call this once your application\n   * has an `auth_code` and wants to get an access_token.\n   *\n   * @param   {string}   auth_code  The OAuth2 `auth_code`\n   * @param   {function} callback   Errback-style callback `(err, result)`, called when complete\n   * @return  none\n   */\n  oauth.bootstrapToken = function(auth_code, callback) {\n    var state = token('oauth2_state');\n    token('oauth2_state', '');\n    var params = utilStringQs(window.location.search.slice(1));\n    if (params.state !== state) {\n      var error = new Error('Invalid state');\n      error.status = 'invalid-state';\n      callback(error);\n      return;\n    }\n    var code_verifier = token('oauth2_pkce_code_verifier');\n    token('oauth2_pkce_code_verifier', '');\n    _getAccessToken(auth_code, code_verifier, accessTokenDone);\n\n    function accessTokenDone(err, xhr) {\n      o.done();\n      if (err) {\n        callback(err);\n        return;\n      }\n      var access_token = JSON.parse(xhr.response);\n      token('oauth2_access_token', access_token.access_token);\n      callback(null, oauth);\n    }\n  };\n\n\n  /**\n   * fetch\n   * A `fetch` wrapper that includes the Authorization header if the user is authenticated.\n   * https://developer.mozilla.org/en-US/docs/Web/API/fetch\n   *\n   * @param  {string}   resource    Resource passed to `fetch`\n   * @param  {Object}   options     Options passed to `fetch`\n   * @return {Promise}  Promise that wraps `authenticateAsync` then `fetch`\n   */\n  oauth.fetch = function(resource, options) {\n    if (oauth.authenticated()) {\n      return _doFetch();\n    } else {\n      if (o.auto) {\n        return oauth.authenticateAsync().then(_doFetch);\n      } else {\n        return Promise.reject(new Error('not authenticated'));\n      }\n    }\n\n    function _doFetch() {\n      options = options || {};\n      if (!options.headers) {\n        options.headers = { 'Content-Type': 'application/x-www-form-urlencoded' };\n      }\n      options.headers.Authorization = 'Bearer ' + token('oauth2_access_token');\n      return fetch(resource, options);\n    }\n  };\n\n\n  /**\n   * xhr\n   * A `XMLHttpRequest` wrapper that does authenticated calls if the user has logged in.\n   * https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n   *\n   * @param   {Object} options\n   * @param    options.method   Passed to `xhr.open`  (e.g. 'GET', 'POST')\n   * @param    options.prefix   If `true` path contains a path, if `false` path contains the full url\n   * @param    options.path     The URL path (e.g. \"/api/0.6/user/details\") (or full url, if `prefix`=`false`)\n   * @param    options.content  Passed to `xhr.send`\n   * @param    options.headers  `Object` containing request headers\n   * @param   {function}         callback  Errback-style callback `(err, result)`, called when complete\n   * @return  {XMLHttpRequest}  `XMLHttpRequest` if authenticated, otherwise `null`\n   */\n  oauth.xhr = function (options, callback) {\n    if (oauth.authenticated()) {\n      return _doXHR();\n    } else {\n      if (o.auto) {\n        oauth.authenticate(_doXHR);\n        return;\n      } else {\n        callback('not authenticated', null);\n        return;\n      }\n    }\n\n    function _doXHR() {\n      var url = options.prefix !== false ? (o.apiUrl + options.path) : options.path;\n      return oauth.rawxhr(\n        options.method,\n        url,\n        token('oauth2_access_token'),\n        options.content,\n        options.headers,\n        done\n      );\n    }\n\n    function done(err, xhr) {\n      if (err) {\n        callback(err);\n      } else if (xhr.responseXML) {\n        callback(err, xhr.responseXML);\n      } else {\n        callback(err, xhr.response);\n      }\n    }\n  };\n\n\n  /**\n   * rawxhr\n   * Creates the XMLHttpRequest set up with a header and response handling\n   * https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\n   *\n   * @param    method         Passed to `xhr.open`  (e.g. 'GET', 'POST')\n   * @param    url            Passed to `xhr.open`\n   * @param    access_token   OAuth2 bearer token\n   * @param    data           Passed to `xhr.send`\n   * @param    headers        `Object` containing request headers\n   * @param    callback       An \"errback\"-style callback (`err`, `result`), called when complete\n   * @return  `XMLHttpRequest`\n   */\n  oauth.rawxhr = function(method, url, access_token, data, headers, callback) {\n    headers = headers || { 'Content-Type': 'application/x-www-form-urlencoded' };\n\n    if (access_token) {\n      headers.Authorization = 'Bearer ' + access_token;\n    }\n\n    var xhr = new XMLHttpRequest();\n\n    xhr.onreadystatechange = function () {\n      if (4 === xhr.readyState && 0 !== xhr.status) {\n        if (/^20\\d$/.test(xhr.status)) {   // a 20x status code - OK\n          callback(null, xhr);\n        } else {\n          callback(xhr, null);\n        }\n      }\n    };\n    xhr.onerror = function (e) {\n      callback(e, null);\n    };\n\n    xhr.open(method, url, true);\n    for (var h in headers) xhr.setRequestHeader(h, headers[h]);\n\n    xhr.send(data);\n    return xhr;\n  };\n\n\n  /**\n   * preauth\n   * Pre-authorize this object, if we already have access token from the start\n   *\n   * @param   {Object}  val  Object containing `access_token` property\n   * @return  `self`\n   */\n  oauth.preauth = function(val) {\n    if (val && val.access_token) {\n      token('oauth2_access_token', val.access_token);\n    }\n    return oauth;\n  };\n\n\n  /**\n   * options  (getter / setter)\n   * If passed with no arguments, just return the options\n   * If passed an Object, set the options then attempt to pre-authorize\n   *\n   * @param   val?   Object containing options\n   * @return  current `options` (if getting), or `self` (if setting)\n   */\n  oauth.options = function(val) {\n    if (!arguments.length) return o;\n\n    o = val;\n    o.apiUrl = o.apiUrl || 'https://api.openstreetmap.org';\n    o.url = o.url || 'https://www.openstreetmap.org';\n    o.auto = o.auto || false;\n    o.singlepage = o.singlepage || false;\n\n    // Optional loading and loading-done functions for nice UI feedback.\n    // by default, no-ops\n    o.loading = o.loading || function () {};\n    o.done = o.done || function () {};\n    return oauth.preauth(o);\n  };\n\n\n  // Everything below here is initialization/setup code\n  // Handle options and attempt to pre-authorize\n  oauth.options(o);\n\n  return oauth;\n}\n\n\n/**\n * utilQsString\n * Transforms object of `key=value` pairs into query string\n * @param   {Object}  Object of `key=value` pairs\n * @returns {string}  query string\n */\nfunction utilQsString(obj) {\n  return Object.keys(obj)\n    .filter(function(key) {\n      return obj[key] !== undefined;\n    })\n    .sort()\n    .map(function(key) {\n      return (encodeURIComponent(key) + '=' + encodeURIComponent(obj[key]));\n    })\n    .join('&');\n}\n\n/**\n * utilStringQs\n * Transforms query string into object of `key=value` pairs\n * @param   {string}  query string\n * @returns {Object}  Object of `key=value` pairs\n */\nfunction utilStringQs(str) {\n  var i = 0; // advance past any leading '?' or '#' characters\n  while (i < str.length && (str[i] === '?' || str[i] === '#')) i++;\n  str = str.slice(i);\n\n  return str.split('&').reduce(function(obj, pair) {\n    var parts = pair.split('=');\n    if (parts.length === 2) {\n      obj[parts[0]] = decodeURIComponent(parts[1]);\n    }\n    return obj;\n  }, {});\n}\n\n\n/**\n * supportsWebCryptoAPI\n * https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API\n * @returns {boolean}  `true` if WebCryptoAPI is available\n */\nfunction supportsWebCryptoAPI() {\n  return window && window.crypto\n    && window.crypto.getRandomValues\n    && window.crypto.subtle\n    && window.crypto.subtle.digest;\n}\n\n\n/**\n * Generates a challenge/verifier pair for PKCE.\n * If the browser does not support the WebCryptoAPI, the \"plain\" method is\n * used as a fallback instead of a SHA-256 hash.\n * @param {callback} callback called with the result of the generated PKCE challenge\n */\nfunction _generatePkceChallenge(callback) {\n  var code_verifier;\n  if (supportsWebCryptoAPI()) {\n    // generate a random code_verifier\n    // https://datatracker.ietf.org/doc/html/rfc7636#section-7.1\n    var random = window.crypto.getRandomValues(new Uint8Array(32));\n    code_verifier = base64(random.buffer);\n    var verifier = Uint8Array.from(Array.from(code_verifier).map(function(char) {\n      return char.charCodeAt(0);\n    }));\n\n    // generate challenge for code verifier\n    window.crypto.subtle.digest('SHA-256', verifier).then(function(hash) {\n      var code_challenge = base64(hash);\n\n      callback({\n        code_challenge: code_challenge,\n        code_verifier: code_verifier,\n        code_challenge_method: 'S256'\n      });\n    });\n  } else {\n    // browser does not support Web Crypto API (e.g. IE11) -> fall back to \"plain\" method\n    var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_';\n    code_verifier = '';\n    for (var i=0; i<64; i++) {\n      code_verifier += chars[Math.floor(Math.random() * chars.length)];\n    }\n    callback({\n      code_verifier: code_verifier,\n      code_challenge: code_verifier,\n      code_challenge_method: 'plain',\n    });\n  }\n}\n\n\n/**\n * Returns a random state to be used as the \"state\" of the OAuth2 authentication\n * See https://datatracker.ietf.org/doc/html/rfc6749#section-10.12\n */\nfunction generateState() {\n  var state;\n  if (supportsWebCryptoAPI()) {\n    var random = window.crypto.getRandomValues(new Uint8Array(32));\n    state = base64(random.buffer);\n  } else {\n    // browser does not support Web Crypto API (e.g. IE11) -> fall back to \"plain\" method\n    var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_';\n    state = '';\n    for (var i=0; i<64; i++) {\n      state += chars[Math.floor(Math.random() * chars.length)];\n    }\n  }\n  return state;\n}\n\n\n/**\n * base64\n * Converts binary buffer to base64 encoded string, as used in rfc7636\n * @param    {ArrayBuffer}  buffer\n * @returns  {string}       base64 encoded\n */\nfunction base64(buffer) {\n  return btoa(String.fromCharCode.apply(null, new Uint8Array(buffer)))\n    .replace(/\\//g, '_')\n    .replace(/\\+/g, '-')\n    .replace(/[=]/g, '');\n}\n","import { UIEventSource } from \"../UIEventSource\"\nimport UserDetails, { OsmConnection } from \"./OsmConnection\"\nimport { Utils } from \"../../Utils\"\nimport { LocalStorageSource } from \"../Web/LocalStorageSource\"\n// @ts-ignore\nimport { osmAuth } from \"osm-auth\"\nimport OSMAuthInstance = OSMAuth.OSMAuthInstance\n\nexport class OsmPreferences {\n    /**\n     * A dictionary containing all the preferences. The 'preferenceSources' will be initialized from this\n     * We keep a local copy of them, to init mapcomplete with the previous choices and to be able to get the open changesets right away\n     */\n    public preferences = LocalStorageSource.GetParsed<Record<string, string>>(\n        \"all-osm-preferences\",\n        {}\n    )\n    /**\n     * A map containing the individual preference sources\n     * @private\n     */\n    private readonly preferenceSources = new Map<string, UIEventSource<string>>()\n    private readonly auth: OSMAuthInstance\n    private userDetails: UIEventSource<UserDetails>\n    private longPreferences = {}\n    private readonly _fakeUser: boolean\n\n    constructor(auth: OSMAuthInstance, osmConnection: OsmConnection, fakeUser: boolean = false) {\n        this.auth = auth\n        this._fakeUser = fakeUser\n        this.userDetails = osmConnection.userDetails\n        osmConnection.OnLoggedIn(() => {\n            this.UpdatePreferences(true)\n            return true\n        })\n    }\n\n    /**\n     * OSM preferences can be at most 255 chars\n     * @param key\n     * @param prefix\n     * @constructor\n     */\n    public GetLongPreference(key: string, prefix: string = \"mapcomplete-\"): UIEventSource<string> {\n        if (this.longPreferences[prefix + key] !== undefined) {\n            return this.longPreferences[prefix + key]\n        }\n\n        const source = new UIEventSource<string>(undefined, \"long-osm-preference:\" + prefix + key)\n        this.longPreferences[prefix + key] = source\n\n        const allStartWith = prefix + key + \"-combined\"\n        const subOptions = { prefix: \"\" }\n        // Gives the number of combined preferences\n        const length = this.GetPreference(allStartWith + \"-length\", \"\", subOptions)\n\n        if ((allStartWith + \"-length\").length > 255) {\n            throw (\n                \"This preference key is too long, it has \" +\n                key.length +\n                \" characters, but at most \" +\n                (255 - \"-length\".length - \"-combined\".length - prefix.length) +\n                \" characters are allowed\"\n            )\n        }\n\n        const self = this\n        source.addCallback((str) => {\n            if (str === undefined || str === \"\") {\n                return\n            }\n            if (str === null) {\n                console.error(\"Deleting \" + allStartWith)\n                let count = parseInt(length.data)\n                for (let i = 0; i < count; i++) {\n                    // Delete all the preferences\n                    self.GetPreference(allStartWith + \"-\" + i, \"\", subOptions).setData(\"\")\n                }\n                self.GetPreference(allStartWith + \"-length\", \"\", subOptions).setData(\"\")\n                return\n            }\n\n            let i = 0\n            while (str !== \"\") {\n                if (str === undefined || str === \"undefined\") {\n                    source.setData(undefined)\n                    throw (\n                        \"Got 'undefined' or a literal string containing 'undefined' for a long preference with name \" +\n                        key\n                    )\n                }\n                if (str === \"undefined\") {\n                    source.setData(undefined)\n                    throw (\n                        \"Got a literal string containing 'undefined' for a long preference with name \" +\n                        key\n                    )\n                }\n                if (i > 100) {\n                    throw \"This long preference is getting very long... \"\n                }\n                self.GetPreference(allStartWith + \"-\" + i, \"\", subOptions).setData(\n                    str.substr(0, 255)\n                )\n                str = str.substr(255)\n                i++\n            }\n            length.setData(\"\" + i) // We use I, the number of preference fields used\n        })\n\n        function updateData(l: number) {\n            if (Object.keys(self.preferences.data).length === 0) {\n                // The preferences are still empty - they are not yet updated, so we delay updating for now\n                return\n            }\n            const prefsCount = Number(l)\n            if (prefsCount > 100) {\n                throw \"Length to long\"\n            }\n            let str = \"\"\n            for (let i = 0; i < prefsCount; i++) {\n                const key = allStartWith + \"-\" + i\n                if (self.preferences.data[key] === undefined) {\n                    console.warn(\n                        \"Detected a broken combined preference:\",\n                        key,\n                        \"is undefined\",\n                        self.preferences\n                    )\n                }\n                str += self.preferences.data[key] ?? \"\"\n            }\n\n            source.setData(str)\n        }\n\n        length.addCallback((l) => {\n            updateData(Number(l))\n        })\n        this.preferences.addCallbackAndRun((_) => {\n            updateData(Number(length.data))\n        })\n\n        return source\n    }\n\n    public GetPreference(\n        key: string,\n        defaultValue: string = undefined,\n        options?: {\n            documentation?: string\n            prefix?: string\n        }\n    ): UIEventSource<string> {\n        const prefix: string = options?.prefix ?? \"mapcomplete-\"\n        if (key.startsWith(prefix) && prefix !== \"\") {\n            console.trace(\n                \"A preference was requested which has a duplicate prefix in its key. This is probably a bug\"\n            )\n        }\n        key = prefix + key\n        key = key.replace(/[:\\\\\\/\"' {}.%]/g, \"\")\n        if (key.length >= 255) {\n            throw \"Preferences: key length to big\"\n        }\n        const cached = this.preferenceSources.get(key)\n        if (cached !== undefined) {\n            return cached\n        }\n        if (this.userDetails.data.loggedIn && this.preferences.data[key] === undefined) {\n            this.UpdatePreferences()\n        }\n\n        const pref = new UIEventSource<string>(\n            this.preferences.data[key] ?? defaultValue,\n            \"osm-preference:\" + key\n        )\n        pref.addCallback((v) => {\n            this.UploadPreference(key, v)\n        })\n\n        this.preferences.addCallbackD((allPrefs) => {\n            const v = allPrefs[key]\n            if (v === undefined) {\n                return\n            }\n            pref.setData(v)\n        })\n\n        this.preferenceSources.set(key, pref)\n        return pref\n    }\n\n    public ClearPreferences() {\n        let isRunning = false\n        const self = this\n        this.preferences.addCallback((prefs) => {\n            console.log(\"Cleaning preferences...\")\n            if (Object.keys(prefs).length == 0) {\n                return\n            }\n            if (isRunning) {\n                return\n            }\n            isRunning = true\n            const prefixes = [\"mapcomplete-\"]\n            for (const key in prefs) {\n                const matches = prefixes.some((prefix) => key.startsWith(prefix))\n                if (matches) {\n                    console.log(\"Clearing \", key)\n                    self.GetPreference(key, \"\", { prefix: \"\" }).setData(\"\")\n                }\n            }\n            isRunning = false\n            return\n        })\n    }\n\n    removeAllWithPrefix(prefix: string) {\n        for (const key in this.preferences.data) {\n            if (key.startsWith(prefix)) {\n                this.GetPreference(key, \"\", { prefix: \"\" }).setData(undefined)\n                console.log(\"Clearing preference\", key)\n            }\n        }\n        this.preferences.ping()\n    }\n\n    private UpdatePreferences(forceUpdate?: boolean) {\n        const self = this\n        if (this._fakeUser) {\n            return\n        }\n        this.auth.xhr(\n            {\n                method: \"GET\",\n                path: \"/api/0.6/user/preferences\",\n            },\n            function (error, value: XMLDocument) {\n                if (error) {\n                    console.log(\"Could not load preferences\", error)\n                    return\n                }\n                const prefs = value.getElementsByTagName(\"preference\")\n                const seenKeys = new Set<string>()\n                for (let i = 0; i < prefs.length; i++) {\n                    const pref = prefs[i]\n                    const k = pref.getAttribute(\"k\")\n                    const v = pref.getAttribute(\"v\")\n                    self.preferences.data[k] = v\n                    seenKeys.add(k)\n                }\n                if (forceUpdate) {\n                    for (let key in self.preferences.data) {\n                        if (seenKeys.has(key)) {\n                            continue\n                        }\n                        console.log(\"Deleting key\", key, \"as we didn't find it upstream\")\n                        delete self.preferences.data[key]\n                    }\n                }\n\n                // We merge all the preferences: new keys are uploaded\n                // For differing values, the server overrides local changes\n                self.preferenceSources.forEach((preference, key) => {\n                    const osmValue = self.preferences.data[key]\n                    if (osmValue === undefined && preference.data !== undefined) {\n                        // OSM doesn't know this value yet\n                        self.UploadPreference(key, preference.data)\n                    } else {\n                        // OSM does have a value - set it\n                        preference.setData(osmValue)\n                    }\n                })\n\n                self.preferences.ping()\n            }\n        )\n    }\n\n    private UploadPreference(k: string, v: string) {\n        if (!this.userDetails.data.loggedIn) {\n            console.debug(`Not saving preference ${k}: user not logged in`)\n            return\n        }\n\n        if (this.preferences.data[k] === v) {\n            return\n        }\n        const self = this\n        console.debug(\"Updating preference\", k, \" to \", Utils.EllipsesAfter(v, 15))\n        if (this._fakeUser) {\n            return\n        }\n        if (v === undefined || v === \"\") {\n            this.auth.xhr(\n                {\n                    method: \"DELETE\",\n                    path: \"/api/0.6/user/preferences/\" + encodeURIComponent(k),\n                    headers: { \"Content-Type\": \"text/plain\" },\n                },\n                function (error) {\n                    if (error) {\n                        console.warn(\"Could not remove preference\", error)\n                        return\n                    }\n                    delete self.preferences.data[k]\n                    self.preferences.ping()\n                    console.debug(\"Preference \", k, \"removed!\")\n                }\n            )\n            return\n        }\n\n        this.auth.xhr(\n            {\n                method: \"PUT\",\n                path: \"/api/0.6/user/preferences/\" + encodeURIComponent(k),\n                headers: { \"Content-Type\": \"text/plain\" },\n                content: v,\n            },\n            function (error) {\n                if (error) {\n                    console.warn(`Could not set preference \"${k}\"'`, error)\n                    return\n                }\n                self.preferences.data[k] = v\n                self.preferences.ping()\n                console.debug(`Preference ${k} written!`)\n            }\n        )\n    }\n}\n","import { osmAuth } from \"osm-auth\"\nimport { Store, Stores, UIEventSource } from \"../UIEventSource\"\nimport { OsmPreferences } from \"./OsmPreferences\"\nimport { Utils } from \"../../Utils\"\nimport { LocalStorageSource } from \"../Web/LocalStorageSource\"\nimport { AuthConfig } from \"./AuthConfig\"\nimport Constants from \"../../Models/Constants\"\n\ninterface OsmUserInfo {\n    id: number\n    display_name: string\n    account_created: string\n    description: string\n    contributor_terms: { agreed: boolean }\n    roles: []\n    changesets: { count: number }\n    traces: { count: number }\n    blocks: { received: { count: number; active: number } }\n}\n\nexport default class UserDetails {\n    public loggedIn = false\n    public name = \"Not logged in\"\n    public uid: number\n    public csCount = 0\n    public img?: string\n    public unreadMessages = 0\n    public totalMessages: number = 0\n    public home: { lon: number; lat: number }\n    public backend: string\n    public account_created: string\n    public tracesCount: number = 0\n    public description: string\n    public languages: string[]\n\n    constructor(backend: string) {\n        this.backend = backend\n    }\n}\n\nexport type OsmServiceState = \"online\" | \"readonly\" | \"offline\" | \"unknown\" | \"unreachable\"\n\nexport class OsmConnection {\n    public auth: osmAuth\n    public userDetails: UIEventSource<UserDetails>\n    public isLoggedIn: Store<boolean>\n    public gpxServiceIsOnline: UIEventSource<OsmServiceState> = new UIEventSource<OsmServiceState>(\n        \"unknown\"\n    )\n    public apiIsOnline: UIEventSource<OsmServiceState> = new UIEventSource<OsmServiceState>(\n        \"unknown\"\n    )\n\n    public loadingStatus = new UIEventSource<\"not-attempted\" | \"loading\" | \"error\" | \"logged-in\">(\n        \"not-attempted\"\n    )\n    public preferencesHandler: OsmPreferences\n    public readonly _oauth_config: AuthConfig\n    private readonly _dryRun: Store<boolean>\n    private readonly fakeUser: boolean\n    private _onLoggedIn: ((userDetails: UserDetails) => void)[] = []\n    private readonly _iframeMode: boolean\n    private readonly _singlePage: boolean\n    private isChecking = false\n    private readonly _doCheckRegularly\n\n    constructor(options?: {\n        dryRun?: Store<boolean>\n        fakeUser?: false | boolean\n        oauth_token?: UIEventSource<string>\n        // Used to keep multiple changesets open and to write to the correct changeset\n        singlePage?: boolean\n        attemptLogin?: true | boolean\n        /**\n         * If true: automatically check if we're still online every 5 minutes + fetch messages\n         */\n        checkOnlineRegularly?: true | boolean\n    }) {\n        options ??= {}\n        this.fakeUser = options?.fakeUser ?? false\n        this._singlePage = options?.singlePage ?? true\n        this._oauth_config = Constants.osmAuthConfig\n        this._doCheckRegularly = options?.checkOnlineRegularly ?? true\n        console.debug(\"Using backend\", this._oauth_config.url)\n        this._iframeMode = Utils.runningFromConsole ? false : window !== window.top\n\n        // Check if there are settings available in environment variables, and if so, use those\n        if (\n            import.meta.env.VITE_OSM_OAUTH_CLIENT_ID !== undefined &&\n            import.meta.env.VITE_OSM_OAUTH_SECRET !== undefined\n        ) {\n            console.debug(\"Using environment variables for oauth config\")\n            this._oauth_config.oauth_client_id = import.meta.env.VITE_OSM_OAUTH_CLIENT_ID\n            this._oauth_config.oauth_secret = import.meta.env.VITE_OSM_OAUTH_SECRET\n        }\n\n        this.userDetails = new UIEventSource<UserDetails>(\n            new UserDetails(this._oauth_config.url),\n            \"userDetails\"\n        )\n        if (options.fakeUser) {\n            const ud = this.userDetails.data\n            ud.csCount = 5678\n            ud.uid = 42\n            ud.loggedIn = true\n            ud.unreadMessages = 0\n            ud.name = \"Fake user\"\n            ud.totalMessages = 42\n            ud.languages = [\"en\"]\n            this.loadingStatus.setData(\"logged-in\")\n        }\n        this.UpdateCapabilities()\n\n        this.isLoggedIn = this.userDetails.map(\n            (user) =>\n                user.loggedIn &&\n                (this.apiIsOnline.data === \"unknown\" || this.apiIsOnline.data === \"online\"),\n            [this.apiIsOnline]\n        )\n        this.isLoggedIn.addCallback((isLoggedIn) => {\n            if (this.userDetails.data.loggedIn == false && isLoggedIn == true) {\n                // We have an inconsistency: the userdetails say we _didn't_ log in, but this actor says we do\n                // This means someone attempted to toggle this; so we attempt to login!\n                this.AttemptLogin()\n            }\n        })\n\n        this._dryRun = options.dryRun ?? new UIEventSource<boolean>(false)\n\n        this.updateAuthObject()\n        if (!this.fakeUser) {\n            this.CheckForMessagesContinuously()\n        }\n\n        this.preferencesHandler = new OsmPreferences(this.auth, this, this.fakeUser)\n\n        if (options.oauth_token?.data !== undefined) {\n            console.log(options.oauth_token.data)\n            this.auth.bootstrapToken(options.oauth_token.data, (err, result) => {\n                console.log(\"Bootstrap token called back\", err, result)\n                this.AttemptLogin()\n            })\n\n            options.oauth_token.setData(undefined)\n        }\n        if (\n            !Utils.runningFromConsole &&\n            this.auth.authenticated() &&\n            options.attemptLogin !== false\n        ) {\n            this.AttemptLogin()\n        } else {\n            console.log(\"Not authenticated\")\n        }\n    }\n\n    public GetPreference<T extends string = string>(\n        key: string,\n        defaultValue: string = undefined,\n        options?: {\n            documentation?: string\n            prefix?: string\n        }\n    ): UIEventSource<T | undefined> {\n        return <UIEventSource<T>>this.preferencesHandler.GetPreference(key, defaultValue, options)\n    }\n\n    public GetLongPreference(key: string, prefix: string = \"mapcomplete-\"): UIEventSource<string> {\n        return this.preferencesHandler.GetLongPreference(key, prefix)\n    }\n\n    public OnLoggedIn(action: (userDetails: UserDetails) => void) {\n        this._onLoggedIn.push(action)\n    }\n\n    public LogOut() {\n        this.auth.logout()\n        this.userDetails.data.loggedIn = false\n        this.userDetails.data.csCount = 0\n        this.userDetails.data.name = \"\"\n        this.userDetails.ping()\n        console.log(\"Logged out\")\n        this.loadingStatus.setData(\"not-attempted\")\n        this.preferencesHandler.preferences.setData(undefined)\n    }\n\n    /**\n     * The backend host, without path or trailing '/'\n     *\n     * new OsmConnection().Backend() // => \"https://www.openstreetmap.org\"\n     */\n    public Backend(): string {\n        return this._oauth_config.url\n    }\n\n    public AttemptLogin() {\n        this.UpdateCapabilities()\n        if (this.loadingStatus.data !== \"logged-in\") {\n            // Stay 'logged-in' if we are already logged in; this simply means we are checking for messages\n            this.loadingStatus.setData(\"loading\")\n        }\n        if (this.fakeUser) {\n            this.loadingStatus.setData(\"logged-in\")\n            console.log(\"AttemptLogin called, but ignored as fakeUser is set\")\n            return\n        }\n\n        console.log(\"Trying to log in...\")\n        this.updateAuthObject()\n\n        LocalStorageSource.Get(\"location_before_login\").setData(\n            Utils.runningFromConsole ? undefined : window.location.href\n        )\n        this.auth.xhr(\n            {\n                method: \"GET\",\n                path: \"/api/0.6/user/details\",\n            },\n            (err, details: XMLDocument) => {\n                if (err != null) {\n                    console.log(\"Could not login due to:\", err)\n                    this.loadingStatus.setData(\"error\")\n                    if (err.status == 401) {\n                        console.log(\"Clearing tokens...\")\n                        // Not authorized - our token probably got revoked\n                        this.auth.logout()\n                        this.LogOut()\n                    } else {\n                        console.log(\"Other error. Status:\", err.status)\n                        this.apiIsOnline.setData(\"unreachable\")\n                    }\n                    return\n                }\n\n                if (details == null) {\n                    this.loadingStatus.setData(\"error\")\n                    return\n                }\n\n                // details is an XML DOM of user details\n                const userInfo = details.getElementsByTagName(\"user\")[0]\n\n                const data = this.userDetails.data\n                data.loggedIn = true\n                console.log(\"Login completed, userinfo is \", userInfo)\n                data.name = userInfo.getAttribute(\"display_name\")\n                data.account_created = userInfo.getAttribute(\"account_created\")\n                data.uid = Number(userInfo.getAttribute(\"id\"))\n                data.languages = Array.from(\n                    userInfo.getElementsByTagName(\"languages\")[0].getElementsByTagName(\"lang\")\n                ).map((l) => l.textContent)\n                data.csCount = Number.parseInt(\n                    userInfo.getElementsByTagName(\"changesets\")[0].getAttribute(\"count\") ?? \"0\"\n                )\n                data.tracesCount = Number.parseInt(\n                    userInfo.getElementsByTagName(\"traces\")[0].getAttribute(\"count\") ?? \"0\"\n                )\n\n                data.img = undefined\n                const imgEl = userInfo.getElementsByTagName(\"img\")\n                if (imgEl !== undefined && imgEl[0] !== undefined) {\n                    data.img = imgEl[0].getAttribute(\"href\")\n                }\n\n                const description = userInfo.getElementsByTagName(\"description\")\n                if (description !== undefined && description[0] !== undefined) {\n                    data.description = description[0]?.innerHTML\n                }\n                const homeEl = userInfo.getElementsByTagName(\"home\")\n                if (homeEl !== undefined && homeEl[0] !== undefined) {\n                    const lat = parseFloat(homeEl[0].getAttribute(\"lat\"))\n                    const lon = parseFloat(homeEl[0].getAttribute(\"lon\"))\n                    data.home = { lat: lat, lon: lon }\n                }\n\n                this.loadingStatus.setData(\"logged-in\")\n                const messages = userInfo\n                    .getElementsByTagName(\"messages\")[0]\n                    .getElementsByTagName(\"received\")[0]\n                data.unreadMessages = parseInt(messages.getAttribute(\"unread\"))\n                data.totalMessages = parseInt(messages.getAttribute(\"count\"))\n\n                this.userDetails.ping()\n                for (const action of this._onLoggedIn) {\n                    action(this.userDetails.data)\n                }\n                this._onLoggedIn = []\n            }\n        )\n    }\n\n    /**\n     * Interact with the API.\n     *\n     * @param path the path to query, without host and without '/api/0.6'. Example 'notes/1234/close'\n     * @param method\n     * @param header\n     * @param content\n     * @param allowAnonymous if set, will use the anonymous-connection if the main connection is not authenticated\n     */\n    public async interact(\n        path: string,\n        method: \"GET\" | \"POST\" | \"PUT\" | \"DELETE\",\n        header?: Record<string, string>,\n        content?: string,\n        allowAnonymous: boolean = false\n    ): Promise<string> {\n        const connection: osmAuth = this.auth\n        if (allowAnonymous && !this.auth.authenticated()) {\n            const possibleResult = await Utils.downloadAdvanced(\n                `${this.Backend()}/api/0.6/${path}`,\n                header,\n                method,\n                content\n            )\n            if (possibleResult[\"content\"]) {\n                return possibleResult[\"content\"]\n            }\n            console.error(possibleResult)\n            throw \"Could not interact with OSM:\" + possibleResult[\"error\"]\n        }\n\n        return new Promise((ok, error) => {\n            connection.xhr(\n                {\n                    method,\n                    headers: header,\n                    content,\n                    path: `/api/0.6/${path}`,\n                },\n                function (err, response) {\n                    if (err !== null) {\n                        error(err)\n                    } else {\n                        ok(response)\n                    }\n                }\n            )\n        })\n    }\n\n    public async post<T extends string>(\n        path: string,\n        content?: string,\n        header?: Record<string, string>,\n        allowAnonymous: boolean = false\n    ): Promise<T> {\n        return <T>await this.interact(path, \"POST\", header, content, allowAnonymous)\n    }\n\n    public async put<T extends string>(\n        path: string,\n        content?: string,\n        header?: Record<string, string>\n    ): Promise<T> {\n        return <T>await this.interact(path, \"PUT\", header, content)\n    }\n\n    public async get(\n        path: string,\n        header?: Record<string, string>,\n        allowAnonymous: boolean = false\n    ): Promise<string> {\n        return await this.interact(path, \"GET\", header, undefined, allowAnonymous)\n    }\n\n    public closeNote(id: number | string, text?: string): Promise<string> {\n        let textSuffix = \"\"\n        if ((text ?? \"\") !== \"\") {\n            textSuffix = \"?text=\" + encodeURIComponent(text)\n        }\n        if (this._dryRun.data) {\n            console.warn(\"Dryrun enabled - not actually closing note \", id, \" with text \", text)\n            return new Promise((ok) => {\n                ok(\"\")\n            })\n        }\n        return this.post(`notes/${id}/close${textSuffix}`)\n    }\n\n    public reopenNote(id: number | string, text?: string): Promise<string> {\n        if (this._dryRun.data) {\n            console.warn(\"Dryrun enabled - not actually reopening note \", id, \" with text \", text)\n            return new Promise((resolve) => {\n                resolve(\"\")\n            })\n        }\n        let textSuffix = \"\"\n        if ((text ?? \"\") !== \"\") {\n            textSuffix = \"?text=\" + encodeURIComponent(text)\n        }\n        return this.post(`notes/${id}/reopen${textSuffix}`)\n    }\n\n    public async openNote(lat: number, lon: number, text: string): Promise<{ id: number }> {\n        if (this._dryRun.data) {\n            console.warn(\"Dryrun enabled - not actually opening note with text \", text)\n            return new Promise<{ id: number }>((ok) => {\n                window.setTimeout(\n                    () => ok({ id: Math.floor(Math.random() * 1000) }),\n                    Math.random() * 5000\n                )\n            })\n        }\n        // Lat and lon must be strings for the API to accept it\n        const content = `lat=${lat}&lon=${lon}&text=${encodeURIComponent(text)}`\n        const response = await this.post(\n            \"notes.json\",\n            content,\n            {\n                \"Content-Type\": \"application/x-www-form-urlencoded; charset=UTF-8\",\n            },\n            true\n        )\n        const parsed = JSON.parse(response)\n        console.log(\"Got result:\", parsed)\n        const id = parsed.properties\n        console.log(\"OPENED NOTE\", id)\n        return id\n    }\n\n    public static GpxTrackVisibility = [\"private\", \"public\", \"trackable\", \"identifiable\"] as const\n\n    public async uploadGpxTrack(\n        gpx: string,\n        options: {\n            description: string\n            visibility: (typeof OsmConnection.GpxTrackVisibility)[number]\n            filename?: string\n            /**\n             * Some words to give some properties;\n             *\n             * Note: these are called 'tags' on the wiki, but I opted to name them 'labels' instead as they aren't \"key=value\" tags, but just words.\n             */\n            labels: string[]\n        }\n    ): Promise<{ id: number }> {\n        if (this._dryRun.data) {\n            console.warn(\"Dryrun enabled - not actually uploading GPX \", gpx)\n            return new Promise<{ id: number }>((ok) => {\n                window.setTimeout(\n                    () => ok({ id: Math.floor(Math.random() * 1000) }),\n                    Math.random() * 5000\n                )\n            })\n        }\n\n        const contents = {\n            file: gpx,\n            description: options.description,\n            tags: options.labels?.join(\",\") ?? \"\",\n            visibility: options.visibility,\n        }\n\n        if (!contents.description) {\n            throw \"The description of a GPS-trace cannot be the empty string, undefined or null\"\n        }\n        const extras = {\n            file:\n                '; filename=\"' +\n                (options.filename ?? \"gpx_track_mapcomplete_\" + new Date().toISOString()) +\n                '\"\\r\\nContent-Type: application/gpx+xml',\n        }\n\n        const boundary = \"987654\"\n\n        let body = \"\"\n        for (const key in contents) {\n            body += \"--\" + boundary + \"\\r\\n\"\n            body += 'Content-Disposition: form-data; name=\"' + key + '\"'\n            if (extras[key] !== undefined) {\n                body += extras[key]\n            }\n            body += \"\\r\\n\\r\\n\"\n            body += contents[key] + \"\\r\\n\"\n        }\n        body += \"--\" + boundary + \"--\\r\\n\"\n\n        const response = await this.post(\"gpx/create\", body, {\n            \"Content-Type\": \"multipart/form-data; boundary=\" + boundary,\n            \"Content-Length\": \"\" + body.length,\n        })\n        const parsed = JSON.parse(response)\n        console.log(\"Uploaded GPX track\", parsed)\n        return { id: parsed }\n    }\n\n    public addCommentToNote(id: number | string, text: string): Promise<void> {\n        if (this._dryRun.data) {\n            console.warn(\"Dryrun enabled - not actually adding comment \", text, \"to  note \", id)\n            return Utils.waitFor(1000)\n        }\n        if ((text ?? \"\") === \"\") {\n            throw \"Invalid text!\"\n        }\n\n        return new Promise((ok, error) => {\n            this.auth.xhr(\n                {\n                    method: \"POST\",\n\n                    path: `/api/0.6/notes/${id}/comment?text=${encodeURIComponent(text)}`,\n                },\n                function (err) {\n                    if (err !== null) {\n                        error(err)\n                    } else {\n                        ok()\n                    }\n                }\n            )\n        })\n    }\n\n    /**\n     * To be called by land.html\n     */\n    public finishLogin(callback: (previousURL: string) => void) {\n        this.auth.authenticate(function () {\n            // Fully authed at this point\n            console.log(\"Authentication successful!\")\n            const previousLocation = LocalStorageSource.Get(\"location_before_login\")\n            callback(previousLocation.data)\n        })\n    }\n\n    private updateAuthObject() {\n        this.auth = new osmAuth({\n            client_id: this._oauth_config.oauth_client_id,\n            url: this._oauth_config.url,\n            scope: \"read_prefs write_prefs write_api write_gpx write_notes openid\",\n            redirect_uri: Utils.runningFromConsole\n                ? \"https://mapcomplete.org/land.html\"\n                : window.location.protocol + \"//\" + window.location.host + \"/land.html\",\n            singlepage: true, // We always use 'singlePage', it is the most stable - including in PWA\n            auto: true,\n        })\n    }\n\n    private CheckForMessagesContinuously() {\n        if (this.isChecking) {\n            return\n        }\n        Stores.Chronic(3 * 1000).addCallback(() => {\n            if (!(this.apiIsOnline.data === \"unreachable\" || this.apiIsOnline.data === \"offline\")) {\n                return\n            }\n            try {\n                console.log(\"Api is offline - trying to reconnect...\")\n                this.AttemptLogin()\n            } catch (e) {\n                console.log(\"Could not login due to\", e)\n            }\n        })\n        this.isChecking = true\n        if (!this._doCheckRegularly) {\n            return\n        }\n        Stores.Chronic(60 * 5 * 1000).addCallback(() => {\n            if (this.isLoggedIn.data) {\n                try {\n                    this.AttemptLogin()\n                } catch (e) {\n                    console.log(\"Could not login due to\", e)\n                }\n            }\n        })\n    }\n\n    private UpdateCapabilities(): void {\n        if (this.fakeUser) {\n            return\n        }\n        this.FetchCapabilities().then(({ api, gpx }) => {\n            this.apiIsOnline.setData(api)\n            this.gpxServiceIsOnline.setData(gpx)\n        })\n    }\n\n    private readonly _userInfoCache: Record<number, OsmUserInfo> = {}\n\n    public async getInformationAboutUser(id: number): Promise<OsmUserInfo> {\n        if (id === undefined) {\n            return undefined\n        }\n        if (this._userInfoCache[id]) {\n            return this._userInfoCache[id]\n        }\n        const info = await this.get(\"user/\" + id + \".json\", { accepts: \"application/json\" }, true)\n        const parsed = JSON.parse(info)[\"user\"]\n        this._userInfoCache[id] = parsed\n        return parsed\n    }\n\n    private async FetchCapabilities(): Promise<{ api: OsmServiceState; gpx: OsmServiceState }> {\n        if (Utils.runningFromConsole) {\n            return { api: \"online\", gpx: \"online\" }\n        }\n        const result = await Utils.downloadAdvanced(this.Backend() + \"/api/0.6/capabilities\")\n        if (result[\"content\"] === undefined) {\n            console.log(\"Something went wrong:\", result)\n            return { api: \"unreachable\", gpx: \"unreachable\" }\n        }\n        const xmlRaw = result[\"content\"]\n        const parsed = new DOMParser().parseFromString(xmlRaw, \"text/xml\")\n        const statusEl = parsed.getElementsByTagName(\"status\")[0]\n        const api = <OsmServiceState>statusEl.getAttribute(\"api\")\n        const gpx = <OsmServiceState>statusEl.getAttribute(\"gpx\")\n        return { api, gpx }\n    }\n}\n"],"names":["entries","setPrototypeOf","isFrozen","getPrototypeOf","getOwnPropertyDescriptor","freeze","seal","create","apply","construct","fun","thisValue","args","x","Func","arrayForEach","unapply","arrayPop","arrayPush","stringToLowerCase","stringToString","stringMatch","stringReplace","stringIndexOf","stringTrim","regExpTest","typeErrorCreate","unconstruct","func","thisArg","_len","_key","_len2","_key2","addToSet","set","array","transformCaseFunc","_transformCaseFunc","l","element","lcElement","clone","object","newObject","property","value","lookupGetter","prop","desc","fallbackValue","html$1","svg$1","svgFilters","svgDisallowed","mathMl$1","mathMlDisallowed","text","html","svg","mathMl","xml","MUSTACHE_EXPR","ERB_EXPR","TMPLIT_EXPR","DATA_ATTR","ARIA_ATTR","IS_ALLOWED_URI","IS_SCRIPT_OR_DATA","ATTR_WHITESPACE","DOCTYPE_NAME","EXPRESSIONS","getGlobal","_createTrustedTypesPolicy","trustedTypes","purifyHostElement","suffix","ATTR_NAME","policyName","scriptUrl","createDOMPurify","window","DOMPurify","root","originalDocument","currentScript","document","DocumentFragment","HTMLTemplateElement","Node","Element","NodeFilter","NamedNodeMap","HTMLFormElement","DOMParser","ElementPrototype","cloneNode","getNextSibling","getChildNodes","getParentNode","template","trustedTypesPolicy","emptyHTML","implementation","createNodeIterator","createDocumentFragment","getElementsByTagName","importNode","hooks","IS_ALLOWED_URI$1","ALLOWED_TAGS","DEFAULT_ALLOWED_TAGS","ALLOWED_ATTR","DEFAULT_ALLOWED_ATTR","CUSTOM_ELEMENT_HANDLING","FORBID_TAGS","FORBID_ATTR","ALLOW_ARIA_ATTR","ALLOW_DATA_ATTR","ALLOW_UNKNOWN_PROTOCOLS","ALLOW_SELF_CLOSE_IN_ATTR","SAFE_FOR_TEMPLATES","WHOLE_DOCUMENT","SET_CONFIG","FORCE_BODY","RETURN_DOM","RETURN_DOM_FRAGMENT","RETURN_TRUSTED_TYPE","SANITIZE_DOM","SANITIZE_NAMED_PROPS","SANITIZE_NAMED_PROPS_PREFIX","KEEP_CONTENT","IN_PLACE","USE_PROFILES","FORBID_CONTENTS","DEFAULT_FORBID_CONTENTS","DATA_URI_TAGS","DEFAULT_DATA_URI_TAGS","URI_SAFE_ATTRIBUTES","DEFAULT_URI_SAFE_ATTRIBUTES","MATHML_NAMESPACE","SVG_NAMESPACE","HTML_NAMESPACE","NAMESPACE","IS_EMPTY_INPUT","ALLOWED_NAMESPACES","DEFAULT_ALLOWED_NAMESPACES","PARSER_MEDIA_TYPE","SUPPORTED_PARSER_MEDIA_TYPES","DEFAULT_PARSER_MEDIA_TYPE","CONFIG","formElement","isRegexOrFunction","testValue","_parseConfig","cfg","MATHML_TEXT_INTEGRATION_POINTS","HTML_INTEGRATION_POINTS","COMMON_SVG_AND_HTML_ELEMENTS","ALL_SVG_TAGS","ALL_MATHML_TAGS","_checkValidNamespace","parent","tagName","parentTagName","_forceRemove","node","_removeAttribute","name","_initDocument","dirty","doc","leadingWhitespace","matches","dirtyPayload","body","_createIterator","_isClobbered","elm","_isNode","_executeHook","entryPoint","currentNode","data","hook","_sanitizeElements","content","_basicCustomElementTest","parentNode","childNodes","childCount","i","_isValidAttribute","lcTag","lcName","_sanitizeAttributes","attr","attributes","hookEvent","namespaceURI","_sanitizeShadowDOM","fragment","shadowNode","shadowIterator","importedNode","returnNode","nodeIterator","serializedHTML","tag","hookFunction","purify","_Utils","src","specs","parsed","spec","arg","_a","str","f","count","res","o","hist","s","ls","t","init","whenDone","e","arr","newArr","string","seen","duplicates","list","result","t1","t2","eq","a","b","k","sep","index","txt","tags","useLang","regex","match","_","normal","key","leftover","v","location","head","link","target","source","trimmedKey","sourceV","targetV","newList","path","replaceLeaf","travelledPath","leaf","sub","el","collectedList","json","isLeaf","jtp","cp","collect","dict","found","minified","parts","keys","part","url","headers","method","resolve","reject","xhr","ev","maxCacheTimeMs","cached","promise","injected","contents","fileName","options","file","timeMillis","seconds","minutes","hours","days","daysInThePast","theme","now","lastWeek","date","osmcha_link","range","selection","reference","ts","getName","withDistance","__","n","str1","str2","track","j","indicator","d","onValue","newD","vs","c","componentToHex","hex","parentRect","elementRect","topIsVisible","bottomIsVisible","ai","bi","aKey","bKey","preparts","prepart","postParts","subs","message","offset","stack","stackItem","functionName","line","column","matchWithFuncName","regexNoFuncName","markdownLocation","length","chr","obj","newObj","objKey","cleanKey","childs","child","c0","c1","layers","__publicField","Utils","Stores","millis","asLong","UIEventSource","run","err","possibleSources","stable","Store","createStack","callstack","extraStoresToWatch","callbackDestroyFunction","comparator","oldValue","mapped","sink","seenEventSources","newEventSource","resultData","millisToStabilize","newSource","self","latestData","condition","_ImmutableStore","callback","extraStores","ondestroyCallback","MappedStore","ImmutableStore","ListenerTracker","toDelete","startTime","toDeleteElement","_MappedStore","upstream","upstreamListenerHandler","initialState","onDestroy","stores","_b","_c","store","unregister","unr","newData","_UIEventSource","possibleSource","onError","fl","stringUIEventSource","extraSources","g","allowUnregister","callee","update","extraSource","latest","otherSource","reverseOverride","_Constants","packagefile.version","packagefile.config","extraconfig","Constants","LocalStorageSource","defaultValue","saved","osmAuth","oauth","_store","_mock","token","val","_preopenPopup","error","popup","_generatePkceChallenge","pkce","_authenticate","errback","w","settings","state","generateState","utilQsString","params","utilStringQs","_getAccessToken","accessTokenDone","access_token","auth_code","code_verifier","broughtPopupToFront","resource","_doFetch","_doXHR","done","h","pair","supportsWebCryptoAPI","random","base64","verifier","char","hash","code_challenge","chars","buffer","OsmPreferences","auth","osmConnection","fakeUser","prefix","allStartWith","subOptions","updateData","prefsCount","pref","allPrefs","isRunning","prefs","prefixes","forceUpdate","seenKeys","preference","osmValue","UserDetails","backend","OsmConnection","ud","user","isLoggedIn","action","details","userInfo","imgEl","description","homeEl","lat","lon","messages","header","allowAnonymous","connection","possibleResult","ok","response","id","textSuffix","gpx","extras","boundary","previousLocation","api","info","xmlRaw","statusEl"],"mappings":"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","x_google_ignoreList":[0,5]}