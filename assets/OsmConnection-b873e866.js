var Zt=Object.defineProperty;var Qt=(d,e,t)=>e in d?Zt(d,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[e]=t;var c=(d,e,t)=>(Qt(d,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();/*! @license DOMPurify 3.0.5 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.0.5/LICENSE */const{entries:Ot,setPrototypeOf:_t,isFrozen:en,getPrototypeOf:tn,getOwnPropertyDescriptor:nn}=Object;let{freeze:M,seal:W,create:rn}=Object,{apply:Ve,construct:je}=typeof Reflect<"u"&&Reflect;Ve||(Ve=function(e,t,n){return e.apply(t,n)});M||(M=function(e){return e});W||(W=function(e){return e});je||(je=function(e,t){return new e(...t)});const an=U(Array.prototype.forEach),bt=U(Array.prototype.pop),le=U(Array.prototype.push),Te=U(String.prototype.toLowerCase),Fe=U(String.prototype.toString),on=U(String.prototype.match),F=U(String.prototype.replace),sn=U(String.prototype.indexOf),ln=U(String.prototype.trim),L=U(RegExp.prototype.test),ce=cn(TypeError);function U(d){return function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return Ve(d,e,n)}}function cn(d){return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return je(d,t)}}function y(d,e,t){var n;t=(n=t)!==null&&n!==void 0?n:Te,_t&&_t(d,null);let i=e.length;for(;i--;){let r=e[i];if(typeof r=="string"){const o=t(r);o!==r&&(en(e)||(e[i]=o),r=o)}d[r]=!0}return d}function re(d){const e=rn(null);for(const[t,n]of Ot(d))e[t]=n;return e}function be(d,e){for(;d!==null;){const n=nn(d,e);if(n){if(n.get)return U(n.get);if(typeof n.value=="function")return U(n.value)}d=tn(d)}function t(n){return console.warn("fallback value for",n),null}return t}const yt=M(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),We=M(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),He=M(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),un=M(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Ge=M(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),dn=M(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Tt=M(["#text"]),vt=M(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","xmlns","slot"]),ze=M(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),At=M(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),ye=M(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),fn=W(/\{\{[\w\W]*|[\w\W]*\}\}/gm),pn=W(/<%[\w\W]*|[\w\W]*%>/gm),hn=W(/\${[\w\W]*}/gm),mn=W(/^data-[\-\w.\u00B7-\uFFFF]/),gn=W(/^aria-[\-\w]+$/),It=W(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),wn=W(/^(?:\w+script|data):/i),_n=W(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Nt=W(/^html$/i);var Et=Object.freeze({__proto__:null,MUSTACHE_EXPR:fn,ERB_EXPR:pn,TMPLIT_EXPR:hn,DATA_ATTR:mn,ARIA_ATTR:gn,IS_ALLOWED_URI:It,IS_SCRIPT_OR_DATA:wn,ATTR_WHITESPACE:_n,DOCTYPE_NAME:Nt});const bn=()=>typeof window>"u"?null:window,yn=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let n=null;const i="data-tt-policy-suffix";t&&t.hasAttribute(i)&&(n=t.getAttribute(i));const r="dompurify"+(n?"#"+n:"");try{return e.createPolicy(r,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+r+" could not be created."),null}};function Mt(){let d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:bn();const e=g=>Mt(g);if(e.version="3.0.5",e.removed=[],!d||!d.document||d.document.nodeType!==9)return e.isSupported=!1,e;const t=d.document,n=t.currentScript;let{document:i}=d;const{DocumentFragment:r,HTMLTemplateElement:o,Node:s,Element:l,NodeFilter:u,NamedNodeMap:h=d.NamedNodeMap||d.MozNamedAttrMap,HTMLFormElement:b,DOMParser:m,trustedTypes:T}=d,A=l.prototype,V=be(A,"cloneNode"),H=be(A,"nextSibling"),$=be(A,"childNodes"),q=be(A,"parentNode");if(typeof o=="function"){const g=i.createElement("template");g.content&&g.content.ownerDocument&&(i=g.content.ownerDocument)}let N,ae="";const{implementation:ve,createNodeIterator:xt,createDocumentFragment:Ut,getElementsByTagName:Ft}=i,{importNode:Wt}=t;let G={};e.isSupported=typeof Ot=="function"&&typeof q=="function"&&ve&&ve.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:Ae,ERB_EXPR:Ee,TMPLIT_EXPR:ke,DATA_ATTR:Ht,ARIA_ATTR:Gt,IS_SCRIPT_OR_DATA:zt,ATTR_WHITESPACE:Je}=Et;let{IS_ALLOWED_URI:Ke}=Et,C=null;const Xe=y({},[...yt,...We,...He,...Ge,...Tt]);let D=null;const Ze=y({},[...vt,...ze,...At,...ye]);let k=Object.seal(Object.create(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),oe=null,Ce=null,Qe=!0,De=!0,et=!1,tt=!0,Z=!1,J=!1,Se=!1,Re=!1,Q=!1,pe=!1,he=!1,nt=!0,it=!1;const Bt="user-content-";let Oe=!0,se=!1,ee={},te=null;const rt=y({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let at=null;const ot=y({},["audio","video","img","source","image","track"]);let Ie=null;const st=y({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),me="http://www.w3.org/1998/Math/MathML",ge="http://www.w3.org/2000/svg",j="http://www.w3.org/1999/xhtml";let ne=j,Ne=!1,Me=null;const Vt=y({},[me,ge,j],Fe);let K;const jt=["application/xhtml+xml","text/html"],Yt="text/html";let S,ie=null;const $t=i.createElement("form"),lt=function(a){return a instanceof RegExp||a instanceof Function},Le=function(a){if(!(ie&&ie===a)){if((!a||typeof a!="object")&&(a={}),a=re(a),K=jt.indexOf(a.PARSER_MEDIA_TYPE)===-1?K=Yt:K=a.PARSER_MEDIA_TYPE,S=K==="application/xhtml+xml"?Fe:Te,C="ALLOWED_TAGS"in a?y({},a.ALLOWED_TAGS,S):Xe,D="ALLOWED_ATTR"in a?y({},a.ALLOWED_ATTR,S):Ze,Me="ALLOWED_NAMESPACES"in a?y({},a.ALLOWED_NAMESPACES,Fe):Vt,Ie="ADD_URI_SAFE_ATTR"in a?y(re(st),a.ADD_URI_SAFE_ATTR,S):st,at="ADD_DATA_URI_TAGS"in a?y(re(ot),a.ADD_DATA_URI_TAGS,S):ot,te="FORBID_CONTENTS"in a?y({},a.FORBID_CONTENTS,S):rt,oe="FORBID_TAGS"in a?y({},a.FORBID_TAGS,S):{},Ce="FORBID_ATTR"in a?y({},a.FORBID_ATTR,S):{},ee="USE_PROFILES"in a?a.USE_PROFILES:!1,Qe=a.ALLOW_ARIA_ATTR!==!1,De=a.ALLOW_DATA_ATTR!==!1,et=a.ALLOW_UNKNOWN_PROTOCOLS||!1,tt=a.ALLOW_SELF_CLOSE_IN_ATTR!==!1,Z=a.SAFE_FOR_TEMPLATES||!1,J=a.WHOLE_DOCUMENT||!1,Q=a.RETURN_DOM||!1,pe=a.RETURN_DOM_FRAGMENT||!1,he=a.RETURN_TRUSTED_TYPE||!1,Re=a.FORCE_BODY||!1,nt=a.SANITIZE_DOM!==!1,it=a.SANITIZE_NAMED_PROPS||!1,Oe=a.KEEP_CONTENT!==!1,se=a.IN_PLACE||!1,Ke=a.ALLOWED_URI_REGEXP||It,ne=a.NAMESPACE||j,k=a.CUSTOM_ELEMENT_HANDLING||{},a.CUSTOM_ELEMENT_HANDLING&&lt(a.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(k.tagNameCheck=a.CUSTOM_ELEMENT_HANDLING.tagNameCheck),a.CUSTOM_ELEMENT_HANDLING&&lt(a.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(k.attributeNameCheck=a.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),a.CUSTOM_ELEMENT_HANDLING&&typeof a.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(k.allowCustomizedBuiltInElements=a.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),Z&&(De=!1),pe&&(Q=!0),ee&&(C=y({},[...Tt]),D=[],ee.html===!0&&(y(C,yt),y(D,vt)),ee.svg===!0&&(y(C,We),y(D,ze),y(D,ye)),ee.svgFilters===!0&&(y(C,He),y(D,ze),y(D,ye)),ee.mathMl===!0&&(y(C,Ge),y(D,At),y(D,ye))),a.ADD_TAGS&&(C===Xe&&(C=re(C)),y(C,a.ADD_TAGS,S)),a.ADD_ATTR&&(D===Ze&&(D=re(D)),y(D,a.ADD_ATTR,S)),a.ADD_URI_SAFE_ATTR&&y(Ie,a.ADD_URI_SAFE_ATTR,S),a.FORBID_CONTENTS&&(te===rt&&(te=re(te)),y(te,a.FORBID_CONTENTS,S)),Oe&&(C["#text"]=!0),J&&y(C,["html","head","body"]),C.table&&(y(C,["tbody"]),delete oe.tbody),a.TRUSTED_TYPES_POLICY){if(typeof a.TRUSTED_TYPES_POLICY.createHTML!="function")throw ce('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof a.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw ce('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');N=a.TRUSTED_TYPES_POLICY,ae=N.createHTML("")}else N===void 0&&(N=yn(T,n)),N!==null&&typeof ae=="string"&&(ae=N.createHTML(""));M&&M(a),ie=a}},ct=y({},["mi","mo","mn","ms","mtext"]),ut=y({},["foreignobject","desc","title","annotation-xml"]),qt=y({},["title","style","font","a","script"]),we=y({},We);y(we,He),y(we,un);const Pe=y({},Ge);y(Pe,dn);const Jt=function(a){let f=q(a);(!f||!f.tagName)&&(f={namespaceURI:ne,tagName:"template"});const p=Te(a.tagName),v=Te(f.tagName);return Me[a.namespaceURI]?a.namespaceURI===ge?f.namespaceURI===j?p==="svg":f.namespaceURI===me?p==="svg"&&(v==="annotation-xml"||ct[v]):!!we[p]:a.namespaceURI===me?f.namespaceURI===j?p==="math":f.namespaceURI===ge?p==="math"&&ut[v]:!!Pe[p]:a.namespaceURI===j?f.namespaceURI===ge&&!ut[v]||f.namespaceURI===me&&!ct[v]?!1:!Pe[p]&&(qt[p]||!we[p]):!!(K==="application/xhtml+xml"&&Me[a.namespaceURI]):!1},X=function(a){le(e.removed,{element:a});try{a.parentNode.removeChild(a)}catch{a.remove()}},xe=function(a,f){try{le(e.removed,{attribute:f.getAttributeNode(a),from:f})}catch{le(e.removed,{attribute:null,from:f})}if(f.removeAttribute(a),a==="is"&&!D[a])if(Q||pe)try{X(f)}catch{}else try{f.setAttribute(a,"")}catch{}},dt=function(a){let f,p;if(Re)a="<remove></remove>"+a;else{const P=on(a,/^[\r\n\t ]+/);p=P&&P[0]}K==="application/xhtml+xml"&&ne===j&&(a='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+a+"</body></html>");const v=N?N.createHTML(a):a;if(ne===j)try{f=new m().parseFromString(v,K)}catch{}if(!f||!f.documentElement){f=ve.createDocument(ne,"template",null);try{f.documentElement.innerHTML=Ne?ae:v}catch{}}const R=f.body||f.documentElement;return a&&p&&R.insertBefore(i.createTextNode(p),R.childNodes[0]||null),ne===j?Ft.call(f,J?"html":"body")[0]:J?f.documentElement:R},ft=function(a){return xt.call(a.ownerDocument||a,a,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT,null,!1)},Kt=function(a){return a instanceof b&&(typeof a.nodeName!="string"||typeof a.textContent!="string"||typeof a.removeChild!="function"||!(a.attributes instanceof h)||typeof a.removeAttribute!="function"||typeof a.setAttribute!="function"||typeof a.namespaceURI!="string"||typeof a.insertBefore!="function"||typeof a.hasChildNodes!="function")},_e=function(a){return typeof s=="object"?a instanceof s:a&&typeof a=="object"&&typeof a.nodeType=="number"&&typeof a.nodeName=="string"},Y=function(a,f,p){G[a]&&an(G[a],v=>{v.call(e,f,p,ie)})},pt=function(a){let f;if(Y("beforeSanitizeElements",a,null),Kt(a))return X(a),!0;const p=S(a.nodeName);if(Y("uponSanitizeElement",a,{tagName:p,allowedTags:C}),a.hasChildNodes()&&!_e(a.firstElementChild)&&(!_e(a.content)||!_e(a.content.firstElementChild))&&L(/<[/\w]/g,a.innerHTML)&&L(/<[/\w]/g,a.textContent))return X(a),!0;if(!C[p]||oe[p]){if(!oe[p]&&mt(p)&&(k.tagNameCheck instanceof RegExp&&L(k.tagNameCheck,p)||k.tagNameCheck instanceof Function&&k.tagNameCheck(p)))return!1;if(Oe&&!te[p]){const v=q(a)||a.parentNode,R=$(a)||a.childNodes;if(R&&v){const P=R.length;for(let E=P-1;E>=0;--E)v.insertBefore(V(R[E],!0),H(a))}}return X(a),!0}return a instanceof l&&!Jt(a)||(p==="noscript"||p==="noembed"||p==="noframes")&&L(/<\/no(script|embed|frames)/i,a.innerHTML)?(X(a),!0):(Z&&a.nodeType===3&&(f=a.textContent,f=F(f,Ae," "),f=F(f,Ee," "),f=F(f,ke," "),a.textContent!==f&&(le(e.removed,{element:a.cloneNode()}),a.textContent=f)),Y("afterSanitizeElements",a,null),!1)},ht=function(a,f,p){if(nt&&(f==="id"||f==="name")&&(p in i||p in $t))return!1;if(!(De&&!Ce[f]&&L(Ht,f))){if(!(Qe&&L(Gt,f))){if(!D[f]||Ce[f]){if(!(mt(a)&&(k.tagNameCheck instanceof RegExp&&L(k.tagNameCheck,a)||k.tagNameCheck instanceof Function&&k.tagNameCheck(a))&&(k.attributeNameCheck instanceof RegExp&&L(k.attributeNameCheck,f)||k.attributeNameCheck instanceof Function&&k.attributeNameCheck(f))||f==="is"&&k.allowCustomizedBuiltInElements&&(k.tagNameCheck instanceof RegExp&&L(k.tagNameCheck,p)||k.tagNameCheck instanceof Function&&k.tagNameCheck(p))))return!1}else if(!Ie[f]){if(!L(Ke,F(p,Je,""))){if(!((f==="src"||f==="xlink:href"||f==="href")&&a!=="script"&&sn(p,"data:")===0&&at[a])){if(!(et&&!L(zt,F(p,Je,"")))){if(p)return!1}}}}}}return!0},mt=function(a){return a.indexOf("-")>0},gt=function(a){let f,p,v,R;Y("beforeSanitizeAttributes",a,null);const{attributes:P}=a;if(!P)return;const E={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:D};for(R=P.length;R--;){f=P[R];const{name:z,namespaceURI:Ue}=f;if(p=z==="value"?f.value:ln(f.value),v=S(z),E.attrName=v,E.attrValue=p,E.keepAttr=!0,E.forceKeepAttr=void 0,Y("uponSanitizeAttribute",a,E),p=E.attrValue,E.forceKeepAttr||(xe(z,a),!E.keepAttr))continue;if(!tt&&L(/\/>/i,p)){xe(z,a);continue}Z&&(p=F(p,Ae," "),p=F(p,Ee," "),p=F(p,ke," "));const wt=S(a.nodeName);if(ht(wt,v,p)){if(it&&(v==="id"||v==="name")&&(xe(z,a),p=Bt+p),N&&typeof T=="object"&&typeof T.getAttributeType=="function"&&!Ue)switch(T.getAttributeType(wt,v)){case"TrustedHTML":{p=N.createHTML(p);break}case"TrustedScriptURL":{p=N.createScriptURL(p);break}}try{Ue?a.setAttributeNS(Ue,z,p):a.setAttribute(z,p),bt(e.removed)}catch{}}}Y("afterSanitizeAttributes",a,null)},Xt=function g(a){let f;const p=ft(a);for(Y("beforeSanitizeShadowDOM",a,null);f=p.nextNode();)Y("uponSanitizeShadowNode",f,null),!pt(f)&&(f.content instanceof r&&g(f.content),gt(f));Y("afterSanitizeShadowDOM",a,null)};return e.sanitize=function(g){let a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},f,p,v,R;if(Ne=!g,Ne&&(g="<!-->"),typeof g!="string"&&!_e(g))if(typeof g.toString=="function"){if(g=g.toString(),typeof g!="string")throw ce("dirty is not a string, aborting")}else throw ce("toString is not a function");if(!e.isSupported)return g;if(Se||Le(a),e.removed=[],typeof g=="string"&&(se=!1),se){if(g.nodeName){const z=S(g.nodeName);if(!C[z]||oe[z])throw ce("root node is forbidden and cannot be sanitized in-place")}}else if(g instanceof s)f=dt("<!---->"),p=f.ownerDocument.importNode(g,!0),p.nodeType===1&&p.nodeName==="BODY"||p.nodeName==="HTML"?f=p:f.appendChild(p);else{if(!Q&&!Z&&!J&&g.indexOf("<")===-1)return N&&he?N.createHTML(g):g;if(f=dt(g),!f)return Q?null:he?ae:""}f&&Re&&X(f.firstChild);const P=ft(se?g:f);for(;v=P.nextNode();)pt(v)||(v.content instanceof r&&Xt(v.content),gt(v));if(se)return g;if(Q){if(pe)for(R=Ut.call(f.ownerDocument);f.firstChild;)R.appendChild(f.firstChild);else R=f;return(D.shadowroot||D.shadowrootmode)&&(R=Wt.call(t,R,!0)),R}let E=J?f.outerHTML:f.innerHTML;return J&&C["!doctype"]&&f.ownerDocument&&f.ownerDocument.doctype&&f.ownerDocument.doctype.name&&L(Nt,f.ownerDocument.doctype.name)&&(E="<!DOCTYPE "+f.ownerDocument.doctype.name+`>
`+E),Z&&(E=F(E,Ae," "),E=F(E,Ee," "),E=F(E,ke," ")),N&&he?N.createHTML(E):E},e.setConfig=function(g){Le(g),Se=!0},e.clearConfig=function(){ie=null,Se=!1},e.isValidAttribute=function(g,a,f){ie||Le({});const p=S(g),v=S(a);return ht(p,v,f)},e.addHook=function(g,a){typeof a=="function"&&(G[g]=G[g]||[],le(G[g],a))},e.removeHook=function(g){if(G[g])return bt(G[g])},e.removeHooks=function(g){G[g]&&(G[g]=[])},e.removeAllHooks=function(){G={}},e}var kt=Mt();const _=class _{static initDomPurify(){_.runningFromConsole||kt.addHook("afterSanitizeAttributes",function(e){e.getAttribute("target")&&(e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer"))})}static purify(e){return kt.sanitize(e,{USE_PROFILES:{html:!0},ADD_ATTR:["target"]})}static ParseVisArgs(e,t){var i;const n={};if(t.length>e.length)throw"To much arguments for special visualization: got "+t.join(",")+" but expected only "+t.length+" arguments";for(let r=0;r<e.length;r++){const o=e[r];let s=(i=t[r])==null?void 0:i.trim();(s===void 0||s==="")&&(s=o.defaultValue),n[o.name]=s}return n}static EncodeXmlValue(e){return typeof e!="string"&&(e=""+e),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}static asFloat(e){if(e){const t=parseFloat(e);return isNaN(t)?void 0:t}}static Upper(e){return e.substr(0,1).toUpperCase()+e.substr(1)}static TwoDigits(e){return e<10?"0"+e:""+e}static Round7(e){if(e!=null)return Math.round(e*1e7)/1e7}static Times(e,t){let n="";for(let i=0;i<t;i++)n+=e(i);return n}static TimesT(e,t){const n=[];for(let i=0;i<e;i++)n.push(t(i));return n}static NoNull(e){return e==null?void 0:e.filter(t=>t!=null)}static Hist(e){const t=new Map;for(const n of e)t.set(n,1+(t.get(n)??0));return t}static NoEmpty(e){const t=[];if(!e)return t;for(const n of e)n!==""&&t.push(n);return t}static EllipsesAfter(e,t=100){if(e!=null){if(typeof e!="string"){console.error("Not a string:",e);return}return e.length<=t?e:e.substr(0,t-1)+"â€¦"}}static AddLazyProperty(e,t,n,i){Object.defineProperty(e,t,{enumerable:!1,configurable:!0,get:()=>{delete e[t];try{return e[t]=n(),i&&i(),e[t]}catch(r){console.error("Error while calculating a lazy property",r);return}}})}static AddLazyPropertyAsync(e,t,n,i){Object.defineProperty(e,t,{enumerable:!1,configurable:!0,get:()=>{n().then(r=>{delete e[t],e[t]=r,i&&i()})}})}static FixedLength(e,t){for(e=_.EllipsesAfter(e,t);e.length<t;)e=" "+e;return e}static Dedup(e){if(e==null)return e;const t=[];for(const n of e)t.indexOf(n)<0&&t.push(n);return t}static Duplicates(e){if(e===void 0)return;const t=new Set,n=new Set;for(const i of e)t.has(i)&&n.add(i),t.add(i);return Array.from(n)}static Flatten(e){const t=[];for(const n of e)Array.isArray(n)?t.push(...n):t.push(n);return t}static Identical(e,t,n){if(e.length!==t.length)return!1;n=(i,r)=>i===r;for(let i=0;i<e.length;i++)if(!n(e[i],t[i]))return!1;return!0}static MergeTags(e,t){const n={};for(const i in e)n[i]=e[i];for(const i in t)n[i]=t[i];return n}static SplitFirst(e,t){const n=e.indexOf(t);return n<0?[e]:[e.substr(0,n),e.substr(n+t.length)]}static SubstituteKeys(e,t,n){var s;if(e===void 0)return;const i=/(.*?){([^}]*)}(.*)/s;let r=e.match(i);if(!r)return e;let o="";for(;r;){const[l,u,h,b]=r;let m=t==null?void 0:t[h];m!=null?(m.toISOString!=null&&(m=el.toISOString()),n!==void 0&&(m==null?void 0:m.translations)!==void 0&&(m=m.translations[n]??m.translations["*"]??(m==null?void 0:m.textFor(n))??m),m.InnerConstructElement!==void 0&&(console.warn(`SubstituteKeys received a BaseUIElement to substitute in - this is probably a bug and will be downcast to a string
The key is`,h,`
The value is`,m),m=(s=m.InnerConstructElement())==null?void 0:s.textContent),typeof m!="string"&&(m=""+m),m=m.replace(/\n/g,"<br/>")):m="",o+=u+m,r=b.match(i),r||(o+=b)}return o}static LoadCustomCss(e){const t=document.getElementsByTagName("head")[0],n=document.createElement("link");n.id="customCss",n.rel="stylesheet",n.type="text/css",n.href=e,n.media="all",t.appendChild(n),console.log("Added custom css file ",e)}static PushList(e,t){t!==void 0&&e.push(...t)}static Merge(e,t){if(t===null)return _.CleanMergeObject(e);for(const n in e){if(n.startsWith("=")){const o=n.substr(1);t[o]=e[n];continue}if(n.startsWith("+")||n.endsWith("+")){const o=n.replace("+",""),s=e[n],l=t[o]??[];let u;if(n.startsWith("+")){if(!Array.isArray(l))throw new Error("Cannot concatenate: value to add is not an array: "+JSON.stringify(l));if(Array.isArray(s))u=s.concat(l)??l;else throw new Error("Could not merge concatenate "+JSON.stringify(s)+" and "+JSON.stringify(l))}else u=l.concat(s??[]);t[o]=u;continue}const i=e[n],r=t[n];typeof i=="object"?i===null?t[n]=null:r===void 0?t[n]=_.CleanMergeObject(i):_.Merge(i,r):t[n]=_.CleanMergeObject(i)}return t}static WalkPath(e,t,n,i=[]){if(t==null)return;const r=e[0];if(e.length===1){const s=t[r];s!==void 0&&(Array.isArray(s)?t[r]=s.map(l=>n(l,i)):(t[r]=n(s,i),t[r]===void 0&&delete t[r]));return}const o=t[r];if(o!==void 0&&typeof o=="object"){if(Array.isArray(o)){o.forEach((s,l)=>_.WalkPath(e.slice(1),s,n,[...i,r,""+l]));return}_.WalkPath(e.slice(1),o,n,[...i,r])}}static CollectPath(e,t,n=[],i=[]){if(t==null)return n;const r=e[0];if(i=[...i,r],e.length===1){const s=t[r];if(s==null)return n;if(Array.isArray(s))for(let l=0;l<s.length;l++){const u=s[l];n.push({leaf:u,path:[...i,""+l]})}else n.push({leaf:s,path:i});return n}const o=t[r];return o==null?n:Array.isArray(o)?(o.forEach((s,l)=>_.CollectPath(e.slice(1),s,n,[...i,""+l])),n):typeof o!="object"?n:_.CollectPath(e.slice(1),o,n,i)}static WalkJson(e,t,n=void 0,i=[]){if(e==null)return t(e,i);const r=typeof e;if(n!==void 0)if(r==="object"){if(n(e))return t(e,i)}else return e;else if(r==="boolean"||r==="string"||r==="number")return t(e,i);if(Array.isArray(e))return e.map((s,l)=>_.WalkJson(s,t,n,[...i,""+l]));const o={...e};for(const s in e)o[s]=_.WalkJson(e[s],t,n,[...i,s]);return o}static WalkObject(e,t,n=void 0,i=[]){if(e===void 0)return;const r=typeof e;if(n!==void 0){if(r!=="object")return;if(n(e))return t(e,i)}else if(r==="boolean"||r==="string"||r==="number"){t(e,i);return}if(Array.isArray(e)){e.map((o,s)=>_.WalkObject(o,t,n,[...i,s]));return}for(const o in e)_.WalkObject(e[o],t,n,[...i,o])}static getOrSetDefault(e,t,n){const i=e.get(t);return i!==void 0?i:(e.set(t,n()),e.get(t))}static UnMinify(e){if(e==null)return;const t=e.split("|");let n=t.shift();const i=_.knownKeys.concat(_.extraKeys);for(const r of t){if(r==""){n+="|";continue}const o=r.charCodeAt(0);n+='"'+i[o]+'":'+r.substring(1)}return n}static injectJsonDownloadForTests(e,t){_.injectedDownloads[e]=t}static async download(e,t){const n=await _.downloadAdvanced(e,t);if(n.error!==void 0)throw n.error;return n.content}static downloadAdvanced(e,t,n="GET",i){return this.externalDownloadFunction!==void 0?this.externalDownloadFunction(e,t):new Promise((r,o)=>{const s=new XMLHttpRequest;if(s.onload=()=>{s.status==200?r({content:s.response}):s.status===302?r({redirect:s.getResponseHeader("location")}):s.status===509||s.status===429?r({error:"rate limited",url:e,statuscode:s.status}):r({error:"other error: "+s.statusText+", "+s.responseText,url:e,statuscode:s.status})},s.open(n,e),t!==void 0)for(const l in t)s.setRequestHeader(l,t[l]);s.send(i),s.onerror=l=>o("Could not get "+e+", xhr status code is "+s.status+" ("+s.statusText+")")})}static upload(e,t,n){return new Promise((i,r)=>{const o=new XMLHttpRequest;if(o.onload=()=>{o.status==200?i(o.response):o.status===509||o.status===429?r("rate limited"):r(o.statusText)},o.open("POST",e),n!==void 0)for(const s in n)o.setRequestHeader(s,n[s]);o.send(t),o.onerror=r})}static async downloadJsonCached(e,t,n){const i=await _.downloadJsonCachedAdvanced(e,t,n);if(i.content)return i.content;throw i.error}static async downloadJsonCachedAdvanced(e,t,n){const i=_._download_cache.get(e);if(i!==void 0&&new Date().getTime()-i.timestamp<=t)return i.promise;const r=_.downloadJsonAdvanced(e,n);return _._download_cache.set(e,{promise:r,timestamp:new Date().getTime()}),await r}static async downloadJson(e,t){const n=await _.downloadJsonAdvanced(e,t);if(n.content)return n.content;throw n.error}static awaitAnimationFrame(){return new Promise(e=>{window.requestAnimationFrame(()=>{e()})})}static async downloadJsonAdvanced(e,t){const n=_.injectedDownloads[e];if(n!==void 0)return console.debug("Using injected resource for test for URL",e),{content:n};const i=await _.downloadAdvanced(e,_.Merge({accept:"application/json"},t??{}));if(i.error!==void 0)return i;const r=i.content;try{return typeof r=="string"?r===""?{content:{}}:{content:JSON.parse(r)}:{content:r}}catch(o){return console.error("Could not parse the response of",e,"which contains",r,"due to",o,`
`,o.stack),{error:"malformed",url:e}}}static offerContentsAsDownloadableFile(e,t="download.txt",n){const i=document.createElement("a");let r;typeof e=="string"?r=new Blob([e],{type:(n==null?void 0:n.mimetype)??"text/plain"}):r=e,i.href=URL.createObjectURL(r),i.download=t,document.body.appendChild(i),i.click()}static async waitFor(e){return new Promise(t=>{window.setTimeout(t,e)})}static toHumanTime(e){e=Math.floor(e);let t=Math.floor(e/60);e=e%60;let n=Math.floor(t/60);t=t%60;const i=Math.floor(n/24);return n=n%24,i>0?i+"days "+n+"h":n+":"+_.TwoDigits(t)+":"+_.TwoDigits(e)}static HomepageLink(){if(typeof window>"u")return"https://mapcomplete.org";const e=(window.location.protocol+"//"+window.location.host+window.location.pathname).split("/");return e.pop(),e.push("index.html"),e.join("/")}static OsmChaLinkFor(e,t=void 0){const n=new Date,i=new Date(n.getTime()-e*24*60*60*1e3),r=i.getFullYear()+"-"+_.TwoDigits(i.getMonth()+1)+"-"+_.TwoDigits(i.getDate());let o=`"date__gte":[{"label":"${r}","value":"${r}"}],"editor":[{"label":"mapcomplete","value":"mapcomplete"}]`;return t!==void 0&&(o=o+`,"comment":[{"label":"#${t}","value":"#${t}"}]`),"https://osmcha.org/?filters="+encodeURIComponent("{"+o+"}")}static Clone(e){if(e!==void 0)return JSON.parse(JSON.stringify(e))}static ParseDate(e){return e.endsWith(" UTC")&&(e=e.replace(" UTC","+00")),new Date(e)}static selectTextIn(e){if(document.body.createTextRange){const t=document.body.createTextRange();t.moveToElementText(e),t.select()}else if(window.getSelection){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}else console.warn("Could not select text in node: Unsupported browser.")}static sortedByLevenshteinDistance(e,t,n){const i=t.map(r=>[r,_.levenshteinDistance(n(r),e)]);return i.sort(([r,o],[s,l])=>o-l),i.map(r=>r[0])}static levenshteinDistance(e,t){const n=Array(t.length+1).fill(null).map(()=>Array(e.length+1).fill(null));for(let i=0;i<=e.length;i+=1)n[0][i]=i;for(let i=0;i<=t.length;i+=1)n[i][0]=i;for(let i=1;i<=t.length;i+=1)for(let r=1;r<=e.length;r+=1){const o=e[r-1]===t[i-1]?0:1;n[i][r]=Math.min(n[i][r-1]+1,n[i-1][r]+1,n[i-1][r-1]+o)}return n[t.length][e.length]}static MapToObj(e,t){const n={},i=Array.from(e.keys());i.sort();for(const r of i)n[r]=t(e.get(r),r);return n}static TransposeMap(e){const t={};for(const n in e){const i=e[n];for(const r of i){const o=t[r];o===void 0?t[r]=[n]:o.push(n)}}return t}static colorAsHex(e){if(e===void 0)return;function t(n){const i=n.toString(16);return i.length==1?"0"+i:i}return"#"+t(e.r)+t(e.g)+t(e.b)}static color(e){if(e!==void 0){if(e=e.replace(/[ \t]/g,""),e.startsWith("rgba(")){const t=e.match(/rgba\(([0-9.]+),([0-9.]+),([0-9.]+)(,[0-9.]*)?\)/);return t==null?void 0:{r:Number(t[1]),g:Number(t[2]),b:Number(t[3])}}if(e.startsWith("#"))return e.length===4?{r:parseInt(e.substr(1,1),16),g:parseInt(e.substr(2,1),16),b:parseInt(e.substr(3,1),16)}:{r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}}}static asDict(e){const t=new Map;for(const n of e)t.set(n.key,n.value);return t}static toIdRecord(e){const t={};for(const n of e)t[n.id]=n;return t}static SetMidnight(e){e.setUTCHours(0),e.setUTCSeconds(0),e.setUTCMilliseconds(0),e.setUTCMinutes(0)}static scrollIntoView(e){var s;if(!e)return;const t=(s=_.findParentWithScrolling(e))==null?void 0:s.getBoundingClientRect();if(!t)return;const n=e.getBoundingClientRect(),i=n.top>=t.top,r=n.bottom<=t.bottom;i&&r||e.scrollIntoView({behavior:"smooth",block:"nearest"})}static sameList(e,t){if(e==t)return!0;if(e==null||t===void 0||t===null||e.length!==t.length)return!1;for(let n=0;n<e.length;n++){const i=e[n],r=t[n];if(i!=r&&i!==r)return!1}return!0}static SameObject(e,t){if(e===t)return!0;if(e==null||t===null||t===void 0)return!1;if(typeof e=="object"&&typeof t=="object"){for(const n in e)if(!(n in t))return!1;for(const n in t)if(!(n in e))return!1;for(const n in e)if(!_.SameObject(e[n],t[n]))return!1;return!0}return!1}static splitIntoSubstitutionParts(e){const t=e.split("{"),n=[];for(const i of t){const r=i.split("}");if(r.length===1)n.push({message:r[0]});else{const[o,s]=r;n.push({subs:o}),s!==""&&n.push({message:s})}}return n}static getLocationInCode(e=0){const n=new Error("No error").stack.split(`
`);n.shift();const i=/at (.*) \(([a-zA-Z0-9/.]+):([0-9]+):([0-9]+)\)/,r=n[Math.abs(e)+1];let o,s,l,u,h;const b=r.match(i);if(b)[h,o,s,l,u]=b;else{const T=new RegExp("at ([a-zA-Z0-9/.]+):([0-9]+):([0-9]+)");[h,s,l,u]=r.match(T)}const m=s.substring(s.indexOf("MapComplete/src")+11)+"#L"+l;return{path:s,functionName:o,line:Number(l),column:Number(u),markdownLocation:m,filename:s.substring(s.lastIndexOf("/")+1)}}static RemoveDiacritics(e){return e&&e.normalize("NFD").replace(/\p{Diacritic}/gu,"")}static randomString(e){let t="";for(let n=0;n<e;n++){const i=Math.random().toString(36).substr(2,3);t+=i}return t}static CleanMergeObject(e){if(Array.isArray(e)){const n=[];for(const i of e)n.push(_.CleanMergeObject(i));return n}if(typeof e!="object")return e;const t={};for(let n in e){let i=n;n.startsWith("+")||n.startsWith("=")?i=n.substring(1):(n.endsWith("+")||n.endsWith("="))&&(i=n.substring(0,n.length-1)),t[i]=_.CleanMergeObject(e[n])}return t}static focusOn(e){e&&requestAnimationFrame(()=>{e.focus()})}static focusOnFocusableChild(e){e&&requestAnimationFrame(()=>{let t=e.getElementsByClassName("focusable");t.length==0&&(t=e.getElementsByTagName("button"),t.length===0&&(t=e.getElementsByTagName("a")));const n=t.item(0);n!==null&&(n.tagName!=="button"&&n.tagName!=="a"&&n.hasAttribute("tabindex")&&n.setAttribute("tabindex","-1"),n==null||n.focus())})}static findParentWithScrolling(e){return e.scrollHeight>e.clientHeight?e:e.parentElement?_.findParentWithScrolling(e.parentElement):null}static colorDiff(e,t){return Math.abs(e.r-t.r)+Math.abs(e.g-t.g)+Math.abs(e.b-t.b)}static numberWithMetricPrefix(e){let t=0;for(;e>1e3;)e=Math.round(e/1e3),t++;return e+_._metrixPrefixes[t]}static NoNullInplace(e){for(let t=e.length-1;t>=0;t--)(e[t]===null||e[t]===void 0)&&e.splice(t,1)}static isEmoji(e){return _.emojiRegex.test(e)}};c(_,"runningFromConsole",typeof window>"u"),c(_,"externalDownloadFunction"),c(_,"Special_visualizations_tagsToApplyHelpText","These can either be a tag to add, such as `amenity=fast_food` or can use a substitution, e.g. `addr:housenumber=$number`.\nThis new point will then have the tags `amenity=fast_food` and `addr:housenumber` with the value that was saved in `number` in the original feature.\n\nIf a value to substitute is undefined, empty string will be used instead.\n\nThis supports multiple values, e.g. `ref=$source:geometry:type/$source:geometry:ref`\n\nRemark that the syntax is slightly different then expected; it uses '$' to note a value to copy, followed by a name (matched with `[a-zA-Z0-9_:]*`). Sadly, delimiting with `{}` as these already mark the boundaries of the special rendering...\n\nNote that these values can be prepare with javascript in the theme by using a [calculatedTag](calculatedTags.md#calculating-tags-with-javascript)\n "),c(_,"imageExtensions",new Set(["jpg","png","svg","jpeg",".gif"])),c(_,"special_visualizations_importRequirementDocs",`#### Importing a dataset into OpenStreetMap: requirements

If you want to import a dataset, make sure that:

1. The dataset to import has a suitable license
2. The community has been informed of the import
3. All other requirements of the [import guidelines](https://wiki.openstreetmap.org/wiki/Import/Guidelines) have been followed

There are also some technicalities in your theme to keep in mind:

1. The new feature will be added and will flow through the program as any other new point as if it came from OSM.
    This means that there should be a layer which will match the new tags and which will display it.
2. The original feature from your geojson layer will gain the tag '_imported=yes'.
    This should be used to change the appearance or even to hide it (eg by changing the icon size to zero)
3. There should be a way for the theme to detect previously imported points, even after reloading.
    A reference number to the original dataset is an excellent way to do this
4. When importing ways, the theme creator is also responsible of avoiding overlapping ways.

#### Disabled in unofficial themes

The import button can be tested in an unofficial theme by adding \`test=true\` or \`backend=osm-test\` as [URL-paramter](URL_Parameters.md).
The import button will show up then. If in testmode, you can read the changeset-XML directly in the web console.
In the case that MapComplete is pointed to the testing grounds, the edit will be made on https://master.apis.dev.openstreetmap.org`),c(_,"knownKeys",["addExtraTags","and","calculatedTags","changesetmessage","clustering","color","condition","customCss","dashArray","defaultBackgroundId","description","descriptionTail","doNotDownload","enableAddNewPoints","enableBackgroundLayerSelection","enableGeolocation","enableLayers","enableMoreQuests","enableSearch","enableShareScreen","enableUserBadge","freeform","hideFromOverview","hideInAnswer","icon","iconOverlays","iconSize","id","if","ifnot","isShown","key","language","layers","lockLocation","maintainer","mappings","maxzoom","maxZoom","minNeededElements","minzoom","multiAnswer","name","or","osmTags","passAllFeatures","presets","question","render","roaming","roamingRenderings","rotation","shortDescription","socialImage","source","startLat","startLon","startZoom","tagRenderings","tags","then","title","titleIcons","type","version","wayHandling","widenFactor","width"]),c(_,"extraKeys",["nl","en","fr","de","pt","es","name","phone","email","amenity","leisure","highway","building","yes","no","true","false"]),c(_,"injectedDownloads",{}),c(_,"_download_cache",new Map),c(_,"isIframe",!_.runningFromConsole&&window!==window.top),c(_,"_metrixPrefixes",["","k","M","G","T","P","E"]),c(_,"emojiRegex",/^\p{Extended_Pictographic}+$/u);let I=_;class Ct{static Chronic(e,t=void 0){const n=new O(void 0);function i(){n.setData(new Date),!I.runningFromConsole&&(t===void 0||t())&&window.setTimeout(i,e)}return i(),n}static FromPromiseWithErr(e){return O.FromPromiseWithErr(e)}static FromPromise(e){const t=new O(void 0);return e==null||e.then(n=>t.setData(n)),e==null||e.catch(n=>console.warn("Promise failed:",n)),t}static flatten(e,t){return O.flatten(e,t)}static ListStabilized(e){const t=new O(void 0);return e.addCallbackAndRun(n=>{if(n===void 0){t.setData(void 0);return}I.sameList(t.data,n)||t.setData(n)}),t}}class qe{constructor(e=void 0){c(this,"tag");c(this,"M");if(this.tag=e,e===void 0||e===""){let t=I.runningFromConsole;if(I.runningFromConsole||(t=window.location.hostname==="127.0.0.1"),t){const n=new Error().stack.split(`
`);this.tag=n[1]}}}mapD(e,t,n){return this.map(i=>{if(i!==void 0)return i===null?null:e(i)},t)}withEqualityStabilized(e){let t;return this.map(n=>n==t||e(t,n)?t:(t=n,n))}bind(e){const t=this.map(e),n=new O(void 0),i=new Set;return t.addCallbackAndRun(r=>{if(r===null){n.setData(null);return}if(r===void 0){n.setData(void 0);return}if(i.has(r)){n.setData(r.data);return}i.add(r),r.addCallbackAndRun(o=>{t.data===r&&n.setData(o)})}),n}bindD(e){return this.bind(t=>{if(t===null)return null;if(t!==void 0)return e(t)})}stabilized(e){if(I.runningFromConsole)return this;const t=new O(this.data),n=this;return this.addCallback(i=>{window.setTimeout(()=>{n.data==i&&t.setData(i)},e)}),t}AsPromise(e){const t=this;return e=e??(n=>n!==void 0),new Promise(n=>{const i=t.data;e(i)?n(i):t.addCallbackD(r=>e(r)?(n(r),!0):!1)})}subscribe(e,t){return this.addCallbackAndRun(n=>{e(n)})}}const x=class x extends qe{constructor(t){super();c(this,"data");this.data=t}addCallback(t){return x.pass}addCallbackAndRun(t){return t(this.data),x.pass}addCallbackAndRunD(t){return this.data!==void 0&&t(this.data),x.pass}addCallbackD(t){return x.pass}map(t,n=void 0,i){return(n==null?void 0:n.length)>0?new de(this,t,n,void 0,t(this.data),i):new x(t(this.data))}};c(x,"FALSE",new x(!1)),c(x,"TRUE",new x(!0)),c(x,"pass",()=>{});let Dt=x;class Lt{constructor(){c(this,"pingCount",0);c(this,"_callbacks",[])}addCallback(e){if(e===console.log)throw"Don't add console.log directly as a callback - you'll won't be able to find it afterwards. Wrap it in a lambda instead.";return this._callbacks.push(e),()=>{const t=this._callbacks.indexOf(e);t>=0&&this._callbacks.splice(t,1)}}ping(e){this.pingCount++;let t,n=new Date().getTime()/1e3;for(const r of this._callbacks)try{r(e)===!0&&(t===void 0?t=[r]:t.push(r))}catch(o){console.error("Got an error while running a callback:",o)}if(new Date().getTime()/1e3-n>500&&console.trace("Warning: a ping took more then 500ms; this is probably a performance issue"),t!==void 0)for(const r of t)this._callbacks.splice(this._callbacks.indexOf(r),1);return this._callbacks.length}length(){return this._callbacks.length}}const ue=class ue extends qe{constructor(t,n,i,r,o,s){super();c(this,"_upstream");c(this,"_upstreamCallbackHandler");c(this,"_upstreamPingCount",-1);c(this,"_unregisterFromUpstream");c(this,"_f");c(this,"_extraStores");c(this,"_unregisterFromExtraStores");c(this,"_callbacks",new Lt);c(this,"_callbacksAreRegistered",!1);c(this,"_data");this._upstream=t,this._upstreamCallbackHandler=r,this._f=n,this._data=o,this._upstreamPingCount=r==null?void 0:r.pingCount,this._extraStores=i,this.registerCallbacksToUpstream(),s!==void 0&&s(()=>this.unregisterFromUpstream())}get data(){var t;return this._callbacksAreRegistered?this._data:(((t=this._upstreamCallbackHandler)==null?void 0:t.pingCount)!=this._upstreamPingCount&&(this._data=this._f(this._upstream.data)),this._data)}map(t,n=void 0,i){var o,s,l;let r;return((n==null?void 0:n.length)>0||((o=this._extraStores)==null?void 0:o.length)>0)&&(r=[]),(n==null?void 0:n.length)>0&&(r==null||r.push(...n)),((s=this._extraStores)==null?void 0:s.length)>0&&((l=this._extraStores)==null||l.forEach(u=>{r.indexOf(u)<0&&r.push(u)})),new ue(this,t,r,this._callbacks,t(this.data),i)}addCallback(t){this._callbacksAreRegistered||this.registerCallbacksToUpstream();const n=this._callbacks.addCallback(t);return()=>{n(),this._callbacks.length()==0&&this.unregisterFromUpstream()}}addCallbackAndRun(t){const n=this.addCallback(t);return t(this.data)===!0?(n(),ue.pass):n}addCallbackAndRunD(t){return this.addCallbackAndRun(n=>{if(n!==void 0)return t(n)})}addCallbackD(t){return this.addCallback(n=>{if(n!==void 0)return t(n)})}unregisterFromUpstream(){var t;this._callbacksAreRegistered=!1,this._unregisterFromUpstream(),(t=this._unregisterFromExtraStores)==null||t.forEach(n=>n())}registerCallbacksToUpstream(){var n;const t=this;this._unregisterFromUpstream=this._upstream.addCallback(i=>t.update()),this._unregisterFromExtraStores=(n=this._extraStores)==null?void 0:n.map(i=>i==null?void 0:i.addCallback(r=>t.update())),this._callbacksAreRegistered=!0}update(){var n;const t=this._f(this._upstream.data);this._upstreamPingCount=(n=this._upstreamCallbackHandler)==null?void 0:n.pingCount,this._data!==t&&(this._data=t,this._callbacks.ping(this._data))}};c(ue,"pass");let de=ue;const B=class B extends qe{constructor(t,n=""){super(n);c(this,"data");c(this,"_callbacks",new Lt);this.data=t}static flatten(t,n){var r;const i=new B((r=t.data)==null?void 0:r.data);t.addCallback(o=>{i.setData(o==null?void 0:o.data),o.addCallback(s=>{if(t.data!==o)return!0;i.setData(s)})});for(const o of n??[])o==null||o.addCallback(()=>{var s;i.setData((s=t.data)==null?void 0:s.data)});return i}static FromPromise(t,n=void 0){const i=new B(void 0);return t==null||t.then(r=>i.setData(r)),t==null||t.catch(r=>{n!==void 0?n(r):console.warn("Promise failed:",r)}),i}static FromPromiseWithErr(t){var i;const n=new B(void 0);return(i=t==null?void 0:t.then(r=>n.setData({success:r})))==null||i.catch(r=>n.setData({error:r})),n}static asInt(t){return t.sync(n=>{let i=parseInt(n);return isNaN(i)?void 0:i},[],n=>{if(!(n===void 0||isNaN(n)))return""+n})}static asFloat(t){return t.sync(n=>{let i=parseFloat(n);return isNaN(i)?void 0:i},[],n=>{if(!(n===void 0||isNaN(n)))return""+n})}static asBoolean(t){return t.sync(n=>n==="true",[],n=>""+n)}static feedFrom(t){const n=new B(t.data);return t.addCallback(i=>n.setData(i)),n}addCallback(t){return this._callbacks.addCallback(t)}addCallbackAndRun(t){return t(this.data)!==!0?this.addCallback(t):B.pass}addCallbackAndRunD(t){return this.addCallbackAndRun(n=>{if(n!=null)return t(n)})}addCallbackD(t){return this.addCallback(n=>{if(n!=null)return t(n)})}setData(t){if(this.data!=t)return this.data=t,this._callbacks.ping(t),this}ping(){this._callbacks.ping(this.data)}map(t,n=[],i){return new de(this,t,n,this._callbacks,t(this.data),i)}mapD(t,n=[],i){return new de(this,r=>{if(r!==void 0)return r===null?null:t(r)},n,this._callbacks,this.data===void 0||this.data===null?this.data:t(this.data),i)}mapAsyncD(t){return this.bindD(n=>B.FromPromise(t(n)))}sync(t,n,i,r=!1){const o=this,l=new Error().stack.split(`
`)[1],u=new B(t(this.data),"map("+this.tag+")@"+l),h=function(){return u.setData(t(o.data)),r&&u._callbacks.length()===0};this.addCallback(h);for(const b of n)b==null||b.addCallback(h);return i!==void 0&&u.addCallback(b=>{o.setData(i(b,o.data))}),u}syncWith(t,n=!1){this.addCallback(r=>t.setData(r));const i=this;return t.addCallback(r=>i.setData(r)),n?t.data!==void 0&&this.setData(t.data):this.data===void 0?this.setData(t.data):t.setData(this.data),this}set(t){this.setData(t)}update(t){this.setData(t(this.data))}};c(B,"pass");let O=B;const Tn="0.44.4",vn={"#oauth_credentials:comment":["`oauth_credentials` are the OAuth-2 credentials for the production-OSM server and the test-server.","Are you deploying your own instance? Register your application too.","See https://wiki.openstreetmap.org/wiki/OAuth#Registering_your_application_as_OAuth_2.0_consumer for instructions","Use `https://<your domain name>/<path to mapcomplete>/land.html` as redirect URIs. You can add `http://127.0.0.1:1234/land.html` too for local development.","Alternatively, you can override the `osm` credentials using the environment variables `VITE_OSM_OAUTH_CLIENT_ID` and `VITE_OSM_OAUTH_SECRET`"],oauth_credentials:{"#":"This client-id is registered by 'MapComplete' on OpenStreetMap.org",oauth_client_id:"K93H1d8ve7p-tVLE1ZwsQ4lAFLQk8INx5vfTLMu5DWk",oauth_secret:"NBWGhWDrD3QDB35xtVuxv4aExnmIt4FA_WgeLtwxasg",url:"https://www.openstreetmap.org"},mvt_layer_server:"https://cache.mapcomplete.org/public.{type}_{layer}/{z}/{x}/{y}.pbf","#summary_server":"Should be the endpoint; appending status.json should work",summary_server:"https://cache.mapcomplete.org/",geoip_server:"https://ipinfo.mapcomplete.org/",error_server:"https://report.mapcomplete.org/report","disabled:oauth_credentials":{"##":"DEV","#":"This client-id is registered by 'MapComplete' on https://master.apis.dev.openstreetmap.org/",oauth_client_id:"BAPPMRuojjFsY__0APmScr1hbebYj1GlDbV6S5TsUbo",oauth_secret:"Lq1UKYAySRfQfwgFctGvlGrfxbGHQwggheE52HIGrO8",url:"https://master.apis.dev.openstreetmap.org"},api_keys:{"#":"Various API-keys for various services. Feel free to reuse those in another MapComplete-hosted version",imgur:"7070e7167f0a25a",mapillary_v4:"MLY|4441509239301885|b40ad2d3ea105435bd40c7e76993ae85"},default_overpass_urls:["https://overpass-api.de/api/interpreter","https://overpass.kumi.systems/api/interpreter","https://overpass.openstreetmap.ru/cgi/interpreter"],country_coder_host:"https://raw.githubusercontent.com/pietervdvn/MapComplete-data/main/latlon2country",nominatimEndpoint:"https://geocoding.geofabrik.de/b75350b1cfc34962ac49824fe5b582dc/","jsonld-proxy":"https://lod.mapcomplete.org/extractgraph?url={url}",protomaps:{"api-key":"2af8b969a9e8b692",endpoint:"https://api.protomaps.com/tiles/",styles:["https://api.protomaps.com/styles/v2/light.json","https://api.protomaps.com/styles/v2/dark.json","https://api.protomaps.com/styles/v2/white.json","https://api.protomaps.com/styles/v2/grayscale.json","https://api.protomaps.com/styles/v2/black.json"]}},An={"#":"Settings in this file override the `config`-section of `package.json`"},En=Object.freeze(Object.defineProperty({__proto__:null,default:An},Symbol.toStringTag,{value:"Module"})),w=class w{static isRetina(){return I.runningFromConsole?!1:window.matchMedia&&(window.matchMedia("only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx), only screen and (min-resolution: 75.6dpcm)").matches||window.matchMedia("only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (-o-min-device-pixel-ratio: 2/1), only screen and (min--moz-device-pixel-ratio: 2), only screen and (min-device-pixel-ratio: 2)").matches)||window.devicePixelRatio&&window.devicePixelRatio>=2}};c(w,"vNumber",Tn),c(w,"MaprouletteApiKey",""),c(w,"added_by_default",["selected_element","gps_location","gps_location_history","home_location","gps_track","range","last_click","favourite","summary"]),c(w,"no_include",["conflation","split_point","split_road","current_view","import_candidate","usersettings","icons","filters"]),c(w,"priviliged_layers",[...w.added_by_default,...w.no_include]),c(w,"userJourney",{moreScreenUnlock:1,personalLayoutUnlock:5,historyLinkVisible:10,deletePointsOfOthersUnlock:20,tagsVisibleAt:25,tagsVisibleAndWikiLinked:30,mapCompleteHelpUnlock:50,themeGeneratorReadOnlyUnlock:50,themeGeneratorFullUnlock:500,addNewPointWithUnreadMessagesUnlock:500,importHelperUnlock:5e3}),c(w,"minZoomLevelToAddNewPoint",w.isRetina()?17:18),c(w,"updateTimeoutSec",15),c(w,"nearbyVisitTime",30*60),c(w,"distanceToChangeObjectBins",[25,50,100,500,1e3,5e3,Number.MAX_VALUE]),c(w,"themeOrder",["personal","cyclofix","waste","etymology","food","cafes_and_pubs","shops","playgrounds","hailhydrant","toilets","aed","bookcases"]),c(w,"zoomToLocationTimeout",15),c(w,"viewportCenterCloseToGpsCutoff",20),c(w,"config",(()=>({...vn,...En}))()),c(w,"ImgurApiKey",w.config.api_keys.imgur),c(w,"mapillary_client_token_v4",w.config.api_keys.mapillary_v4),c(w,"defaultOverpassUrls",w.config.default_overpass_urls),c(w,"countryCoderEndpoint",w.config.country_coder_host),c(w,"osmAuthConfig",w.config.oauth_credentials),c(w,"nominatimEndpoint",w.config.nominatimEndpoint),c(w,"linkedDataProxy",w.config["jsonld-proxy"]),c(w,"_defaultPinIcons",["pin","bug","square","square_rounded","circle","checkmark","clock","close","crosshair","help","home","invalid","location","location_empty","location_locked","note","resolved","ring","scissors","teardrop","teardrop_with_hole_green","triangle","brick_wall_square","brick_wall_round","gps_arrow","checkmark","help","close","invalid","heart","heart_outline","link","confirm","direction","not_found","mastodon","party","addSmall"]),c(w,"defaultPinIcons",w._defaultPinIcons),c(w,"VectorTileServer",w.config.mvt_layer_server),c(w,"GeoIpServer",w.config.geoip_server),c(w,"ErrorReportServer",w.config.error_server),c(w,"maptilerApiKey","GvoVAJgu46I5rZapJuAy"),c(w,"SummaryServer",w.config.summary_server),c(w,"allServers",[w.SummaryServer,w.VectorTileServer,w.GeoIpServer,w.ErrorReportServer,w.countryCoderEndpoint,w.osmAuthConfig.url,w.nominatimEndpoint,w.linkedDataProxy,...w.defaultOverpassUrls]);let Ye=w;class fe{static GetParsed(e,t){return fe.Get(e).sync(n=>{if(n===void 0)return t;try{return JSON.parse(n)}catch{return t}},[],n=>JSON.stringify(n))}static Get(e,t=void 0){try{let n=localStorage.getItem(e);n==="undefined"&&(n=void 0);const i=new O(n??t,"localstorage:"+e);return i.addCallback(r=>{try{localStorage.setItem(e,r)}catch{localStorage.clear()}}),i}catch{return new O(t)}}}function kn(d){var e={},t=null;try{t=window.localStorage}catch{var n=new Map;t={isMocked:!0,hasItem:u=>n.has(u),getItem:u=>n.get(u),setItem:(u,h)=>n.set(u,h),removeItem:u=>n.delete(u),clear:()=>n.clear()}}function i(l,u){var h=d.url+l;if(arguments.length===1){var b=t.getItem(h)||"";return b.replace(/"/g,"")}else if(arguments.length===2)return u?t.setItem(h,u):t.removeItem(h)}e.authenticated=function(){return!!i("oauth2_access_token")},e.logout=function(){return i("oauth2_access_token",""),i("oauth_token",""),i("oauth_token_secret",""),i("oauth_request_token_secret",""),e},e.authenticate=function(l){if(e.authenticated()){l(null,e);return}e.logout(),r(function(u,h){u?l(u):Rt(function(b){o(b,h,l)})})},e.authenticateAsync=function(){return e.authenticated()?Promise.resolve(e):(e.logout(),new Promise((l,u)=>{var h=(b,m)=>{b?u(b):l(m)};r((b,m)=>{b?h(b):Rt(T=>o(T,m,h))})}))};function r(l){if(d.singlepage){l(null,void 0);return}var u=550,h=610,b=[["width",u],["height",h],["left",window.screen.width/2-u/2],["top",window.screen.height/2-h/2]].map(function(A){return A.join("=")}).join(","),m=window.open("about:blank","oauth_window",b);if(m)l(null,m);else{var T=new Error("Popup was blocked");T.status="popup-blocked",l(T)}}function o(l,u,h){var b=Cn(),m=d.url+"/oauth2/authorize?"+St({client_id:d.client_id,redirect_uri:d.redirect_uri,response_type:"code",scope:d.scope,state:b,code_challenge:l.code_challenge,code_challenge_method:l.code_challenge_method,locale:d.locale||""});if(d.singlepage){if(t.isMocked){var T=new Error("localStorage unavailable, but required in singlepage mode");T.status="pkce-localstorage-unavailable",h(T);return}var A=Be(window.location.search.slice(1));A.code?e.bootstrapToken(A.code,h):(i("oauth2_state",b),i("oauth2_pkce_code_verifier",l.code_verifier),window.location=m)}else e.popupWindow=u,u.location=m;window.authComplete=function(H){var $=Be(H.split("?")[1]);if($.state!==b){var q=new Error("Invalid state");q.status="invalid-state",h(q);return}s($.code,l.code_verifier,V),delete window.authComplete};function V(H,$){if(d.done(),H){h(H);return}var q=JSON.parse($.response);i("oauth2_access_token",q.access_token),h(null,e)}}function s(l,u,h){var b=d.url+"/oauth2/token?"+St({client_id:d.client_id,redirect_uri:d.redirect_uri,grant_type:"authorization_code",code:l,code_verifier:u});e.rawxhr("POST",b,null,null,null,h),d.loading()}return e.bringPopupWindowToFront=function(){var l=!1;try{e.popupWindow&&!e.popupWindow.closed&&(e.popupWindow.focus(),l=!0)}catch{}return l},e.bootstrapToken=function(l,u){var h=i("oauth2_state");i("oauth2_state","");var b=Be(window.location.search.slice(1));if(b.state!==h){var m=new Error("Invalid state");m.status="invalid-state",u(m);return}var T=i("oauth2_pkce_code_verifier");i("oauth2_pkce_code_verifier",""),s(l,T,A);function A(V,H){if(d.done(),V){u(V);return}var $=JSON.parse(H.response);i("oauth2_access_token",$.access_token),u(null,e)}},e.fetch=function(l,u){if(e.authenticated())return h();return d.auto?e.authenticateAsync().then(h):Promise.reject(new Error("not authenticated"));function h(){return u=u||{},u.headers||(u.headers={"Content-Type":"application/x-www-form-urlencoded"}),u.headers.Authorization="Bearer "+i("oauth2_access_token"),fetch(l,u)}},e.xhr=function(l,u){if(e.authenticated())return h();if(d.auto){e.authenticate(h);return}else{u("not authenticated",null);return}function h(){var m=l.prefix!==!1?d.apiUrl+l.path:l.path;return e.rawxhr(l.method,m,i("oauth2_access_token"),l.content,l.headers,b)}function b(m,T){m?u(m):T.responseXML?u(m,T.responseXML):u(m,T.response)}},e.rawxhr=function(l,u,h,b,m,T){m=m||{"Content-Type":"application/x-www-form-urlencoded"},h&&(m.Authorization="Bearer "+h);var A=new XMLHttpRequest;A.onreadystatechange=function(){A.readyState===4&&A.status!==0&&(/^20\d$/.test(A.status)?T(null,A):T(A,null))},A.onerror=function(H){T(H,null)},A.open(l,u,!0);for(var V in m)A.setRequestHeader(V,m[V]);return A.send(b),A},e.preauth=function(l){return l&&l.access_token&&i("oauth2_access_token",l.access_token),e},e.options=function(l){return arguments.length?(d=l,d.apiUrl=d.apiUrl||"https://api.openstreetmap.org",d.url=d.url||"https://www.openstreetmap.org",d.auto=d.auto||!1,d.singlepage=d.singlepage||!1,d.loading=d.loading||function(){},d.done=d.done||function(){},e.preauth(d)):d},e.options(d),e}function St(d){return Object.keys(d).filter(function(e){return d[e]!==void 0}).sort().map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(d[e])}).join("&")}function Be(d){for(var e=0;e<d.length&&(d[e]==="?"||d[e]==="#");)e++;return d=d.slice(e),d.split("&").reduce(function(t,n){var i=n.split("=");return i.length===2&&(t[i[0]]=decodeURIComponent(i[1])),t},{})}function Pt(){return window&&window.crypto&&window.crypto.getRandomValues&&window.crypto.subtle&&window.crypto.subtle.digest}function Rt(d){var e;if(Pt()){var t=window.crypto.getRandomValues(new Uint8Array(32));e=$e(t.buffer);var n=Uint8Array.from(Array.from(e).map(function(o){return o.charCodeAt(0)}));window.crypto.subtle.digest("SHA-256",n).then(function(o){var s=$e(o);d({code_challenge:s,code_verifier:e,code_challenge_method:"S256"})})}else{var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";e="";for(var r=0;r<64;r++)e+=i[Math.floor(Math.random()*i.length)];d({code_verifier:e,code_challenge:e,code_challenge_method:"plain"})}}function Cn(){var d;if(Pt()){var e=window.crypto.getRandomValues(new Uint8Array(32));d=$e(e.buffer)}else{var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";d="";for(var n=0;n<64;n++)d+=t[Math.floor(Math.random()*t.length)]}return d}function $e(d){return btoa(String.fromCharCode.apply(null,new Uint8Array(d))).replace(/\//g,"_").replace(/\+/g,"-").replace(/[=]/g,"")}class Dn{constructor(e,t,n=!1){c(this,"preferences",fe.GetParsed("all-osm-preferences",{}));c(this,"preferenceSources",new Map);c(this,"auth");c(this,"userDetails");c(this,"longPreferences",{});c(this,"_fakeUser");this.auth=e,this._fakeUser=n,this.userDetails=t.userDetails,t.OnLoggedIn(()=>(this.UpdatePreferences(!0),!0))}GetLongPreference(e,t="mapcomplete-"){if(this.longPreferences[t+e]!==void 0)return this.longPreferences[t+e];const n=new O(void 0,"long-osm-preference:"+t+e);this.longPreferences[t+e]=n;const i=t+e+"-combined",r={prefix:""},o=this.GetPreference(i+"-length","",r);if((i+"-length").length>255)throw"This preference key is too long, it has "+e.length+" characters, but at most "+(255-7-9-t.length)+" characters are allowed";const s=this;n.addCallback(u=>{if(u===void 0||u==="")return;if(u===null){console.error("Deleting "+i);let b=parseInt(o.data);for(let m=0;m<b;m++)s.GetPreference(i+"-"+m,"",r).setData("");s.GetPreference(i+"-length","",r).setData("");return}let h=0;for(;u!=="";){if(u===void 0||u==="undefined")throw n.setData(void 0),"Got 'undefined' or a literal string containing 'undefined' for a long preference with name "+e;if(u==="undefined")throw n.setData(void 0),"Got a literal string containing 'undefined' for a long preference with name "+e;if(h>100)throw"This long preference is getting very long... ";s.GetPreference(i+"-"+h,"",r).setData(u.substr(0,255)),u=u.substr(255),h++}o.setData(""+h)});function l(u){if(Object.keys(s.preferences.data).length===0)return;const h=Number(u);if(h>100)throw"Length to long";let b="";for(let m=0;m<h;m++){const T=i+"-"+m;s.preferences.data[T]===void 0&&console.warn("Detected a broken combined preference:",T,"is undefined",s.preferences),b+=s.preferences.data[T]??""}n.setData(b)}return o.addCallback(u=>{l(Number(u))}),this.preferences.addCallbackAndRun(u=>{l(Number(o.data))}),n}GetPreference(e,t=void 0,n){const i=(n==null?void 0:n.prefix)??"mapcomplete-";if(e.startsWith(i)&&i!==""&&console.trace("A preference was requested which has a duplicate prefix in its key. This is probably a bug"),e=i+e,e=e.replace(/[:\\\/"' {}.%]/g,""),e.length>=255)throw"Preferences: key length to big";const r=this.preferenceSources.get(e);if(r!==void 0)return r;this.userDetails.data.loggedIn&&this.preferences.data[e]===void 0&&this.UpdatePreferences();const o=new O(this.preferences.data[e]??t,"osm-preference:"+e);return o.addCallback(s=>{this.UploadPreference(e,s)}),this.preferences.addCallbackD(s=>{const l=s[e];l!==void 0&&o.setData(l)}),this.preferenceSources.set(e,o),o}ClearPreferences(){let e=!1;const t=this;this.preferences.addCallback(n=>{if(console.log("Cleaning preferences..."),Object.keys(n).length==0||e)return;e=!0;const i=["mapcomplete-"];for(const r in n)i.some(s=>r.startsWith(s))&&(console.log("Clearing ",r),t.GetPreference(r,"",{prefix:""}).setData(""));e=!1})}removeAllWithPrefix(e){for(const t in this.preferences.data)t.startsWith(e)&&(this.GetPreference(t,"",{prefix:""}).setData(void 0),console.log("Clearing preference",t));this.preferences.ping()}UpdatePreferences(e){const t=this;this._fakeUser||this.auth.xhr({method:"GET",path:"/api/0.6/user/preferences"},function(n,i){if(n){console.log("Could not load preferences",n);return}const r=i.getElementsByTagName("preference"),o=new Set;for(let s=0;s<r.length;s++){const l=r[s],u=l.getAttribute("k"),h=l.getAttribute("v");t.preferences.data[u]=h,o.add(u)}if(e)for(let s in t.preferences.data)o.has(s)||(console.log("Deleting key",s,"as we didn't find it upstream"),delete t.preferences.data[s]);t.preferenceSources.forEach((s,l)=>{const u=t.preferences.data[l];u===void 0&&s.data!==void 0?t.UploadPreference(l,s.data):s.setData(u)}),t.preferences.ping()})}UploadPreference(e,t){if(!this.userDetails.data.loggedIn){console.debug(`Not saving preference ${e}: user not logged in`);return}if(this.preferences.data[e]===t)return;const n=this;if(console.debug("Updating preference",e," to ",I.EllipsesAfter(t,15)),!this._fakeUser){if(t===void 0||t===""){this.auth.xhr({method:"DELETE",path:"/api/0.6/user/preferences/"+encodeURIComponent(e),headers:{"Content-Type":"text/plain"}},function(i){if(i){console.warn("Could not remove preference",i);return}delete n.preferences.data[e],n.preferences.ping(),console.debug("Preference ",e,"removed!")});return}this.auth.xhr({method:"PUT",path:"/api/0.6/user/preferences/"+encodeURIComponent(e),headers:{"Content-Type":"text/plain"},content:t},function(i){if(i){console.warn(`Could not set preference "${e}"'`,i);return}n.preferences.data[e]=t,n.preferences.ping(),console.debug(`Preference ${e} written!`)})}}}class Sn{constructor(e){c(this,"loggedIn",!1);c(this,"name","Not logged in");c(this,"uid");c(this,"csCount",0);c(this,"img");c(this,"unreadMessages",0);c(this,"totalMessages",0);c(this,"home");c(this,"backend");c(this,"account_created");c(this,"tracesCount",0);c(this,"description");c(this,"languages");this.backend=e}}class Rn{constructor(e){c(this,"auth");c(this,"userDetails");c(this,"isLoggedIn");c(this,"gpxServiceIsOnline",new O("unknown"));c(this,"apiIsOnline",new O("unknown"));c(this,"loadingStatus",new O("not-attempted"));c(this,"preferencesHandler");c(this,"_oauth_config");c(this,"_dryRun");c(this,"fakeUser");c(this,"_onLoggedIn",[]);c(this,"_iframeMode");c(this,"_singlePage");c(this,"isChecking",!1);c(this,"_doCheckRegularly");c(this,"_userInfoCache",{});var t;if(e??(e={}),this.fakeUser=(e==null?void 0:e.fakeUser)??!1,this._singlePage=(e==null?void 0:e.singlePage)??!0,this._oauth_config=Ye.osmAuthConfig,this._doCheckRegularly=(e==null?void 0:e.checkOnlineRegularly)??!0,console.debug("Using backend",this._oauth_config.url),this._iframeMode=I.runningFromConsole?!1:window!==window.top,{}.VITE_OSM_OAUTH_CLIENT_ID!==void 0&&{}.VITE_OSM_OAUTH_SECRET!==void 0&&(console.debug("Using environment variables for oauth config"),this._oauth_config.oauth_client_id={}.VITE_OSM_OAUTH_CLIENT_ID,this._oauth_config.oauth_secret={}.VITE_OSM_OAUTH_SECRET),this.userDetails=new O(new Sn(this._oauth_config.url),"userDetails"),e.fakeUser){const n=this.userDetails.data;n.csCount=5678,n.uid=42,n.loggedIn=!0,n.unreadMessages=0,n.name="Fake user",n.totalMessages=42,n.languages=["en"],this.loadingStatus.setData("logged-in")}this.UpdateCapabilities(),this.isLoggedIn=this.userDetails.map(n=>n.loggedIn&&(this.apiIsOnline.data==="unknown"||this.apiIsOnline.data==="online"),[this.apiIsOnline]),this.isLoggedIn.addCallback(n=>{this.userDetails.data.loggedIn==!1&&n==!0&&this.AttemptLogin()}),this._dryRun=e.dryRun??new O(!1),this.updateAuthObject(),this.fakeUser||this.CheckForMessagesContinuously(),this.preferencesHandler=new Dn(this.auth,this,this.fakeUser),((t=e.oauth_token)==null?void 0:t.data)!==void 0&&(console.log(e.oauth_token.data),this.auth.bootstrapToken(e.oauth_token.data,(n,i)=>{console.log("Bootstrap token called back",n,i),this.AttemptLogin()}),e.oauth_token.setData(void 0)),!I.runningFromConsole&&this.auth.authenticated()&&e.attemptLogin!==!1?this.AttemptLogin():console.log("Not authenticated")}GetPreference(e,t=void 0,n){return this.preferencesHandler.GetPreference(e,t,n)}GetLongPreference(e,t="mapcomplete-"){return this.preferencesHandler.GetLongPreference(e,t)}OnLoggedIn(e){this._onLoggedIn.push(e)}LogOut(){this.auth.logout(),this.userDetails.data.loggedIn=!1,this.userDetails.data.csCount=0,this.userDetails.data.name="",this.userDetails.ping(),console.log("Logged out"),this.loadingStatus.setData("not-attempted"),this.preferencesHandler.preferences.setData(void 0)}Backend(){return this._oauth_config.url}AttemptLogin(){if(this.UpdateCapabilities(),this.loadingStatus.data!=="logged-in"&&this.loadingStatus.setData("loading"),this.fakeUser){this.loadingStatus.setData("logged-in"),console.log("AttemptLogin called, but ignored as fakeUser is set");return}console.log("Trying to log in..."),this.updateAuthObject(),fe.Get("location_before_login").setData(I.runningFromConsole?void 0:window.location.href),this.auth.xhr({method:"GET",path:"/api/0.6/user/details"},(e,t)=>{var u;if(e!=null){console.log("Could not login due to:",e),this.loadingStatus.setData("error"),e.status==401?(console.log("Clearing tokens..."),this.auth.logout(),this.LogOut()):(console.log("Other error. Status:",e.status),this.apiIsOnline.setData("unreachable"));return}if(t==null){this.loadingStatus.setData("error");return}const n=t.getElementsByTagName("user")[0],i=this.userDetails.data;i.loggedIn=!0,console.log("Login completed, userinfo is ",n),i.name=n.getAttribute("display_name"),i.account_created=n.getAttribute("account_created"),i.uid=Number(n.getAttribute("id")),i.languages=Array.from(n.getElementsByTagName("languages")[0].getElementsByTagName("lang")).map(h=>h.textContent),i.csCount=Number.parseInt(n.getElementsByTagName("changesets")[0].getAttribute("count")??"0"),i.tracesCount=Number.parseInt(n.getElementsByTagName("traces")[0].getAttribute("count")??"0"),i.img=void 0;const r=n.getElementsByTagName("img");r!==void 0&&r[0]!==void 0&&(i.img=r[0].getAttribute("href"));const o=n.getElementsByTagName("description");o!==void 0&&o[0]!==void 0&&(i.description=(u=o[0])==null?void 0:u.innerHTML);const s=n.getElementsByTagName("home");if(s!==void 0&&s[0]!==void 0){const h=parseFloat(s[0].getAttribute("lat")),b=parseFloat(s[0].getAttribute("lon"));i.home={lat:h,lon:b}}this.loadingStatus.setData("logged-in");const l=n.getElementsByTagName("messages")[0].getElementsByTagName("received")[0];i.unreadMessages=parseInt(l.getAttribute("unread")),i.totalMessages=parseInt(l.getAttribute("count")),this.userDetails.ping();for(const h of this._onLoggedIn)h(this.userDetails.data);this._onLoggedIn=[]})}async interact(e,t,n,i,r=!1){const o=this.auth;if(r&&!this.auth.authenticated()){const s=await I.downloadAdvanced(`${this.Backend()}/api/0.6/${e}`,n,t,i);if(s.content)return s.content;throw console.error(s),"Could not interact with OSM:"+s.error}return new Promise((s,l)=>{o.xhr({method:t,headers:n,content:i,path:`/api/0.6/${e}`},function(u,h){u!==null?l(u):s(h)})})}async post(e,t,n,i=!1){return await this.interact(e,"POST",n,t,i)}async put(e,t,n){return await this.interact(e,"PUT",n,t)}async get(e,t,n=!1){return await this.interact(e,"GET",t,void 0,n)}closeNote(e,t){let n="";return(t??"")!==""&&(n="?text="+encodeURIComponent(t)),this._dryRun.data?(console.warn("Dryrun enabled - not actually closing note ",e," with text ",t),new Promise(i=>{i("")})):this.post(`notes/${e}/close${n}`)}reopenNote(e,t){if(this._dryRun.data)return console.warn("Dryrun enabled - not actually reopening note ",e," with text ",t),new Promise(i=>{i("")});let n="";return(t??"")!==""&&(n="?text="+encodeURIComponent(t)),this.post(`notes/${e}/reopen${n}`)}async openNote(e,t,n){if(this._dryRun.data)return console.warn("Dryrun enabled - not actually opening note with text ",n),new Promise(l=>{window.setTimeout(()=>l({id:Math.floor(Math.random()*1e3)}),Math.random()*5e3)});const i=`lat=${e}&lon=${t}&text=${encodeURIComponent(n)}`,r=await this.post("notes.json",i,{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},!0),o=JSON.parse(r);console.log("Got result:",o);const s=o.properties;return console.log("OPENED NOTE",s),s}async uploadGpxTrack(e,t){var u;if(this._dryRun.data)return console.warn("Dryrun enabled - not actually uploading GPX ",e),new Promise(h=>{window.setTimeout(()=>h({id:Math.floor(Math.random()*1e3)}),Math.random()*5e3)});const n={file:e,description:t.description,tags:((u=t.labels)==null?void 0:u.join(","))??"",visibility:t.visibility};if(!n.description)throw"The description of a GPS-trace cannot be the empty string, undefined or null";const i={file:'; filename="'+(t.filename??"gpx_track_mapcomplete_"+new Date().toISOString())+`"\r
Content-Type: application/gpx+xml`},r="987654";let o="";for(const h in n)o+="--"+r+`\r
`,o+='Content-Disposition: form-data; name="'+h+'"',i[h]!==void 0&&(o+=i[h]),o+=`\r
\r
`,o+=n[h]+`\r
`;o+="--"+r+`--\r
`;const s=await this.post("gpx/create",o,{"Content-Type":"multipart/form-data; boundary="+r,"Content-Length":""+o.length}),l=JSON.parse(s);return console.log("Uploaded GPX track",l),{id:l}}addCommentToNote(e,t){if(this._dryRun.data)return console.warn("Dryrun enabled - not actually adding comment ",t,"to  note ",e),I.waitFor(1e3);if((t??"")==="")throw"Invalid text!";return new Promise((n,i)=>{this.auth.xhr({method:"POST",path:`/api/0.6/notes/${e}/comment?text=${encodeURIComponent(t)}`},function(r){r!==null?i(r):n()})})}finishLogin(e){this.auth.authenticate(function(){console.log("Authentication successful!");const t=fe.Get("location_before_login");e(t.data)})}updateAuthObject(){this.auth=new kn({client_id:this._oauth_config.oauth_client_id,url:this._oauth_config.url,scope:"read_prefs write_prefs write_api write_gpx write_notes openid",redirect_uri:I.runningFromConsole?"https://mapcomplete.org/land.html":window.location.protocol+"//"+window.location.host+"/land.html",singlepage:!0,auto:!0})}CheckForMessagesContinuously(){this.isChecking||(Ct.Chronic(3*1e3).addCallback(()=>{if(this.apiIsOnline.data==="unreachable"||this.apiIsOnline.data==="offline")try{console.log("Api is offline - trying to reconnect..."),this.AttemptLogin()}catch(e){console.log("Could not login due to",e)}}),this.isChecking=!0,this._doCheckRegularly&&Ct.Chronic(60*5*1e3).addCallback(()=>{if(this.isLoggedIn.data)try{this.AttemptLogin()}catch(e){console.log("Could not login due to",e)}}))}UpdateCapabilities(){this.fakeUser||this.FetchCapabilities().then(({api:e,gpx:t})=>{this.apiIsOnline.setData(e),this.gpxServiceIsOnline.setData(t)})}async getInformationAboutUser(e){if(e===void 0)return;if(this._userInfoCache[e])return this._userInfoCache[e];const t=await this.get("user/"+e+".json",{accepts:"application/json"},!0),n=JSON.parse(t).user;return this._userInfoCache[e]=n,n}async FetchCapabilities(){if(I.runningFromConsole)return{api:"online",gpx:"online"};const e=await I.downloadAdvanced(this.Backend()+"/api/0.6/capabilities");if(e.content===void 0)return console.log("Something went wrong:",e),{api:"unreachable",gpx:"unreachable"};const t=e.content,i=new DOMParser().parseFromString(t,"text/xml").getElementsByTagName("status")[0],r=i.getAttribute("api"),o=i.getAttribute("gpx");return{api:r,gpx:o}}}c(Rn,"GpxTrackVisibility",["private","public","trackable","identifiable"]);export{Ye as C,Dt as I,fe as L,Rn as O,Ct as S,I as U,O as a,qe as b};
//# sourceMappingURL=OsmConnection-b873e866.js.map
